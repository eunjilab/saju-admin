<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ì—°ìƒ ìƒì„±ê¸° - Step 4</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Serif KR', serif;
            background: linear-gradient(135deg, #f5f0e8 0%, #e8e0d0 100%);
            min-height: 100vh;
            color: #2d2418;
            padding: 20px;
        }
        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(180deg, #fdfbf7 0%, #f8f4eb 100%);
            border: 2px solid #8b7355;
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.18);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c2416 0%, #4a3c2a 100%);
            color: #f0e6d3;
            text-align: center;
            padding: 35px 20px;
            position: relative;
        }
        .header::after {
            content: 'ç·£';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            opacity: 0.05;
        }
        .header h1 {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: 6px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            color: #f0e6d3;
            background: none;
        }
        .header .subtitle {
            font-size: 13px;
            opacity: 0.8;
            letter-spacing: 2px;
            color: #d4c5a9;
        }
        .content-area {
            padding: 30px;
        }
        
        /* ì…ë ¥ íŒ¨ë„ */
        .input-panel {
            display: none;
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid #e0d5c5;
        }
        .input-panel.active {
            display: block;
        }
        
        /* JSON ë³µë¶™ ëª¨ë“œ */
        .json-input {
            width: 100%;
            height: 300px;
            padding: 16px;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            border-radius: 8px;
            border: 1px solid #d4c5a9;
            background: #f9f6ef;
            color: #4a7c59;
            resize: vertical;
        }
        .json-input::placeholder {
            color: #8b7a60;
        }
        
        /* ë¶™ì—¬ë„£ê¸° ë²„íŠ¼ */
        .paste-btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            font-size: 1em;
            background: linear-gradient(135deg, #e8e0d0 0%, #d8d0c0 100%);
            border: 1px solid #c8c0b0;
            border-radius: 8px;
            color: #5a4a3a;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .paste-btn:hover {
            background: linear-gradient(135deg, #d8d0c0 0%, #c8c0b0 100%);
        }
        
        /* ìƒì„± ë²„íŠ¼ */
        .generate-btn {
            display: block;
            margin: 20px auto;
            padding: 16px 48px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #8b7355 0%, #6b5744 100%);
            border: none;
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(107, 87, 68, 0.4);
        }
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 87, 68, 0.6);
        }
        
        /* ê²°ê³¼ ì˜ì—­ */
        #result-section {
            display: none;
            margin-top: 30px;
        }
        #result-section.show {
            display: block;
        }
        
        /* ê²°ê³¼ ë°•ìŠ¤ */
        .result-box {
            max-width: 900px;
            width: calc(100% - 40px);
            margin: 0 auto 30px;
            padding: 30px;
            background: #fff;
            border-radius: 24px;
            border: 1px solid #e0d5c5;
        }
        
        /* ë³¸ì¸ ì •ë³´ */
        .user-info {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0d5c5;
        }
        .user-info h2 {
            color: #2d2418;
            font-weight: 400;
            font-size: 22px;
            margin-bottom: 10px;
        }
        .user-info p {
            color: #8b7a60;
            font-size: 14px;
        }
        
        /* ì„±ë³„ ê·¸ë£¹ (ë‘˜ë‹¤ìš©) */
        .gender-group {
            margin-bottom: 30px;
        }
        .gender-group:last-child {
            margin-bottom: 0;
        }
        .gender-label {
            text-align: center;
            color: #5a4a3a;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .gender-label span {
            font-size: 18px;
            margin-right: 6px;
        }
        
        /* ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
        .cards-row {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: nowrap;
            padding: 0 20px;
        }
        .card-wrapper {
            text-align: center;
            flex: 0 0 auto;
        }
        .card-label {
            color: #2d2418;
            font-size: 16px;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }
        .card-label span {
            font-size: 20px;
            margin-right: 8px;
        }
        
        /* ëª¨ë°”ì¼ ëŒ€ì‘ - 2ê°œì”© ìœ ì§€ */
        @media (max-width: 600px) {
            .result-box {
                width: calc(100% - 20px);
                padding: 15px;
            }
            .cards-row {
                display: flex;
                gap: 10px;
                justify-content: center;
                padding: 0;
            }
            .card-wrapper {
                flex: 0 0 auto;
            }
            .card {
                width: 145px;
                height: 225px;
            }
            .card-label {
                font-size: 10px;
                letter-spacing: 1px;
            }
            .element-label {
                font-size: 8px;
            }
            .character-area {
                width: 85px;
                height: 110px;
            }
            .character-area svg {
                width: 100%;
                height: 100%;
            }
            .element-badge {
                padding: 3px 10px;
                font-size: 11px;
            }
            .element-name {
                font-size: 12px;
            }
            .element-desc {
                font-size: 9px;
            }
            .napeum-info {
                font-size: 8px;
            }
            .user-info h2 {
                font-size: 14px;
            }
            .user-info p {
                font-size: 10px;
            }
            .gender-label {
                font-size: 11px;
            }
            .content {
                padding: 12px;
            }
        }
        
        /* HTML ë³µì‚¬ ë²„íŠ¼ */
        .copy-btn {
            display: block;
            margin: 20px auto 0;
            padding: 12px 30px;
            background: linear-gradient(135deg, #8b7355 0%, #6b5744 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(107,87,68,0.4);
        }
        .copy-btn.copied {
            background: linear-gradient(135deg, #4a7c59, #5a9a6a);
        }
        .card {
            width: 260px;
            height: 400px;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover { transform: translateY(-8px); }
        
        /* ì¤‘ê°„ í™”ë©´ ëŒ€ì‘ */
        @media (max-width: 700px) {
            .card {
                width: 200px;
                height: 310px;
            }
            .cards-row {
                gap: 15px;
            }
            .user-info h2 {
                font-size: 20px;
            }
            .user-info p {
                font-size: 13px;
            }
            .card-label {
                font-size: 14px;
            }
            .character-area {
                margin-top: -10px;
            }
            .character-area svg {
                transform: scale(0.85);
            }
            .element-badge {
                padding: 5px 14px;
                font-size: 13px;
            }
            .element-name {
                font-size: 14px;
            }
            .element-desc {
                font-size: 11px;
            }
        }

        /* ë°°ê²½ ê¸€ë¡œìš° */
        .bg-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.4;
        }

        /* ë³„ íš¨ê³¼ */
        .stars {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
        }
        .star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
        }

        /* ì»¨í…ì¸  */
        .content {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 20px;
        }
        .element-label {
            font-size: 11px;
            letter-spacing: 3px;
            opacity: 0.6;
            margin-bottom: 8px;
            font-weight: 300;
        }
        .character-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .char-glow {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            filter: blur(40px);
            opacity: 0.5;
        }
        .character-area svg {
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        .info {
            text-align: center;
            margin-top: auto;
        }
        .element-badge {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 20px;
            font-weight: 400;
            backdrop-filter: blur(10px);
        }
        .element-name {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }
        .element-desc {
            font-size: 11px;
            opacity: 0.5;
            font-weight: 300;
            line-height: 1.5;
            max-width: 200px;
        }
        .napeum-info {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 10px;
            opacity: 0.4;
            letter-spacing: 0.5px;
        }

        /* ========== ê¸ˆ(é‡‘) ========== */
        .card-ê¸ˆ {
            background: linear-gradient(180deg, #2a2a3e 0%, #1e1e30 100%);
            box-shadow: 0 10px 40px rgba(200, 200, 230, 0.15);
        }
        .card-ê¸ˆ .bg-glow { background: rgba(210, 210, 240, 0.5); }
        .card-ê¸ˆ .char-glow { background: rgba(200, 200, 230, 0.4); }
        .card-ê¸ˆ .element-label, .card-ê¸ˆ .element-name, .card-ê¸ˆ .element-desc { color: #e8e8f8; }
        .card-ê¸ˆ .element-badge { 
            background: rgba(200, 200, 230, 0.15); 
            border: 1px solid rgba(200, 200, 230, 0.3); 
            color: #e8e8f8;
            box-shadow: 0 0 20px rgba(200, 200, 230, 0.2);
        }
        .card-ê¸ˆ .star { background: #e8e8ff; }
        .card-ê¸ˆ .napeum-info { color: #e8e8f8; }

        /* ========== ëª©(æœ¨) ========== */
        .card-ëª© {
            background: linear-gradient(180deg, #1a2a1a 0%, #152015 100%);
            box-shadow: 0 10px 40px rgba(100, 180, 100, 0.15);
        }
        .card-ëª© .bg-glow { background: rgba(120, 200, 120, 0.5); }
        .card-ëª© .char-glow { background: rgba(100, 180, 100, 0.4); }
        .card-ëª© .element-label, .card-ëª© .element-name, .card-ëª© .element-desc { color: #d0f0d0; }
        .card-ëª© .element-badge { 
            background: rgba(100, 180, 100, 0.15); 
            border: 1px solid rgba(100, 180, 100, 0.3); 
            color: #d0f0d0;
            box-shadow: 0 0 20px rgba(100, 180, 100, 0.2);
        }
        .card-ëª© .star { background: #c0ffc0; }
        .card-ëª© .napeum-info { color: #d0f0d0; }

        /* ========== ìˆ˜(æ°´) ========== */
        .card-ìˆ˜ {
            background: linear-gradient(180deg, #1a1a3e 0%, #151528 100%);
            box-shadow: 0 10px 40px rgba(100, 150, 255, 0.15);
        }
        .card-ìˆ˜ .bg-glow { background: rgba(120, 170, 255, 0.5); }
        .card-ìˆ˜ .char-glow { background: rgba(100, 150, 255, 0.4); }
        .card-ìˆ˜ .element-label, .card-ìˆ˜ .element-name, .card-ìˆ˜ .element-desc { color: #d0e0ff; }
        .card-ìˆ˜ .element-badge { 
            background: rgba(100, 150, 255, 0.15); 
            border: 1px solid rgba(100, 150, 255, 0.3); 
            color: #d0e0ff;
            box-shadow: 0 0 20px rgba(100, 150, 255, 0.2);
        }
        .card-ìˆ˜ .star { background: #c0d8ff; }
        .card-ìˆ˜ .napeum-info { color: #d0e0ff; }

        /* ========== í™”(ç«) ========== */
        .card-í™” {
            background: linear-gradient(180deg, #2e1a1a 0%, #281515 100%);
            box-shadow: 0 10px 40px rgba(255, 120, 100, 0.15);
        }
        .card-í™” .bg-glow { background: rgba(255, 140, 120, 0.5); }
        .card-í™” .char-glow { background: rgba(255, 120, 100, 0.4); }
        .card-í™” .element-label, .card-í™” .element-name, .card-í™” .element-desc { color: #ffe0d8; }
        .card-í™” .element-badge { 
            background: rgba(255, 120, 100, 0.15); 
            border: 1px solid rgba(255, 120, 100, 0.3); 
            color: #ffe0d8;
            box-shadow: 0 0 20px rgba(255, 120, 100, 0.2);
        }
        .card-í™” .star { background: #ffc8c0; }
        .card-í™” .napeum-info { color: #ffe0d8; }

        /* ========== í† (åœŸ) ========== */
        .card-í†  {
            background: linear-gradient(180deg, #2a2518 0%, #1a1508 100%);
            box-shadow: 0 10px 40px rgba(200, 160, 100, 0.15);
        }
        .card-í†  .bg-glow { background: rgba(210, 170, 120, 0.5); }
        .card-í†  .char-glow { background: rgba(200, 160, 100, 0.4); }
        .card-í†  .element-label, .card-í†  .element-name, .card-í†  .element-desc { color: #f0e0c8; }
        .card-í†  .element-badge { 
            background: rgba(200, 160, 100, 0.15); 
            border: 1px solid rgba(200, 160, 100, 0.3); 
            color: #f0e0c8;
            box-shadow: 0 0 20px rgba(200, 160, 100, 0.2);
        }
        .card-í†  .star { background: #ffd090; }
        .card-í†  .napeum-info { color: #f0e0c8; }
        
        /* ì—ëŸ¬ ë©”ì‹œì§€ */
        .error-msg {
            background: rgba(255,100,100,0.2);
            border: 1px solid rgba(255,100,100,0.5);
            padding: 12px;
            border-radius: 8px;
            color: #ff8888;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .error-msg.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>ğŸ¨ ì¸ì—°ìƒ ìƒì„±ê¸°</h1>
            <p class="subtitle">Step 4 | ì¸ì—°ìƒ Â· ë°°ìš°ììƒ ì´ë¯¸ì§€ ìƒì„±</p>
        </div>
        
        <div class="content-area">
        <!-- JSON ë³µë¶™ ëª¨ë“œ íŒ¨ë„ -->
        <div id="panel-json" class="input-panel active">
            <div style="margin-bottom:15px;">
                <label style="color:#e8e0d8; font-size:14px; margin-bottom:8px; display:block;">ğŸ‘¤ ê³ ê° ì´ë¦„ (localStorage ì €ì¥ìš©)</label>
                <input type="text" id="customer-name-input" placeholder="ì˜ˆ: ê¹€ì² ìˆ˜" style="width:100%; max-width:300px; padding:12px 15px; border:1px solid rgba(255,255,255,0.15); border-radius:8px; background:rgba(0,0,0,0.3); color:#fff; font-size:15px; box-sizing:border-box;">
            </div>
            <button class="paste-btn" onclick="pasteFromClipboard()">ğŸ“‹ í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°</button>
            <textarea id="json-input" class="json-input" placeholder='ì¸ì—°ìƒ ê³„ì‚°ê¸° ê²°ê³¼ JSONì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ê¸°...

ì˜ˆì‹œ:
{
  "ì…ë ¥": { "ì¼ì£¼": "ç”²å­", "ë³¸ì¸ì„±ë³„": "ë‚¨", "ìƒëŒ€ì„±ë³„": "ì—¬" },
  "ì¸ì—°ìƒ": {
    "ì˜¤í–‰": "ìˆ˜",
    "ë„ì¶œë‚©ìŒ": "ëŒ€í•´ìˆ˜",
    "ì™¸ëª¨": { "ì–¼êµ´í˜•": "...", "ëˆˆ": "...", "í”¼ë¶€í†¤": "...", "ë¶„ìœ„ê¸°": "..." }
  },
  "ë°°ìš°ììƒ": { ... }
}'></textarea>
            <div id="json-error" style="color:#c75050; font-size:14px; margin-top:10px;"></div>
            <button class="generate-btn" onclick="generateFromJSON()">âœ¨ ìƒì„±í•˜ê¸°</button>
        </div>
        
        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div id="result-section">
            <div id="result-content"></div>
            <button class="copy-btn" onclick="copyResultHTML()">ğŸ“‹ HTML ë³µì‚¬í•˜ê¸°</button>
        </div>
        </div>
    </div>
    
    <a href="index.html" style="position:fixed; bottom:20px; right:20px; z-index:9999; width:50px; height:50px; background:linear-gradient(135deg,#d4af82,#b8956a); border-radius:50%; display:flex; align-items:center; justify-content:center; text-decoration:none; font-size:24px; box-shadow:0 4px 15px rgba(0,0,0,0.3);">ğŸ </a>

<script>
// ============================================
// í´ë¦½ë³´ë“œì—ì„œ ë¶™ì—¬ë„£ê¸°
// ============================================
async function pasteFromClipboard() {
    try {
        const text = await navigator.clipboard.readText();
        document.getElementById('json-input').value = text;
        // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
        document.getElementById('json-error').textContent = '';
    } catch (err) {
        alert('í´ë¦½ë³´ë“œ ì ‘ê·¼ ì‹¤íŒ¨. ì§ì ‘ ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”.');
    }
}

// ============================================
// 60ê°‘ì ëª©ë¡
// ============================================
const gapjaList = [
    "ç”²å­", "ä¹™ä¸‘", "ä¸™å¯…", "ä¸å¯", "æˆŠè¾°", "å·±å·³", "åºšåˆ", "è¾›æœª", "å£¬ç”³", "ç™¸é…‰",
    "ç”²æˆŒ", "ä¹™äº¥", "ä¸™å­", "ä¸ä¸‘", "æˆŠå¯…", "å·±å¯", "åºšè¾°", "è¾›å·³", "å£¬åˆ", "ç™¸æœª",
    "ç”²ç”³", "ä¹™é…‰", "ä¸™æˆŒ", "ä¸äº¥", "æˆŠå­", "å·±ä¸‘", "åºšå¯…", "è¾›å¯", "å£¬è¾°", "ç™¸å·³",
    "ç”²åˆ", "ä¹™æœª", "ä¸™ç”³", "ä¸é…‰", "æˆŠæˆŒ", "å·±äº¥", "åºšå­", "è¾›ä¸‘", "å£¬å¯…", "ç™¸å¯",
    "ç”²è¾°", "ä¹™å·³", "ä¸™åˆ", "ä¸æœª", "æˆŠç”³", "å·±é…‰", "åºšæˆŒ", "è¾›äº¥", "å£¬å­", "ç™¸ä¸‘",
    "ç”²å¯…", "ä¹™å¯", "ä¸™è¾°", "ä¸å·³", "æˆŠåˆ", "å·±æœª", "åºšç”³", "è¾›é…‰", "å£¬æˆŒ", "ç™¸äº¥"
];

// ê°‘ì â†’ ë‚©ìŒ ë§¤í•‘
const gapjaNapeum = {
    "ç”²å­": "í•´ì¤‘ê¸ˆ", "ä¹™ä¸‘": "í•´ì¤‘ê¸ˆ", "ä¸™å¯…": "ë…¸ì¤‘í™”", "ä¸å¯": "ë…¸ì¤‘í™”", "æˆŠè¾°": "ëŒ€ë¦¼ëª©", "å·±å·³": "ëŒ€ë¦¼ëª©",
    "åºšåˆ": "ë…¸ë°©í† ", "è¾›æœª": "ë…¸ë°©í† ", "å£¬ç”³": "ê²€ë´‰ê¸ˆ", "ç™¸é…‰": "ê²€ë´‰ê¸ˆ", "ç”²æˆŒ": "ì‚°ë‘í™”", "ä¹™äº¥": "ì‚°ë‘í™”",
    "ä¸™å­": "ê°„í•˜ìˆ˜", "ä¸ä¸‘": "ê°„í•˜ìˆ˜", "æˆŠå¯…": "ì„±ë‘í† ", "å·±å¯": "ì„±ë‘í† ", "åºšè¾°": "ë°±ë‚©ê¸ˆ", "è¾›å·³": "ë°±ë‚©ê¸ˆ",
    "å£¬åˆ": "ì–‘ë¥˜ëª©", "ç™¸æœª": "ì–‘ë¥˜ëª©", "ç”²ç”³": "ì²œì¤‘ìˆ˜", "ä¹™é…‰": "ì²œì¤‘ìˆ˜", "ä¸™æˆŒ": "ì˜¥ìƒí† ", "ä¸äº¥": "ì˜¥ìƒí† ",
    "æˆŠå­": "ë²½ë ¥í™”", "å·±ä¸‘": "ë²½ë ¥í™”", "åºšå¯…": "ì†¡ë°±ëª©", "è¾›å¯": "ì†¡ë°±ëª©", "å£¬è¾°": "ì¥ë¥˜ìˆ˜", "ç™¸å·³": "ì¥ë¥˜ìˆ˜",
    "ç”²åˆ": "ì‚¬ì¤‘ê¸ˆ", "ä¹™æœª": "ì‚¬ì¤‘ê¸ˆ", "ä¸™ç”³": "ì‚°í•˜í™”", "ä¸é…‰": "ì‚°í•˜í™”", "æˆŠæˆŒ": "í‰ì§€ëª©", "å·±äº¥": "í‰ì§€ëª©",
    "åºšå­": "ë²½ìƒí† ", "è¾›ä¸‘": "ë²½ìƒí† ", "å£¬å¯…": "ê¸ˆë°•ê¸ˆ", "ç™¸å¯": "ê¸ˆë°•ê¸ˆ", "ç”²è¾°": "ë³µë“±í™”", "ä¹™å·³": "ë³µë“±í™”",
    "ä¸™åˆ": "ì²œí•˜ìˆ˜", "ä¸æœª": "ì²œí•˜ìˆ˜", "æˆŠç”³": "ëŒ€ì—­í† ", "å·±é…‰": "ëŒ€ì—­í† ", "åºšæˆŒ": "ì°¨ì²œê¸ˆ", "è¾›äº¥": "ì°¨ì²œê¸ˆ",
    "å£¬å­": "ìƒìëª©", "ç™¸ä¸‘": "ìƒìëª©", "ç”²å¯…": "ëŒ€ê³„ìˆ˜", "ä¹™å¯": "ëŒ€ê³„ìˆ˜", "ä¸™è¾°": "ì‚¬ì¤‘í† ", "ä¸å·³": "ì‚¬ì¤‘í† ",
    "æˆŠåˆ": "ì²œìƒí™”", "å·±æœª": "ì²œìƒí™”", "åºšç”³": "ì„ë¥˜ëª©", "è¾›é…‰": "ì„ë¥˜ëª©", "å£¬æˆŒ": "ëŒ€í•´ìˆ˜", "ç™¸äº¥": "ëŒ€í•´ìˆ˜"
};

// ë‚©ìŒ â†’ ì˜¤í–‰ ë§¤í•‘
const napeumToOhang = {
    "í•´ì¤‘ê¸ˆ": "ê¸ˆ", "ì‚¬ì¤‘ê¸ˆ": "ê¸ˆ", "ë°±ë‚©ê¸ˆ": "ê¸ˆ", "ê¸ˆë°•ê¸ˆ": "ê¸ˆ", "ê²€ë´‰ê¸ˆ": "ê¸ˆ", "ì°¨ì²œê¸ˆ": "ê¸ˆ",
    "ëŒ€ë¦¼ëª©": "ëª©", "ì–‘ë¥˜ëª©": "ëª©", "ì†¡ë°±ëª©": "ëª©", "í‰ì§€ëª©": "ëª©", "ìƒìëª©": "ëª©", "ì„ë¥˜ëª©": "ëª©",
    "ê°„í•˜ìˆ˜": "ìˆ˜", "ëŒ€ê³„ìˆ˜": "ìˆ˜", "ì¥ë¥˜ìˆ˜": "ìˆ˜", "ì²œí•˜ìˆ˜": "ìˆ˜", "ëŒ€í•´ìˆ˜": "ìˆ˜", "ì²œì¤‘ìˆ˜": "ìˆ˜",
    "ë…¸ì¤‘í™”": "í™”", "ì‚°ë‘í™”": "í™”", "ë²½ë ¥í™”": "í™”", "ë³µë“±í™”": "í™”", "ì²œìƒí™”": "í™”", "ì‚°í•˜í™”": "í™”",
    "ë…¸ë°©í† ": "í† ", "ì„±ë‘í† ": "í† ", "ì˜¥ìƒí† ": "í† ", "ë²½ìƒí† ": "í† ", "ëŒ€ì—­í† ": "í† ", "ì‚¬ì¤‘í† ": "í† "
};

// í•œì â†’ í•œê¸€ ë³€í™˜
const hanjaToHangul = {
    "æµ·ä¸­é‡‘": "í•´ì¤‘ê¸ˆ", "æ²™ä¸­é‡‘": "ì‚¬ì¤‘ê¸ˆ", "ç™½è Ÿé‡‘": "ë°±ë‚©ê¸ˆ", "é‡‘ç®”é‡‘": "ê¸ˆë°•ê¸ˆ", "åŠé‹’é‡‘": "ê²€ë´‰ê¸ˆ", "é‡µé‡§é‡‘": "ì°¨ì²œê¸ˆ",
    "å¤§æ—æœ¨": "ëŒ€ë¦¼ëª©", "æ¥ŠæŸ³æœ¨": "ì–‘ë¥˜ëª©", "æ¾æŸæœ¨": "ì†¡ë°±ëª©", "å¹³åœ°æœ¨": "í‰ì§€ëª©", "æ¡‘æ‹“æœ¨": "ìƒìëª©", "çŸ³æ¦´æœ¨": "ì„ë¥˜ëª©",
    "æ¾—ä¸‹æ°´": "ê°„í•˜ìˆ˜", "å¤§æºªæ°´": "ëŒ€ê³„ìˆ˜", "é•·æµæ°´": "ì¥ë¥˜ìˆ˜", "å¤©æ²³æ°´": "ì²œí•˜ìˆ˜", "å¤§æµ·æ°´": "ëŒ€í•´ìˆ˜", "æ³‰ä¸­æ°´": "ì²œì¤‘ìˆ˜",
    "ç‚‰ä¸­ç«": "ë…¸ì¤‘í™”", "å±±é ­ç«": "ì‚°ë‘í™”", "éœ¹é‚ç«": "ë²½ë ¥í™”", "è¦†ç‡ˆç«": "ë³µë“±í™”", "å¤©ä¸Šç«": "ì²œìƒí™”", "å±±ä¸‹ç«": "ì‚°í•˜í™”",
    "è·¯å‚åœŸ": "ë…¸ë°©í† ", "åŸé ­åœŸ": "ì„±ë‘í† ", "å±‹ä¸ŠåœŸ": "ì˜¥ìƒí† ", "å£ä¸ŠåœŸ": "ë²½ìƒí† ", "å¤§é©›åœŸ": "ëŒ€ì—­í† ", "æ²™ä¸­åœŸ": "ì‚¬ì¤‘í† "
};

// ì˜¤í–‰ë³„ í•œì/ì˜ì–´
const ohangInfo = {
    "ê¸ˆ": { hanja: "é‡‘", eng: "METAL" },
    "ëª©": { hanja: "æœ¨", eng: "WOOD" },
    "ìˆ˜": { hanja: "æ°´", eng: "WATER" },
    "í™”": { hanja: "ç«", eng: "FIRE" },
    "í† ": { hanja: "åœŸ", eng: "EARTH" }
};

// ì¸ì—°ìƒ/ë°°ìš°ììƒ ë„ì¶œ ê·œì¹™ (ì˜¤í–‰ ìƒìƒ)
const inyunRule = {
    "ê¸ˆ": "ìˆ˜", "ìˆ˜": "ëª©", "ëª©": "í™”", "í™”": "í† ", "í† ": "ê¸ˆ"
};
const baeujaRule = {
    "ê¸ˆ": "í† ", "í† ": "í™”", "í™”": "ëª©", "ëª©": "ìˆ˜", "ìˆ˜": "ê¸ˆ"
};

// ì˜¤í–‰ë³„ ëŒ€í‘œ ë‚©ìŒ
const ohangToNapeum = {
    "ê¸ˆ": ["í•´ì¤‘ê¸ˆ", "ê²€ë´‰ê¸ˆ", "ì‚¬ì¤‘ê¸ˆ", "ë°±ë‚©ê¸ˆ", "ì°¨ì²œê¸ˆ", "ê¸ˆë°•ê¸ˆ"],
    "ëª©": ["ëŒ€ë¦¼ëª©", "ì–‘ë¥˜ëª©", "ì†¡ë°±ëª©", "í‰ì§€ëª©", "ìƒìëª©", "ì„ë¥˜ëª©"],
    "ìˆ˜": ["ê°„í•˜ìˆ˜", "ëŒ€ê³„ìˆ˜", "ì¥ë¥˜ìˆ˜", "ì²œí•˜ìˆ˜", "ëŒ€í•´ìˆ˜", "ì²œì¤‘ìˆ˜"],
    "í™”": ["ë…¸ì¤‘í™”", "ì‚°ë‘í™”", "ë²½ë ¥í™”", "ë³µë“±í™”", "ì²œìƒí™”", "ì‚°í•˜í™”"],
    "í† ": ["ë…¸ë°©í† ", "ì„±ë‘í† ", "ì˜¥ìƒí† ", "ë²½ìƒí† ", "ëŒ€ì—­í† ", "ì‚¬ì¤‘í† "]
};

// ============================================
// ë‚©ìŒ 30ì¢… ìƒ‰ìƒí‘œ (ê°œì„ ëœ í™”ì‚¬í•œ ë²„ì „)
// ============================================
const napeumColors = {
    // ê¸ˆ ê³„ì—´ - ì‹¤ë²„~ê³¨ë“œ ê·¸ë¼ë°ì´ì…˜
    "í•´ì¤‘ê¸ˆ": { hair: ["#3d4a5a", "#2a3545"], dress: ["#a8c8e8", "#88b0d8"], accent: "#c8e0f8", pattern: "wave" },
    "ê²€ë´‰ê¸ˆ": { hair: ["#454550", "#35353f"], dress: ["#c0c0cc", "#a8a8b8"], accent: "#d8d8e8", pattern: "sharp" },
    "ì‚¬ì¤‘ê¸ˆ": { hair: ["#5a4838", "#483828"], dress: ["#f0e0c0", "#e0d0a8"], accent: "#f8e8d0", pattern: "dots" },
    "ë°±ë‚©ê¸ˆ": { hair: ["#505058", "#404048"], dress: ["#f8f8ff", "#e8e8f0"], accent: "#ffffff", pattern: "shimmer" },
    "ì°¨ì²œê¸ˆ": { hair: ["#4a3a48", "#382838"], dress: ["#e8c8b8", "#d8b0a0"], accent: "#f0d8c8", pattern: "elegant" },
    "ê¸ˆë°•ê¸ˆ": { hair: ["#4a4028", "#3a3018"], dress: ["#ffd870", "#f0c850"], accent: "#ffe890", pattern: "flake" },
    // í™” ê³„ì—´ - ë”°ëœ»í•˜ê³  í™”ì‚¬í•˜ê²Œ
    "ë…¸ì¤‘í™”": { hair: ["#5a3525", "#482818"], dress: ["#ff7860", "#f06048"], accent: "#ff9878", pattern: "flame" },
    "ì‚°ë‘í™”": { hair: ["#4a2820", "#3a1810"], dress: ["#ff8868", "#f07050"], accent: "#ffa080", pattern: "peak" },
    "ë³µë“±í™”": { hair: ["#5a4028", "#483018"], dress: ["#ffb868", "#f0a050"], accent: "#ffd088", pattern: "glow" },
    "ì²œìƒí™”": { hair: ["#604018", "#503008"], dress: ["#ffc040", "#f0a820"], accent: "#ffd868", pattern: "sun" },
    "ë²½ë ¥í™”": { hair: ["#403050", "#302040"], dress: ["#c888e8", "#b070d8"], accent: "#e0a8ff", pattern: "lightning" },
    "ì‚°í•˜í™”": { hair: ["#5a3830", "#483020"], dress: ["#f08878", "#e07060"], accent: "#ffa898", pattern: "ember" },
    // í†  ê³„ì—´ - ë”°ëœ»í•œ ëŒ€ì§€
    "ë…¸ë°©í† ": { hair: ["#5a4838", "#483828"], dress: ["#e8c898", "#d8b080"], accent: "#f0d8a8", pattern: "path" },
    "ì„±ë‘í† ": { hair: ["#4a4035", "#3a3025"], dress: ["#c8a890", "#b89078"], accent: "#d8b8a0", pattern: "brick" },
    "ëŒ€ì—­í† ": { hair: ["#584538", "#483528"], dress: ["#d8b090", "#c8a078"], accent: "#e8c8a8", pattern: "tile" },
    "ë²½ìƒí† ": { hair: ["#504540", "#403530"], dress: ["#e0d0c0", "#d0c0a8"], accent: "#f0e0d0", pattern: "wall" },
    "ì‚¬ì¤‘í† ": { hair: ["#685038", "#584028"], dress: ["#f0dbb0", "#e0c898"], accent: "#f8e8c8", pattern: "sand" },
    "ì˜¥ìƒí† ": { hair: ["#4a4035", "#3a3025"], dress: ["#b8a088", "#a89070"], accent: "#c8b0a0", pattern: "roof" },
    // ëª© ê³„ì—´ - ìì—°ìŠ¤ëŸ¬ìš´ ì´ˆë¡
    "ëŒ€ë¦¼ëª©": { hair: ["#3a4530", "#283520"], dress: ["#78c878", "#58b858"], accent: "#98e098", pattern: "forest" },
    "ì–‘ë¥˜ëª©": { hair: ["#485040", "#384030"], dress: ["#a8d888", "#90c870"], accent: "#c0f0a8", pattern: "willow" },
    "ì†¡ë°±ëª©": { hair: ["#2a3828", "#1a2818"], dress: ["#58a878", "#408860"], accent: "#78c898", pattern: "pine" },
    "í‰ì§€ëª©": { hair: ["#555045", "#454035"], dress: ["#c8e8a0", "#b0d880"], accent: "#e0f8b8", pattern: "field" },
    "ìƒìëª©": { hair: ["#4a4535", "#3a3525"], dress: ["#90c070", "#78a858"], accent: "#b0d890", pattern: "mulberry" },
    "ì„ë¥˜ëª©": { hair: ["#4a3530", "#3a2520"], dress: ["#88c868", "#70b050"], accent: "#a8e088", pattern: "fruit" },
    // ìˆ˜ ê³„ì—´ - ê¹Šê³  ë§‘ì€ íŒŒë‘
    "ëŒ€í•´ìˆ˜": { hair: ["#354560", "#253550"], dress: ["#68a8e8", "#5090d8"], accent: "#88c8f8", pattern: "ocean" },
    "ì²œí•˜ìˆ˜": { hair: ["#404060", "#303050"], dress: ["#88a8e8", "#7090d8"], accent: "#a8c8f8", pattern: "galaxy" },
    "ì¥ë¥˜ìˆ˜": { hair: ["#3a4855", "#2a3845"], dress: ["#70b8d8", "#58a0c8"], accent: "#90d0f0", pattern: "river" },
    "ì²œì¤‘ìˆ˜": { hair: ["#405060", "#304050"], dress: ["#88d0e8", "#70c0d8"], accent: "#a8e8f8", pattern: "spring" },
    "ëŒ€ê³„ìˆ˜": { hair: ["#354555", "#253545"], dress: ["#78c0e0", "#60a8d0"], accent: "#98d8f0", pattern: "valley" },
    "ê°„í•˜ìˆ˜": { hair: ["#3a5058", "#2a4048"], dress: ["#80d0d8", "#68c0c8"], accent: "#a0e8f0", pattern: "stream" }
};

// ============================================
// íŒ¨í„´ SVG (ì˜· ë¬´ëŠ¬)
// ============================================
const patternSVG = {
    "wave": `<path d="M0,5 Q5,0 10,5 T20,5" stroke="rgba(255,255,255,0.5)" stroke-width="2" fill="none"/>`,
    "sharp": `<path d="M0,15 L10,0 L20,15" stroke="rgba(255,255,255,0.4)" stroke-width="2" fill="none"/>`,
    "dots": `<circle cx="10" cy="10" r="3" fill="rgba(255,255,255,0.4)"/>`,
    "shimmer": `<rect x="5" y="5" width="10" height="10" fill="rgba(255,255,255,0.3)" transform="rotate(45,10,10)"/>`,
    "elegant": `<path d="M0,10 C5,0 15,20 20,10" stroke="rgba(255,255,255,0.4)" stroke-width="2" fill="none"/>`,
    "flake": `<polygon points="10,0 12,8 20,10 12,12 10,20 8,12 0,10 8,8" fill="rgba(255,215,0,0.4)"/>`,
    "flame": `<path d="M10,18 Q6,10 10,0 Q14,10 10,18" fill="rgba(255,100,0,0.4)"/>`,
    "peak": `<path d="M0,18 L10,2 L20,18" fill="rgba(255,150,0,0.3)"/>`,
    "glow": `<circle cx="10" cy="10" r="8" fill="rgba(255,200,100,0.3)"/>`,
    "sun": `<circle cx="10" cy="10" r="6" fill="rgba(255,220,0,0.4)"/>`,
    "lightning": `<path d="M6,0 L10,8 L14,8 L8,20 L10,12 L6,12 Z" fill="rgba(200,150,255,0.4)"/>`,
    "ember": `<circle cx="10" cy="12" r="5" fill="rgba(255,100,50,0.4)"/>`,
    "path": `<rect x="0" y="8" width="20" height="4" fill="rgba(180,140,100,0.3)"/>`,
    "brick": `<rect x="0" y="0" width="8" height="6" fill="rgba(150,120,100,0.3)"/><rect x="10" y="10" width="8" height="6" fill="rgba(150,120,100,0.3)"/>`,
    "tile": `<rect x="0" y="0" width="18" height="18" stroke="rgba(150,120,100,0.4)" stroke-width="2" fill="none"/>`,
    "wall": `<line x1="0" y1="10" x2="20" y2="10" stroke="rgba(180,160,140,0.4)" stroke-width="2"/>`,
    "sand": `<circle cx="5" cy="6" r="2" fill="rgba(200,180,140,0.5)"/><circle cx="15" cy="14" r="2" fill="rgba(200,180,140,0.5)"/>`,
    "roof": `<path d="M0,15 L10,2 L20,15" stroke="rgba(120,100,80,0.5)" stroke-width="2" fill="none"/>`,
    "forest": `<path d="M10,18 L10,10 M6,12 L10,8 L14,12" stroke="rgba(100,150,80,0.5)" stroke-width="2" fill="none"/>`,
    "pine": `<path d="M10,0 L5,10 L15,10 Z M10,8 L3,18 L17,18 Z" fill="rgba(60,100,70,0.35)"/>`,
    "fruit": `<circle cx="10" cy="8" r="5" fill="rgba(200,100,100,0.45)"/>`,
    "willow": `<path d="M10,0 Q5,10 10,20 M10,0 Q15,10 10,20" stroke="rgba(130,170,100,0.45)" stroke-width="2" fill="none"/>`,
    "mulberry": `<circle cx="6" cy="10" r="4" fill="rgba(120,150,90,0.35)"/><circle cx="14" cy="10" r="4" fill="rgba(120,150,90,0.35)"/>`,
    "field": `<line x1="0" y1="16" x2="20" y2="16" stroke="rgba(150,180,110,0.4)" stroke-width="2"/>`,
    "ocean": `<path d="M0,6 Q5,2 10,6 T20,6 M0,14 Q5,10 10,14 T20,14" stroke="rgba(100,150,200,0.5)" stroke-width="2" fill="none"/>`,
    "galaxy": `<circle cx="5" cy="6" r="2" fill="rgba(200,200,255,0.5)"/><circle cx="15" cy="14" r="2" fill="rgba(200,200,255,0.5)"/>`,
    "river": `<path d="M0,10 C6,5 14,15 20,10" stroke="rgba(100,150,200,0.5)" stroke-width="2.5" fill="none"/>`,
    "spring": `<circle cx="10" cy="10" r="7" stroke="rgba(150,220,230,0.5)" stroke-width="2" fill="none"/>`,
    "valley": `<path d="M0,2 L10,16 L20,2" stroke="rgba(80,130,180,0.4)" stroke-width="2" fill="none"/>`,
    "stream": `<path d="M0,6 Q10,2 20,6 M0,14 Q10,18 20,14" stroke="rgba(100,180,200,0.5)" stroke-width="2" fill="none"/>`
};

// ============================================
// í”¼ë¶€í†¤ 7ì¢… (í•˜ì–€ê±´ 1ê°œë§Œ, ë‚˜ë¨¸ì§€ ì°¨ì´ í™•ì‹¤í•˜ê²Œ)
// ============================================
const skinColors = {
    "ë§‘ê³  í°ë¹›": { base: "#FFFAF8", shadow: "#FFE8E0", neck: "#F5D8D0", highlight: "#FFFFFF", blush: "#FF9999" },
    "ë°ê³  í°ë¹›": { base: "#FFEFEA", shadow: "#FFD8D0", neck: "#F0C8C0", highlight: "#FFFFFF", blush: "#FFA5A5" },
    "íˆ¬ëª…í•œ í°ë¹›": { base: "#FFE8E8", shadow: "#FFD0D0", neck: "#F0C0C0", highlight: "#FFF8F8", blush: "#FF8888" },
    "ë”°ëœ»í•œ ë¶‰ì€ê¸°": { base: "#FFDDD0", shadow: "#FFC5B5", neck: "#E8B0A0", highlight: "#FFF5F0", blush: "#FF8080" },
    "ë…¸ë€ê¸° ë„ëŠ” ê±´ê°• í†¤": { base: "#FFE0C5", shadow: "#F5C8A8", neck: "#E0B090", highlight: "#FFF5EA", blush: "#F5A090" },
    "ìì—°ìŠ¤ëŸ¬ìš´ ë² ì´ì§€ í†¤": { base: "#EED0C0", shadow: "#D8B8A8", neck: "#C8A090", highlight: "#FFF0E8", blush: "#E09088" },
    "ë”°ëœ»í•œ ë„ëŠ” ê±´ê°• í†¤": { base: "#E0C0B0", shadow: "#C8A898", neck: "#B89080", highlight: "#FFEBE5", blush: "#D88880" }
};

// ============================================
// ì™¸ëª¨ ë§¤í•‘ (í•œê¸€ â†’ ì½”ë“œ)
// ============================================
const skinByName = {
    "í° í”¼ë¶€": { base: "#FFFAF8", shadow: "#FFE8E0", neck: "#F5D8D0", highlight: "#FFFFFF", blush: "#FF9999" },
    "ì›œí†¤": { base: "#FFEEE5", shadow: "#F5D8D0", neck: "#E8C8B8", highlight: "#FFF8F5", blush: "#F5A090" },
    "ì¿¨í†¤": { base: "#FFF0F5", shadow: "#FFD8E0", neck: "#F0C0C8", highlight: "#FFFFFF", blush: "#FF88AA" },
    "ìì—°í†¤": { base: "#EED0C0", shadow: "#D8B8A8", neck: "#C8A090", highlight: "#FFF0E8", blush: "#E09088" },
    "ê±´ê°•í†¤": { base: "#F5D0C5", shadow: "#E8B8A8", neck: "#D8A090", highlight: "#FFF0E8", blush: "#E88080" }
};

const eyeByName = {
    "ë°ì€ ëˆˆ": {
        isClosed: false,
        pupil: { rx: 5, ry: 5, color: "#1a1a20" },
        highlight: { r: 2.2, opacity: 0.98, offsetX: 1.5, offsetY: -1.5 },
        highlight2: { r: 1.3, opacity: 0.7, offsetX: -1.5, offsetY: 1.5 }
    },
    "ê¹Šì€ ëˆˆ": {
        isClosed: false,
        pupil: { rx: 5, ry: 5, color: "#1a1515" },
        highlight: { r: 1.8, opacity: 0.9, offsetX: 2, offsetY: -2 }
    },
    "ë‚ ì¹´ë¡œìš´ ëˆˆ": {
        isClosed: false,
        isAlmond: true,
        pupil: { rx: 4.5, ry: 4.5, color: "#0a0a15" },
        highlight: { r: 1.5, opacity: 0.9, offsetX: 1, offsetY: -1 }
    },
    "ë”°ëœ»í•œ ëˆˆ": {
        isClosed: true,
        closedPath: "M-8,0 Q0,-6, 8,0",
        strokeWidth: 2,
        strokeColor: "#3a2510"
    },
    "ë§‘ì€ ëˆˆ": {
        isClosed: false,
        pupil: { rx: 4.5, ry: 4.5, color: "#252530" },
        highlight: { r: 1.8, opacity: 0.95, offsetX: 1.2, offsetY: -1.2 }
    }
};

const faceByName = {
    "ë‘¥ê·¼í˜•": { rx: 30, ry: 32, usePath: false },
    "ê³„ë€í˜•": { rx: 27, ry: 33, usePath: false },
    "ê°ì§„í˜•": { usePath: true, path: "M-26,-25 Q-28,5 -22,28 Q0,35 22,28 Q28,5 26,-25 Q0,-32 -26,-25" },
    "ê¸´í˜•": { rx: 25, ry: 36, usePath: false },
    "í•˜íŠ¸í˜•": { usePath: true, path: "M-28,-12 Q-30,5 -15,24 L0,32 L15,24 Q30,5 28,-12 Q14,-26 0,-28 Q-14,-26 -28,-12" }
};

// ============================================
// ëˆˆ ìŠ¤íƒ€ì¼ - ë‚¨ë…€ ë¶„ë¦¬ + ì˜¤í–‰ë³„ (v4)
// ============================================
const eyeShapes = {
  
  // ========== ë‚¨ì„± ëˆˆ ìŠ¤íƒ€ì¼ ==========
  ë‚¨: {
    // ê¸ˆ - ë‚ ì¹´ë¡œìš´ ëˆˆ
    ê¸ˆ: {
      type: "sharp",
      isClosed: false,
      pupil: { rx: 4, ry: 4, color: "#1a1a25" },
      highlight: { r: 1.2, opacity: 0.8, offsetX: 1, offsetY: -1 },
      eyebrow: { strokeWidth: 2, color: "#2d2d3a" }
    },
    // ëª© - ë¶€ë“œëŸ½ê²Œ ê°ì€ ëˆˆ
    ëª©: {
      type: "closed_soft",
      isClosed: true,
      closedPath: "M-6,0 Q0,-5, 6,0",
      strokeWidth: 2,
      strokeColor: "#2a1d14",
      eyebrow: { strokeWidth: 1.5, color: "#3d2b1f" }
    },
    // ìˆ˜ - ê¹Šê³  ì´‰ì´‰í•œ ëˆˆ
    ìˆ˜: {
      type: "deep",
      isClosed: false,
      pupil: { rx: 5, ry: 5, color: "#1a1515" },
      highlight: { r: 1.8, opacity: 0.9, offsetX: 2, offsetY: -2 },
      eyebrow: { strokeWidth: 1.8, color: "#2a2525" }
    },
    // í™” - ê°•ë ¬í•œ ëˆˆ
    í™”: {
      type: "intense",
      isClosed: false,
      pupil: { rx: 5, ry: 5, color: "#2a1810" },
      highlight: { r: 1.8, opacity: 0.95, offsetX: 2, offsetY: -2 },
      eyebrow: { strokeWidth: 2.2, color: "#4a3028" }
    },
    // í†  - í¸ì•ˆí•˜ê²Œ ê°ì€ ëˆˆ
    í† : {
      type: "closed_relaxed",
      isClosed: true,
      closedPath: "M-8,0 Q0,-6, 8,0",
      strokeWidth: 2.2,
      strokeColor: "#3a2510",
      eyebrow: { strokeWidth: 1.8, color: "#5a4530" }
    }
  },
  
  // ========== ì—¬ì„± ëˆˆ ìŠ¤íƒ€ì¼ ==========
  ì—¬: {
    // ê¸ˆ - ì„¸ë ¨ëœ ëˆˆ
    ê¸ˆ: {
      type: "elegant",
      isClosed: false,
      pupil: { rx: 4, ry: 5, color: "#0a0a12" },
      highlight: { r: 1.5, opacity: 0.9, offsetX: 1, offsetY: -2 },
      eyebrow: null
    },
    // ëª© - ë§‘ê³  ë¶€ë“œëŸ¬ìš´ ëˆˆ
    ëª©: {
      type: "clear_soft",
      isClosed: false,
      pupil: { rx: 4.5, ry: 5.5, color: "#2a2015" },
      highlight: { r: 1.8, opacity: 0.9, offsetX: 2, offsetY: -2 },
      eyebrow: null
    },
    // ìˆ˜ - í¬ê³  ì´‰ì´‰í•œ ëˆˆ (í•˜ì´ë¼ì´íŠ¸ 2ê°œ)
    ìˆ˜: {
      type: "big_moist",
      isClosed: false,
      pupil: { rx: 5, ry: 6, color: "#1a0a05" },
      highlight: { r: 2, opacity: 0.9, offsetX: 2, offsetY: -2 },
      highlight2: { r: 1, opacity: 0.5, offsetX: -2, offsetY: 2 },
      eyebrow: null
    },
    // í™” - ë°ê³  ê°•ë ¬í•œ ëˆˆ
    í™”: {
      type: "bright_intense",
      isClosed: false,
      pupil: { rx: 5, ry: 6, color: "#1a0805" },
      highlight: { r: 2, opacity: 0.95, offsetX: 2, offsetY: -2 },
      eyebrow: null
    },
    // í†  - ë”°ëœ»í•˜ê²Œ ê°ì€ ëˆˆ
    í† : {
      type: "closed_warm",
      isClosed: true,
      closedPath: "M-8,0 Q0,-6, 8,0",
      strokeWidth: 2.5,
      strokeColor: "#3a2010",
      eyebrow: null
    }
  }
};

// ============================================
// ì–¼êµ´í˜• - ë‚¨ë…€ ë¶„ë¦¬ + ì˜¤í–‰ë³„ (v4)
// ============================================
const faceShapes = {
  
  // ========== ë‚¨ì„± ì–¼êµ´í˜• ==========
  ë‚¨: {
    ê¸ˆ: { type: "angular", usePath: true, path: "M-28,-18 Q-28,-28, 0,-31 Q28,-28, 28,-18 L28,7 Q28,32, 0,37 Q-28,32, -28,7 Z" },
    ëª©: { type: "long_soft", usePath: false, rx: 28, ry: 38 },
    ìˆ˜: { type: "round", usePath: false, rx: 30, ry: 36 },
    í™”: { type: "normal", usePath: false, rx: 28, ry: 34 },
    í† : { type: "wide_stable", usePath: false, rx: 32, ry: 36 }
  },
  
  // ========== ì—¬ì„± ì–¼êµ´í˜• ==========
  ì—¬: {
    ê¸ˆ: { type: "angular_elegant", usePath: true, path: "M-25,-12 Q-25,-25, 0,-28 Q25,-25, 25,-12 L25,15 Q25,38, 0,42 Q-25,38, -25,15 Z" },
    ëª©: { type: "soft", usePath: false, rx: 28, ry: 32 },
    ìˆ˜: { type: "round", usePath: false, rx: 30, ry: 36 },
    í™”: { type: "slightly_long", usePath: false, rx: 28, ry: 35 },
    í† : { type: "soft_round", usePath: false, rx: 30, ry: 32 }
  }
};

// ============================================
// ë¨¸ë¦¬ ìŠ¤íƒ€ì¼ - ë‚¨ë…€ ë¶„ë¦¬ + ì˜¤í–‰ë³„ (v4)
// ============================================
const hairStyles = {
  
  // ========== ë‚¨ì„± ë¨¸ë¦¬ ìŠ¤íƒ€ì¼ ==========
  ë‚¨: {
    ê¸ˆ: {
      type: "short_tight",
      layers: [
        { type: "ellipse", cx: 70, cy: 52, rx: 32, ry: 26 },
        { type: "path", d: "M46 52 Q46 40, 70 38 Q94 40, 94 52 Q86 48, 70 46 Q54 48, 46 52" }
      ]
    },
    ëª©: {
      type: "natural_long",
      layers: [
        { type: "ellipse", cx: 70, cy: 50, rx: 40, ry: 36 },
        { type: "path", d: "M38 55 Q38 30, 70 26 Q102 30, 102 55 Q90 42, 70 40 Q50 42, 38 55" }
      ]
    },
    ìˆ˜: {
      type: "wavy",
      layers: [
        { type: "ellipse", cx: 70, cy: 50, rx: 38, ry: 32 },
        { type: "path", d: "M38 54 Q40 32, 70 28 Q100 32, 102 54 Q88 42, 70 40 Q52 42, 38 54" },
        { type: "wave", d: "M42 38 Q50 34, 58 38 Q66 42, 74 38 Q82 34, 90 38" },
        { type: "wave", d: "M38 48 Q46 44, 54 48 Q62 52, 70 48 Q78 44, 86 48 Q94 52, 102 48" }
      ]
    },
    í™”: {
      type: "spiky",
      layers: [
        { type: "ellipse", cx: 70, cy: 48, rx: 36, ry: 28 },
        { type: "path", d: "M50 35 L55 28 L60 38" },
        { type: "path", d: "M65 32 L70 24 L75 32" },
        { type: "path", d: "M80 35 L85 28 L90 38" },
        { type: "path", d: "M44 50 Q44 36, 70 32 Q96 36, 96 50 Q86 44, 70 42 Q54 44, 44 50" }
      ]
    },
    í† : {
      type: "neat_short",
      layers: [
        { type: "ellipse", cx: 70, cy: 50, rx: 38, ry: 32 },
        { type: "path", d: "M40 52 Q40 34, 70 30 Q100 34, 100 52 Q88 44, 70 42 Q52 44, 40 52" }
      ]
    }
  },
  
  // ========== ì—¬ì„± ë¨¸ë¦¬ ìŠ¤íƒ€ì¼ ==========
  ì—¬: {
    ê¸ˆ: {
      type: "long_straight",
      layers: [
        { type: "ellipse", cx: 70, cy: 85, rx: 38, ry: 55, order: 0 },
        { type: "path", d: "M30 55 Q30 35, 70 30 Q110 35, 110 55 L100 55 Q100 45, 70 42 Q40 45, 40 55 Z", order: 2 },
        { type: "path", d: "M30 55 L30 150 Q35 155, 40 150 L40 60 Z", order: 2 },
        { type: "path", d: "M110 55 L110 150 Q105 155, 100 150 L100 60 Z", order: 2 },
        { type: "path", d: "M45 55 Q45 38, 70 35 Q95 38, 95 55 Q85 48, 70 46 Q55 48, 45 55", order: 3 }
      ]
    },
    ëª©: {
      type: "twin_tails",
      layers: [
        { type: "ellipse", cx: 70, cy: 55, rx: 40, ry: 38, order: 0 },
        { type: "path", d: "M30 55 Q28 70, 35 90 L42 86 Q36 68, 38 55", order: 1 },
        { type: "path", d: "M110 55 Q112 70, 105 90 L98 86 Q104 68, 102 55", order: 1 },
        { type: "path", d: "M42 55 Q42 28, 70 22 Q98 28, 98 55 Q88 48, 70 45 Q52 48, 42 55", order: 3 },
        { type: "ellipse", cx: 28, cy: 75, rx: 10, ry: 35, order: 4 },
        { type: "ellipse", cx: 112, cy: 75, rx: 10, ry: 35, order: 4 }
      ]
    },
    ìˆ˜: {
      type: "big_wave",
      layers: [
        { type: "ellipse", cx: 70, cy: 70, rx: 50, ry: 58, order: 0 },
        { type: "ellipse", cx: 70, cy: 38, rx: 36, ry: 20, order: 3 }
      ]
    },
    í™”: {
      type: "short_bob",
      layers: [
        { type: "ellipse", cx: 70, cy: 52, rx: 38, ry: 32, order: 1 },
        { type: "path", d: "M32 52 L32 95 Q38 100, 42 95 L42 58", order: 2 },
        { type: "path", d: "M108 52 L108 95 Q102 100, 98 95 L98 58", order: 2 },
        { type: "path", d: "M42 55 Q42 38, 70 35 Q98 38, 98 55 Q88 48, 70 46 Q52 48, 42 55", order: 3 }
      ]
    },
    í† : {
      type: "bun",
      layers: [
        { type: "ellipse", cx: 70, cy: 20, rx: 14, ry: 12, order: 0 },
        { type: "ellipse", cx: 70, cy: 55, rx: 40, ry: 38, order: 1 },
        { type: "path", d: "M30 55 Q28 70, 35 82 L42 78 Q36 68, 38 55", order: 2 },
        { type: "path", d: "M110 55 Q112 70, 105 82 L98 78 Q104 68, 102 55", order: 2 },
        { type: "path", d: "M40 55 Q40 38, 70 35 Q100 38, 100 55 Q88 48, 70 46 Q52 48, 40 55", order: 3 }
      ]
    }
  }
};

// ============================================
// ì˜¤í–‰ë³„ ì™¸ëª¨ ê¸°ë³¸ê°’
// ============================================
const ohangAppearance = {
    "ê¸ˆ": { ì–¼êµ´í˜•: "ê°ì§„ ì–¼êµ´, ìœ¤ê³½ì´ ëšœë ·í•¨", ëˆˆ: "ëƒ‰ì² í•˜ê³  ì§‘ì¤‘ëœ ëˆˆë¹›", í”¼ë¶€í†¤: "ë§‘ê³  í°ë¹›", ë¶„ìœ„ê¸°: "ì§€ì ì´ê³  ì„¸ë ¨ëœ ì¸ìƒ" },
    "ëª©": { ì–¼êµ´í˜•: "ê¸¸ì­‰í•œ ì–¼êµ´í˜•, ì´ë§ˆê°€ ë„“ìŒ", ëˆˆ: "ê³§ê³  ë§‘ì€ ëˆˆë¹›", í”¼ë¶€í†¤: "ìì—°ìŠ¤ëŸ¬ìš´ ë² ì´ì§€ í†¤", ë¶„ìœ„ê¸°: "ì˜¨í™”í•˜ê³  ìƒëª…ë ¥ ìˆëŠ” ì¸ìƒ" },
    "ìˆ˜": { ì–¼êµ´í˜•: "ë‘¥ê¸€ê³  ë¶€ë“œëŸ¬ìš´ ì–¼êµ´", ëˆˆ: "ê¹Šê³  ê°ì„±ì ì¸ ëˆˆë¹›", í”¼ë¶€í†¤: "íˆ¬ëª…í•œ í°ë¹›", ë¶„ìœ„ê¸°: "ì°¨ë¶„í•˜ê³  ì‹ ë¹„ë¡œìš´ ì¸ìƒ" },
    "í™”": { ì–¼êµ´í˜•: "ê°¸ë¦„í•˜ê³  ìƒê¸° ìˆëŠ” ì–¼êµ´", ëˆˆ: "ë°ê³  ê°•ë ¬í•œ ëˆˆë¹›", í”¼ë¶€í†¤: "ë”°ëœ»í•œ ë¶‰ì€ê¸°", ë¶„ìœ„ê¸°: "ì—´ì •ì ì´ê³  ìƒë™ê° ìˆëŠ” ì¸ìƒ" },
    "í† ": { ì–¼êµ´í˜•: "ë‘¥ê·¼ ì–¼êµ´, ì•ˆì •ê° ìˆëŠ” ìœ¤ê³½", ëˆˆ: "ë”°ëœ»í•˜ê³  í¬ê·¼í•œ ëˆˆë¹›", í”¼ë¶€í†¤: "ë…¸ë€ê¸° ë„ëŠ” ê±´ê°• í†¤", ë¶„ìœ„ê¸°: "ì‹ ë¢°ê° ìˆê³  ì°¨ë¶„í•œ ì¸ìƒ" }
};

// ============================================
// JSON ë³µë¶™ ëª¨ë“œì—ì„œ ìƒì„±
// ============================================
function generateFromJSON() {
    const jsonText = document.getElementById('json-input').value.trim();
    const errorDiv = document.getElementById('json-error');
    
    if (!jsonText) {
        errorDiv.textContent = "JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”!";
        errorDiv.classList.add('show');
        return;
    }
    
    try {
        const result = JSON.parse(jsonText);
        errorDiv.classList.remove('show');
        
        // í•„ìˆ˜ í•„ë“œ í™•ì¸
        if (!result.ì¸ì—°ìƒ || !result.ë°°ìš°ììƒ) {
            throw new Error("ì¸ì—°ìƒ/ë°°ìš°ììƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");
        }
        
        renderResult(result);
    } catch (e) {
        errorDiv.textContent = "JSON íŒŒì‹± ì˜¤ë¥˜: " + e.message;
        errorDiv.classList.add('show');
    }
}

// ============================================
// ê²°ê³¼ ë Œë”ë§ (ë‘˜ë‹¤ ì²˜ë¦¬ í¬í•¨)
// ============================================
function renderResult(result) {
    const targetGender = result.ì…ë ¥?.ìƒëŒ€ì„±ë³„ || "ì—¬";
    
    // ë³¸ì¸ ì •ë³´ (ë‚©ìŒì„ í•œìë¡œ í‘œì‹œí•˜ê¸° ìœ„í•œ ì—­ë³€í™˜)
    let myNapeumDisplay = result.ë³¸ì¸?.ë‚©ìŒ || "";
    const hangulToHanja = {};
    Object.entries(hanjaToHangul).forEach(([h, k]) => { hangulToHanja[k] = h; });
    if (hangulToHanja[myNapeumDisplay]) myNapeumDisplay = hangulToHanja[myNapeumDisplay];
    
    // ë³¸ì¸ ë¶„ìœ„ê¸° (ì™¸ëª¨ì—ì„œ ê°€ì ¸ì˜¤ê±°ë‚˜ ì˜¤í–‰ ê¸°ë³¸ê°’)
    const myOhang = result.ë³¸ì¸?.ì˜¤í–‰ || "í† ";
    let myMood = "";
    if (result.ì¸ì—°ìƒ?.ì™¸ëª¨?.ë‚¨?.ë¶„ìœ„ê¸° || result.ì¸ì—°ìƒ?.ì™¸ëª¨?.ì—¬?.ë¶„ìœ„ê¸°) {
        // ìƒˆ JSON êµ¬ì¡° - ë³¸ì¸ ë¶„ìœ„ê¸°ëŠ” ë³„ë„ë¡œ ì—†ìœ¼ë¯€ë¡œ ì˜¤í–‰ ê¸°ë³¸ê°’ ì‚¬ìš©
        myMood = ohangAppearance[myOhang]?.ë¶„ìœ„ê¸° || "";
    } else if (result.ì¸ì—°ìƒ?.ì™¸ëª¨?.ë¶„ìœ„ê¸°) {
        myMood = ohangAppearance[myOhang]?.ë¶„ìœ„ê¸° || "";
    } else {
        myMood = ohangAppearance[myOhang]?.ë¶„ìœ„ê¸° || "";
    }
    
    // ë³¸ì¸ ì •ë³´ HTML
    const userInfoHTML = `
        <div class="user-info">
            <h2>${myNapeumDisplay} Â· ${result.ì…ë ¥?.ì¼ì£¼ || ""} (ë³¸ì¸)</h2>
            <p>${myMood}</p>
        </div>
    `;
    
    let cardsHTML = "";
    
    // "ë‘˜ë‹¤" ì²˜ë¦¬
    if (targetGender === "ë‘˜ë‹¤") {
        // ë‚¨ì„± ê·¸ë£¹
        cardsHTML += `
            <div class="gender-group">
                <div class="gender-label"><span>â™‚</span> ë‚¨ì„± ì¸ì—°/ë°°ìš°ììƒ</div>
                <div class="cards-row">
                    ${createCard('ì¸ì—°ìƒ', result.ì¸ì—°ìƒ, 'ë‚¨')}
                    ${createCard('ë°°ìš°ììƒ', result.ë°°ìš°ììƒ, 'ë‚¨')}
                </div>
            </div>
        `;
        // ì—¬ì„± ê·¸ë£¹
        cardsHTML += `
            <div class="gender-group">
                <div class="gender-label"><span>â™€</span> ì—¬ì„± ì¸ì—°/ë°°ìš°ììƒ</div>
                <div class="cards-row">
                    ${createCard('ì¸ì—°ìƒ', result.ì¸ì—°ìƒ, 'ì—¬')}
                    ${createCard('ë°°ìš°ììƒ', result.ë°°ìš°ììƒ, 'ì—¬')}
                </div>
            </div>
        `;
    } else {
        // ë‹¨ì¼ ì„±ë³„
        cardsHTML = `
            <div class="cards-row">
                ${createCard('ì¸ì—°ìƒ', result.ì¸ì—°ìƒ, targetGender)}
                ${createCard('ë°°ìš°ììƒ', result.ë°°ìš°ììƒ, targetGender)}
            </div>
        `;
    }
    
    // ë©”íƒ€ë°ì´í„° (ìˆ¨ê¹€ - ì›ë³¸ JSON ì €ì¥)
    const metaJSON = JSON.stringify(result).replace(/"/g, '&quot;');
    const metaHTML = `<div style="display:none;" data-inyun-json="${metaJSON}"></div>`;
    
    // ê²°ê³¼ ë°•ìŠ¤ ì¡°í•©
    document.getElementById('result-content').innerHTML = `
        <div class="result-box">
            ${userInfoHTML}
            ${cardsHTML}
            ${metaHTML}
        </div>
    `;
    
    // ì›ë³¸ JSON ì €ì¥ (ë³µì‚¬ìš©)
    window.currentResultJSON = result;
    
    document.getElementById('result-section').classList.add('show');
    
    // â˜…â˜…â˜… localStorage ì €ì¥ (ì§ì ‘ ì‚¬ìš© ì‹œ) â˜…â˜…â˜…
    setTimeout(() => {
        const customerNameInput = document.getElementById('customer-name-input');
        const customerName = customerNameInput ? customerNameInput.value.trim() : '';
        if (customerName) {
            // copyResultHTMLê³¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì¸ë¼ì¸ CSS í¬í•¨ HTML ìƒì„±
            const resultBox = document.querySelector('.result-box');
            if (resultBox) {
                // ì¸ë¼ì¸ CSS (copyResultHTMLì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼)
                const inlineStyles = `<style>
.result-box{max-width:900px;width:calc(100% - 40px);margin:0 auto 30px;padding:30px;background:rgba(255,255,255,0.03);border-radius:24px;border:1px solid rgba(255,255,255,0.05);font-family:'Noto Sans KR',sans-serif;}
.user-info{text-align:center;margin-top:10px;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,0.1);}
.user-info h2{color:#fff;font-weight:400;font-size:22px;margin-bottom:10px;}
.user-info p{color:#888;font-size:14px;}
.gender-group{margin-bottom:30px;}
.gender-label{text-align:center;color:#aaa;font-size:14px;margin-bottom:20px;}
.cards-row{display:flex;gap:30px;justify-content:center;flex-wrap:nowrap;padding:0 20px;}
.card-wrapper{text-align:center;flex:0 0 auto;}
.card-label{color:#fff;font-size:16px;margin-bottom:15px;letter-spacing:2px;}
.card{width:260px;height:400px;border-radius:24px;position:relative;overflow:hidden;}
@media (max-width:700px){.card{width:200px;height:310px;}.cards-row{gap:15px;}.user-info h2{font-size:20px;}.user-info p{font-size:13px;}.card-label{font-size:14px;}}
.bg-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:200px;border-radius:50%;filter:blur(60px);opacity:0.4;}
.stars{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;}
.star{position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;opacity:0.6;}
.content{position:relative;z-index:1;height:100%;display:flex;flex-direction:column;align-items:center;padding:20px;}
.element-label{color:rgba(255,255,255,0.6);font-size:11px;letter-spacing:3px;margin-bottom:10px;}
.character-area{position:relative;width:140px;height:150px;margin:10px 0;display:flex;align-items:center;justify-content:center;}
.char-glow{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:100px;height:60px;border-radius:50%;filter:blur(25px);opacity:0.5;}
.info{text-align:center;margin-top:auto;}
.element-badge{display:inline-block;padding:6px 16px;border-radius:20px;font-size:14px;margin-bottom:8px;backdrop-filter:blur(10px);background:rgba(255,255,255,0.15);color:#fff;}
.element-name{font-size:16px;font-weight:500;color:#fff;margin-bottom:4px;}
.element-desc{font-size:12px;color:rgba(255,255,255,0.7);margin-bottom:8px;}
.napeum-info{font-size:11px;color:rgba(255,255,255,0.5);}
.card-ê¸ˆ{background:linear-gradient(160deg,#2a2a3e 0%,#1a1a2e 50%,#2d2d4a 100%);box-shadow:0 10px 40px rgba(192,192,220,0.15);}
.card-ê¸ˆ .bg-glow{background:radial-gradient(circle,rgba(192,192,220,0.6) 0%,transparent 70%);}
.card-ëª©{background:linear-gradient(160deg,#1a2e1a 0%,#0f1f0f 50%,#1a3a1a 100%);box-shadow:0 10px 40px rgba(100,180,100,0.15);}
.card-ëª© .bg-glow{background:radial-gradient(circle,rgba(100,180,100,0.5) 0%,transparent 70%);}
.card-ìˆ˜{background:linear-gradient(160deg,#1a2a3e 0%,#0f1a2e 50%,#1a3a5a 100%);box-shadow:0 10px 40px rgba(100,150,220,0.15);}
.card-ìˆ˜ .bg-glow{background:radial-gradient(circle,rgba(100,150,220,0.5) 0%,transparent 70%);}
.card-í™”{background:linear-gradient(160deg,#3e1a1a 0%,#2e0f0f 50%,#4a1a1a 100%);box-shadow:0 10px 40px rgba(220,100,80,0.15);}
.card-í™” .bg-glow{background:radial-gradient(circle,rgba(220,100,80,0.5) 0%,transparent 70%);}
.card-í† {background:linear-gradient(160deg,#2e2a1a 0%,#1e1a0f 50%,#3a351a 100%);box-shadow:0 10px 40px rgba(180,150,100,0.15);}
.card-í†  .bg-glow{background:radial-gradient(circle,rgba(180,150,100,0.5) 0%,transparent 70%);}
@media (max-width:600px){.result-box{width:calc(100% - 20px);padding:15px;}.cards-row{display:flex;gap:10px;justify-content:center;padding:0;}.card-wrapper{flex:0 0 auto;}.card{width:145px;height:225px;}.card-label{font-size:10px;}.element-label{font-size:8px;}.character-area{width:85px;height:110px;}.element-badge{padding:3px 10px;font-size:11px;}.element-name{font-size:12px;}.element-desc{font-size:9px;}.napeum-info{font-size:8px;}.user-info h2{font-size:14px;}.user-info p{font-size:10px;}.gender-label{font-size:11px;}.content{padding:12px;}}
</style>`;
                const wrapperStart = '<div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);padding:40px 20px;min-height:100vh;">';
                const wrapperEnd = '</div>';
                const savedHTML = inlineStyles + wrapperStart + resultBox.outerHTML + wrapperEnd;
                localStorage.setItem('inyeon_' + customerName, savedHTML);
                console.log('âœ… localStorage ì €ì¥:', 'inyeon_' + customerName, '(' + savedHTML.length + 'ì)');
                
                // UI í”¼ë“œë°±
                const btn = document.querySelector('.generate-btn');
                if (btn) {
                    const originalText = btn.textContent;
                    btn.textContent = 'âœ… ì €ì¥ë¨: ' + customerName;
                    btn.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '';
                    }, 2000);
                }
            }
        } else {
            console.log('âš ï¸ ì´ë¦„ ë¯¸ì…ë ¥ìœ¼ë¡œ localStorage ì €ì¥ ìƒëµ');
        }
    }, 100);  // DOM ì—…ë°ì´íŠ¸ í›„ ì‹¤í–‰
}

// ============================================
// ì¹´ë“œ HTML ìƒì„±
// ============================================
function createCard(type, data, gender) {
    // ë‚©ìŒ ë³€í™˜ (ì¼ì£¼ë„ì¶œë‚©ìŒ || ë„ì¶œë‚©ìŒ)
    let napeum = data.ì¼ì£¼ë„ì¶œë‚©ìŒ || data.ë„ì¶œë‚©ìŒ;
    if (hanjaToHangul[napeum]) napeum = hanjaToHangul[napeum];
    
    const ohang = data.ì˜¤í–‰ || napeumToOhang[napeum] || "í† ";
    const info = ohangInfo[ohang];
    
    // ì™¸ëª¨ ì²˜ë¦¬ (ì™¸ëª¨.ë‚¨/ì—¬ ë˜ëŠ” ì™¸ëª¨ ì§ì ‘)
    let appearance;
    if (data.ì™¸ëª¨?.ë‚¨ && data.ì™¸ëª¨?.ì—¬) {
        // ìƒˆ êµ¬ì¡°: { ì™¸ëª¨: { ë‚¨: {...}, ì—¬: {...} } }
        appearance = data.ì™¸ëª¨[gender] || ohangAppearance[ohang];
    } else if (data.ì™¸ëª¨) {
        // ê¸°ì¡´ êµ¬ì¡°: { ì™¸ëª¨: { ì–¼êµ´í˜•, ëˆˆ, ... } }
        appearance = data.ì™¸ëª¨;
    } else {
        appearance = ohangAppearance[ohang];
    }
    
    // SVG íŒŒë¼ë¯¸í„° ë³€í™˜
    const svgParams = convertToSVGParams(napeum, ohang, appearance, gender);
    
    // SVG ìƒì„±
    const svgContent = generateSVG(svgParams);
    
    // ì¹´ë“œ ë¼ë²¨
    const cardLabel = type === 'ì¸ì—°ìƒ' ? '<span>ğŸ’</span> ìš´ëª…ì˜ ì¸ì—°ìƒ' : '<span>ğŸ’</span> í˜„ì‹¤ì˜ ë°°ìš°ììƒ';
    
    return `
        <div class="card-wrapper">
            <div class="card-label">${cardLabel}</div>
            <div class="card card-${ohang}">
                <div class="bg-glow"></div>
                <div class="stars">
                    <div class="star" style="top:8%;left:15%;animation-delay:0.2s;"></div>
                    <div class="star" style="top:12%;left:75%;animation-delay:0.7s;"></div>
                    <div class="star" style="top:20%;left:85%;animation-delay:1.2s;"></div>
                    <div class="star" style="top:75%;left:10%;animation-delay:0.5s;"></div>
                    <div class="star" style="top:85%;left:80%;animation-delay:1.5s;"></div>
                </div>
                <div class="content">
                    <div class="element-label">${info.eng}</div>
                    <div class="character-area">
                        <div class="char-glow"></div>
                        ${svgContent}
                    </div>
                    <div class="info">
                        <div class="element-badge">${info.hanja}</div>
                        <div class="element-name">${ohang}ì˜ ê¸°ìš´</div>
                        <div class="element-desc">${appearance.ë¶„ìœ„ê¸° || ''}</div>
                        <div class="napeum-info">${napeum}</div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ============================================
// ë³€í™˜ í•¨ìˆ˜: ì™¸ëª¨ ë°ì´í„° â†’ SVG íŒŒë¼ë¯¸í„°
// ============================================
function convertToSVGParams(napeum, ohang, appearance, gender) {
    // ë‚©ìŒ ìƒ‰ìƒ
    const nColors = napeumColors[napeum] || napeumColors["ë…¸ë°©í† "];
    
    // í”¼ë¶€í†¤ (ìƒˆ ë§¤í•‘ ìš°ì„ )
    const skin = skinByName[appearance.í”¼ë¶€í†¤] || skinColors[appearance.í”¼ë¶€í†¤] || skinByName["ìì—°í†¤"];
    
    // ëˆˆ ìŠ¤íƒ€ì¼ (ìƒˆ ë§¤í•‘ ìš°ì„ )
    const eye = eyeByName[appearance.ëˆˆ] || eyeByName["ë§‘ì€ ëˆˆ"];
    
    // ì–¼êµ´í˜• (ìƒˆ ë§¤í•‘ ìš°ì„ )
    const face = faceByName[appearance.ì–¼êµ´í˜•] || faceByName["ë‘¥ê·¼í˜•"];
    
    // íŒ¨í„´
    const pattern = patternSVG[nColors.pattern] || "";
    
    return {
        napeum, ohang, gender,
        hairColor: nColors.hair,
        dressColor: nColors.dress,
        accent: nColors.accent,
        patternType: nColors.pattern,
        pattern,
        skin,
        eye,
        face
    };
}


// ============================================
// SVG ìƒì„± í•¨ìˆ˜ (v4 í†µí•© ìŠ¤íƒ€ì¼)
// ============================================
function generateSVG(params) {
    const { ohang, gender, hairColor, dressColor, skin, pattern, face, eye } = params;
    const id = `${ohang}-${gender}-${Math.random().toString(36).substr(2,5)}`;
    
    // ë¨¸ë¦¬ ìŠ¤íƒ€ì¼ë§Œ ì˜¤í–‰ë³„ë¡œ (ì–¼êµ´, ëˆˆì€ paramsì—ì„œ)
    const hair = hairStyles[gender]?.[ohang] || hairStyles.ë‚¨.í† ;
    
    // defs - ê·¸ë¼ë°ì´ì…˜
    let defs = `<defs>
        <linearGradient id="skin-${id}" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:${skin.base}"/>
            <stop offset="100%" style="stop-color:${skin.shadow}"/>
        </linearGradient>
        <linearGradient id="hair-${id}" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:${hairColor[0]}"/>
            <stop offset="100%" style="stop-color:${hairColor[1]}"/>
        </linearGradient>
        <linearGradient id="dress-${id}" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:${dressColor[0]}"/>
            <stop offset="100%" style="stop-color:${dressColor[1]}"/>
        </linearGradient>`;
    
    // íŒ¨í„´ ì •ì˜
    if (pattern) {
        defs += `<pattern id="pat-${id}" patternUnits="userSpaceOnUse" width="20" height="20">${pattern}</pattern>`;
    }
    defs += `</defs>`;
    
    let svg = `<svg width="150" height="155" viewBox="15 18 110 100">${defs}`;
    
    // ========== ë‚¨ì„± ë Œë”ë§ ==========
    if (gender === "ë‚¨") {
        // ì˜ìƒ
        svg += `<ellipse cx="70" cy="150" rx="48" ry="35" fill="url(#dress-${id})"/>`;
        if (pattern) svg += `<ellipse cx="70" cy="150" rx="46" ry="33" fill="url(#pat-${id})" opacity="0.5"/>`;
        svg += `<ellipse cx="70" cy="118" rx="26" ry="12" fill="url(#dress-${id})"/>`;
        
        // ëª©
        svg += `<path d="M58 95 L82 95 L82 110 Q70 118, 58 110 Z" fill="${skin.neck}"/>`;
        
        // ë¨¸ë¦¬ (ë’¤)
        hair.layers.forEach(layer => {
            if (layer.type === "ellipse") {
                svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
            } else if (layer.type === "path") {
                svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
            } else if (layer.type === "circle") {
                let color = "url(#hair-${id})";
                if (layer.shade === "dark") color = "rgba(0,0,0,0.12)";
                else if (layer.shade === "light") color = "rgba(80,70,60,0.25)";
                svg += `<circle cx="${layer.cx}" cy="${layer.cy}" r="${layer.r}" fill="${color}"/>`;
            } else if (layer.type === "wave") {
                svg += `<path d="${layer.d}" stroke="rgba(0,0,0,0.15)" stroke-width="2" fill="none" stroke-linecap="round"/>`;
            }
        });
        
        // ì–¼êµ´
        if (face.usePath) {
            svg += `<path d="${face.path}" fill="url(#skin-${id})" transform="translate(70, 73)"/>`;
        } else {
            svg += `<ellipse cx="70" cy="72" rx="${face.rx}" ry="${face.ry}" fill="url(#skin-${id})"/>`;
        }
        
        // ëˆˆ
        const leftEyeX = 56, rightEyeX = 84, eyeY = 70;
        
        if (eye.isClosed) {
            const closedPath = eye.closedPath || "M-6,0 Q0,-5, 6,0";
            const sw = eye.strokeWidth || 2;
            const sc = eye.strokeColor || "#3a2510";
            svg += `<path d="M${leftEyeX - 6} ${eyeY} Q${leftEyeX} ${eyeY - 5}, ${leftEyeX + 6} ${eyeY}" 
                    stroke="${sc}" stroke-width="${sw}" fill="none" stroke-linecap="round"/>`;
            svg += `<path d="M${rightEyeX - 6} ${eyeY} Q${rightEyeX} ${eyeY - 5}, ${rightEyeX + 6} ${eyeY}" 
                    stroke="${sc}" stroke-width="${sw}" fill="none" stroke-linecap="round"/>`;
        } else if (eye.isAlmond) {
            // ë‚ ì¹´ë¡œìš´ ëˆˆ - ë‘¥ê·¼ ëˆˆë™ì + ìœ„ìª½ ëˆˆêº¼í’€ ë¼ì¸ë§Œ
            svg += `<ellipse cx="${leftEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<ellipse cx="${rightEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            // ìœ„ìª½ ëˆˆêº¼í’€ ë¼ì¸ (ì§¸ì§„ ê°ë„ + ëˆˆì¹ ì•ˆ ê²¹ì¹˜ê²Œ)
            svg += `<path d="M${leftEyeX - 7} ${eyeY - 4} Q${leftEyeX} ${eyeY - 6}, ${leftEyeX + 7} ${eyeY - 1}" stroke="#2a2a35" stroke-width="1.2" fill="none" stroke-linecap="round"/>`;
            svg += `<path d="M${rightEyeX - 7} ${eyeY - 1} Q${rightEyeX} ${eyeY - 6}, ${rightEyeX + 7} ${eyeY - 4}" stroke="#2a2a35" stroke-width="1.2" fill="none" stroke-linecap="round"/>`;
            svg += `<circle cx="${leftEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            svg += `<circle cx="${rightEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
        } else {
            svg += `<ellipse cx="${leftEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<ellipse cx="${rightEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<circle cx="${leftEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            svg += `<circle cx="${rightEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            // highlight2 (ë°ì€ ëˆˆ, ë§‘ì€ ëˆˆ)
            if (eye.highlight2) {
                svg += `<circle cx="${leftEyeX + eye.highlight2.offsetX}" cy="${eyeY + eye.highlight2.offsetY}" r="${eye.highlight2.r}" fill="white" opacity="${eye.highlight2.opacity}"/>`;
                svg += `<circle cx="${rightEyeX + eye.highlight2.offsetX}" cy="${eyeY + eye.highlight2.offsetY}" r="${eye.highlight2.r}" fill="white" opacity="${eye.highlight2.opacity}"/>`;
            }
        }
        
        // ëˆˆì¹ (ë‚¨ì„±)
        const browColor = eye.eyebrow?.color || "#3d2b1f";
        const browWidth = eye.eyebrow?.strokeWidth || 1.8;
        const browY = eyeY - 8;
        svg += `<path d="M${leftEyeX - 6} ${browY} Q${leftEyeX} ${browY - 3}, ${leftEyeX + 6} ${browY}" 
                stroke="${browColor}" stroke-width="${browWidth}" fill="none"/>`;
        svg += `<path d="M${rightEyeX - 6} ${browY} Q${rightEyeX} ${browY - 3}, ${rightEyeX + 6} ${browY}" 
                stroke="${browColor}" stroke-width="${browWidth}" fill="none"/>`;
        
        // ì…
        if (ohang === "ëª©" || ohang === "í† ") {
            svg += `<ellipse cx="70" cy="92" rx="4" ry="2" fill="#c8a090"/>`;
        } else {
            svg += `<path d="M64 92 Q70 95, 76 92" stroke="#c8a090" stroke-width="1.5" fill="none" stroke-linecap="round"/>`;
        }
    }
    
    // ========== ì—¬ì„± ë Œë”ë§ ==========
    else if (gender === "ì—¬") {
        
        // ë’·ë¨¸ë¦¬ (order 0)
        hair.layers.forEach(layer => {
            if (layer.order === 0 || (layer.order === undefined && layer.type === "ellipse" && layer.cy > 60)) {
                if (layer.type === "ellipse") {
                    svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
                } else if (layer.type === "path") {
                    svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
                }
            }
        });
        
        // í¬ë‹ˆí…Œì¼/íŠ¸ìœˆí…Œì¼ ê¼¬ë¦¬ (order 4) - ì–¼êµ´ ë’¤ì— ê·¸ë ¤ì•¼ í•¨!
        hair.layers.forEach(layer => {
            if (layer.order === 4) {
                if (layer.type === "ellipse") {
                    svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
                } else if (layer.type === "path") {
                    svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
                }
            }
        });
        
        // í—¤ì–´ ë² ì´ìŠ¤ (order 1)
        hair.layers.forEach(layer => {
            if (layer.order === 1) {
                if (layer.type === "ellipse") {
                    svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
                } else if (layer.type === "path") {
                    svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
                }
            }
        });
        
        // ì˜ìƒ
        svg += `<ellipse cx="70" cy="155" rx="38" ry="35" fill="url(#dress-${id})"/>`;
        if (pattern) svg += `<ellipse cx="70" cy="155" rx="36" ry="33" fill="url(#pat-${id})" opacity="0.5"/>`;
        svg += `<ellipse cx="70" cy="120" rx="22" ry="12" fill="url(#dress-${id})"/>`;
        
        // ëª©
        svg += `<path d="M62 98 L78 98 L78 114 Q70 120, 62 114 Z" fill="${skin.neck}"/>`;
        
        // ì˜†ë¨¸ë¦¬ (order 2)
        hair.layers.forEach(layer => {
            if (layer.order === 2) {
                if (layer.type === "ellipse") {
                    svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
                } else if (layer.type === "path") {
                    svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
                }
            }
        });
        
        // ì–¼êµ´
        if (face.usePath) {
            svg += `<path d="${face.path}" fill="url(#skin-${id})" transform="translate(70, 70)"/>`;
        } else {
            svg += `<ellipse cx="70" cy="70" rx="${face.rx}" ry="${face.ry}" fill="url(#skin-${id})"/>`;
        }
        
        // ì•ë¨¸ë¦¬ (order 3)
        hair.layers.forEach(layer => {
            if (layer.order === 3) {
                if (layer.type === "ellipse") {
                    svg += `<ellipse cx="${layer.cx}" cy="${layer.cy}" rx="${layer.rx}" ry="${layer.ry}" fill="url(#hair-${id})"/>`;
                } else if (layer.type === "path") {
                    svg += `<path d="${layer.d}" fill="url(#hair-${id})"/>`;
                }
            }
        });
        
        // ëˆˆ
        const leftEyeX = 56, rightEyeX = 84, eyeY = 70;
        
        if (eye.isClosed) {
            const sw = eye.strokeWidth || 2;
            const sc = eye.strokeColor || "#3a2510";
            svg += `<path d="M${leftEyeX - 8} ${eyeY} Q${leftEyeX} ${eyeY - 6}, ${leftEyeX + 8} ${eyeY}" 
                    stroke="${sc}" stroke-width="${sw}" fill="none" stroke-linecap="round"/>`;
            svg += `<path d="M${rightEyeX - 8} ${eyeY} Q${rightEyeX} ${eyeY - 6}, ${rightEyeX + 8} ${eyeY}" 
                    stroke="${sc}" stroke-width="${sw}" fill="none" stroke-linecap="round"/>`;
        } else if (eye.isAlmond) {
            // ë‚ ì¹´ë¡œìš´ ëˆˆ - ë‘¥ê·¼ ëˆˆë™ì + ìœ„ìª½ ëˆˆêº¼í’€ ë¼ì¸ë§Œ
            svg += `<ellipse cx="${leftEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<ellipse cx="${rightEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            // ìœ„ìª½ ëˆˆêº¼í’€ ë¼ì¸ (ì§¸ì§„ ê°ë„ + ì‚´ì§ ë¼ìš´ë“œ)
            svg += `<path d="M${leftEyeX - 8} ${eyeY - 6} Q${leftEyeX} ${eyeY - 9}, ${leftEyeX + 8} ${eyeY - 2}" stroke="#2a2a35" stroke-width="1.2" fill="none" stroke-linecap="round"/>`;
            svg += `<path d="M${rightEyeX - 8} ${eyeY - 2} Q${rightEyeX} ${eyeY - 9}, ${rightEyeX + 8} ${eyeY - 6}" stroke="#2a2a35" stroke-width="1.2" fill="none" stroke-linecap="round"/>`;
            svg += `<circle cx="${leftEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            svg += `<circle cx="${rightEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
        } else {
            svg += `<ellipse cx="${leftEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<ellipse cx="${rightEyeX}" cy="${eyeY}" rx="${eye.pupil.rx}" ry="${eye.pupil.ry}" fill="${eye.pupil.color}"/>`;
            svg += `<circle cx="${leftEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            svg += `<circle cx="${rightEyeX + eye.highlight.offsetX}" cy="${eyeY + eye.highlight.offsetY}" r="${eye.highlight.r}" fill="white" opacity="${eye.highlight.opacity}"/>`;
            
            // ì¶”ê°€ í•˜ì´ë¼ì´íŠ¸ (ë°ì€ ëˆˆ, ë§‘ì€ ëˆˆ)
            if (eye.highlight2) {
                svg += `<circle cx="${leftEyeX + eye.highlight2.offsetX}" cy="${eyeY + eye.highlight2.offsetY}" r="${eye.highlight2.r}" fill="white" opacity="${eye.highlight2.opacity}"/>`;
                svg += `<circle cx="${rightEyeX + eye.highlight2.offsetX}" cy="${eyeY + eye.highlight2.offsetY}" r="${eye.highlight2.r}" fill="white" opacity="${eye.highlight2.opacity}"/>`;
            }
        }
        
        // ë³¼í„°ì¹˜ (ì—¬ì„±)
        svg += `<ellipse cx="46" cy="80" rx="5" ry="3" fill="${skin.blush}" opacity="0.35"/>`;
        svg += `<ellipse cx="94" cy="80" rx="5" ry="3" fill="${skin.blush}" opacity="0.35"/>`;
        
        // ì…
        if (ohang === "í™”" || ohang === "í† ") {
            svg += `<ellipse cx="70" cy="92" rx="4" ry="2.5" fill="#c8a088"/>`;
        } else {
            svg += `<path d="M65 92 Q70 95, 75 92" stroke="#c8a0a0" stroke-width="1.5" fill="none" stroke-linecap="round"/>`;
        }
        
        
    }
    
    svg += `</svg>`;
    return svg;
}

// ============================================
// HTML ë³µì‚¬ ê¸°ëŠ¥ (ì¸ë¼ì¸ CSS í¬í•¨)
// ============================================
function copyResultHTML() {
    const resultBox = document.querySelector('.result-box');
    if (!resultBox) return;
    
    // ì¸ë¼ì¸ CSS ìŠ¤íƒ€ì¼
    const inlineStyles = `
<style>
.result-box{max-width:900px;width:calc(100% - 40px);margin:0 auto 30px;padding:30px;background:rgba(255,255,255,0.03);border-radius:24px;border:1px solid rgba(255,255,255,0.05);font-family:'Noto Sans KR',sans-serif;}
.user-info{text-align:center;margin-top:10px;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,0.1);}
.user-info h2{color:#fff;font-weight:400;font-size:22px;margin-bottom:10px;}
.user-info p{color:#888;font-size:14px;}
.gender-group{margin-bottom:30px;}
.gender-label{text-align:center;color:#aaa;font-size:14px;margin-bottom:20px;}
.cards-row{display:flex;gap:30px;justify-content:center;flex-wrap:nowrap;padding:0 20px;}
.card-wrapper{text-align:center;flex:0 0 auto;}
.card-label{color:#fff;font-size:16px;margin-bottom:15px;letter-spacing:2px;}
.card{width:260px;height:400px;border-radius:24px;position:relative;overflow:hidden;}
@media (max-width:700px){.card{width:200px;height:310px;}.cards-row{gap:15px;}.user-info h2{font-size:20px;}.user-info p{font-size:13px;}.card-label{font-size:14px;}.character-area{margin-top:-10px;}.character-area svg{transform:scale(0.85);}.element-badge{padding:5px 14px;font-size:13px;}.element-name{font-size:14px;}.element-desc{font-size:11px;}}
.bg-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:200px;height:200px;border-radius:50%;filter:blur(60px);opacity:0.4;}
.stars{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;}
.star{position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;opacity:0.6;}
.content{position:relative;z-index:1;height:100%;display:flex;flex-direction:column;align-items:center;padding:20px;}
.element-label{color:rgba(255,255,255,0.6);font-size:11px;letter-spacing:3px;margin-bottom:10px;}
.character-area{position:relative;width:140px;height:150px;margin:10px 0;display:flex;align-items:center;justify-content:center;}
.char-glow{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:100px;height:60px;border-radius:50%;filter:blur(25px);opacity:0.5;}
.info{text-align:center;margin-top:auto;}
.element-badge{display:inline-block;padding:6px 16px;border-radius:20px;font-size:14px;margin-bottom:8px;backdrop-filter:blur(10px);background:rgba(255,255,255,0.15);color:#fff;}
.element-name{font-size:16px;font-weight:500;color:#fff;margin-bottom:4px;}
.element-desc{font-size:12px;color:rgba(255,255,255,0.7);margin-bottom:8px;}
.napeum-info{font-size:11px;color:rgba(255,255,255,0.5);}
.card-ê¸ˆ{background:linear-gradient(160deg,#2a2a3e 0%,#1a1a2e 50%,#2d2d4a 100%);box-shadow:0 10px 40px rgba(192,192,220,0.15);}
.card-ê¸ˆ .bg-glow{background:radial-gradient(circle,rgba(192,192,220,0.6) 0%,transparent 70%);}
.card-ê¸ˆ .char-glow{background:radial-gradient(circle,rgba(192,192,220,0.4) 0%,transparent 70%);}
.card-ëª©{background:linear-gradient(160deg,#1a2e1a 0%,#0f1f0f 50%,#1a3a1a 100%);box-shadow:0 10px 40px rgba(100,180,100,0.15);}
.card-ëª© .bg-glow{background:radial-gradient(circle,rgba(100,180,100,0.5) 0%,transparent 70%);}
.card-ëª© .char-glow{background:radial-gradient(circle,rgba(100,180,100,0.4) 0%,transparent 70%);}
.card-ìˆ˜{background:linear-gradient(160deg,#1a2a3e 0%,#0f1a2e 50%,#1a3a5a 100%);box-shadow:0 10px 40px rgba(100,150,220,0.15);}
.card-ìˆ˜ .bg-glow{background:radial-gradient(circle,rgba(100,150,220,0.5) 0%,transparent 70%);}
.card-ìˆ˜ .char-glow{background:radial-gradient(circle,rgba(100,150,220,0.4) 0%,transparent 70%);}
.card-í™”{background:linear-gradient(160deg,#3e1a1a 0%,#2e0f0f 50%,#4a1a1a 100%);box-shadow:0 10px 40px rgba(220,100,80,0.15);}
.card-í™” .bg-glow{background:radial-gradient(circle,rgba(220,100,80,0.5) 0%,transparent 70%);}
.card-í™” .char-glow{background:radial-gradient(circle,rgba(220,100,80,0.4) 0%,transparent 70%);}
.card-í† {background:linear-gradient(160deg,#2e2a1a 0%,#1e1a0f 50%,#3a351a 100%);box-shadow:0 10px 40px rgba(180,150,100,0.15);}
.card-í†  .bg-glow{background:radial-gradient(circle,rgba(180,150,100,0.5) 0%,transparent 70%);}
.card-í†  .char-glow{background:radial-gradient(circle,rgba(180,150,100,0.4) 0%,transparent 70%);}
@media (max-width:600px){.result-box{width:calc(100% - 20px);padding:15px;}.cards-row{display:flex;gap:10px;justify-content:center;padding:0;}.card-wrapper{flex:0 0 auto;}.card{width:145px;height:225px;}.card-label{font-size:10px;letter-spacing:1px;}.element-label{font-size:8px;}.character-area{width:85px;height:110px;}.character-area svg{width:100%;height:100%;}.element-badge{padding:3px 10px;font-size:11px;}.element-name{font-size:12px;}.element-desc{font-size:9px;}.napeum-info{font-size:8px;}.user-info h2{font-size:14px;}.user-info p{font-size:10px;}.gender-label{font-size:11px;}.content{padding:12px;}}
</style>
`;
    
    // ë°°ê²½ ë˜í¼ ì¶”ê°€
    const wrapperStart = `<div style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);padding:40px 20px;min-height:100vh;">`;
    const wrapperEnd = `</div>`;
    
    // ìµœì¢… HTML
    const finalHTML = inlineStyles + wrapperStart + resultBox.outerHTML + wrapperEnd;
    
    // í´ë¦½ë³´ë“œì— ë³µì‚¬
    navigator.clipboard.writeText(finalHTML).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'âœ… ë³µì‚¬ ì™„ë£Œ!';
        btn.classList.add('copied');
        setTimeout(() => {
            btn.textContent = 'ğŸ“‹ HTML ë³µì‚¬í•˜ê¸°';
            btn.classList.remove('copied');
        }, 2000);
    }).catch(err => {
        alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err);
    });
}

// ========== iframe ìë™í™”ìš© postMessage í•¸ë“¤ëŸ¬ ==========
window.addEventListener('message', function(event) {
    if (event.data && event.data.action === 'generateInyeonImage') {
        try {
            const jsonText = event.data.jsonText;
            const customerName = event.data.customerName || '';
            
            if (!jsonText || !jsonText.trim()) {
                window.parent.postMessage({
                    action: 'inyeonImageResult',
                    success: false,
                    error: 'JSON ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.'
                }, '*');
                return;
            }
            
            // JSON íŒŒì‹±
            let result;
            try {
                result = JSON.parse(jsonText);
            } catch (e) {
                window.parent.postMessage({
                    action: 'inyeonImageResult',
                    success: false,
                    error: 'JSON íŒŒì‹± ì˜¤ë¥˜: ' + e.message
                }, '*');
                return;
            }
            
            // generateFromJSON ë‚´ë¶€ ë¡œì§ ì§ì ‘ ì‹¤í–‰
            const input = result.ì…ë ¥ || result.input || {};
            const inyeon = result.ì¸ì—°ìƒ || result.inyeon || {};
            const baewuja = result.ë°°ìš°ììƒ || result.baewuja || {};
            
            const targetGender = input.ìƒëŒ€ì„±ë³„ || input.targetGender || 'ì—¬';

            // HTML ìƒì„± - "ë‘˜ë‹¤" ì²˜ë¦¬
            let cardsHTML = '';

            if (targetGender === 'ë‘˜ë‹¤') {
                // â˜… ë‘˜ë‹¤: ë‚¨/ì—¬ ê°ê° ì¸ì—°ìƒ+ë°°ìš°ììƒ = 4ê°œ ì¹´ë“œ
                console.log('[ì¸ì—°ìƒìƒì„±ê¸°] ë‘˜ë‹¤ ëª¨ë“œ - ë‚¨/ì—¬ ê°ê° ì¹´ë“œ ìƒì„±');

                try {
                    // ë‚¨ì„± ê·¸ë£¹
                    const maleInyeonCard = createCard('ì¸ì—°ìƒ', inyeon, 'ë‚¨');
                    const maleBaewujaCard = createCard('ë°°ìš°ììƒ', baewuja, 'ë‚¨');

                    // ì—¬ì„± ê·¸ë£¹
                    const femaleInyeonCard = createCard('ì¸ì—°ìƒ', inyeon, 'ì—¬');
                    const femaleBaewujaCard = createCard('ë°°ìš°ììƒ', baewuja, 'ì—¬');

                    cardsHTML = `
                        <div class="gender-group" style="margin-bottom:30px;">
                            <div class="gender-label" style="text-align:center;margin-bottom:15px;color:#e8e0d8;font-size:16px;letter-spacing:2px;"><span style="margin-right:5px;">â™‚</span> ë‚¨ì„± ì¸ì—°/ë°°ìš°ììƒ</div>
                            <div class="cards-row" style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;">
                                ${maleInyeonCard}
                                ${maleBaewujaCard}
                            </div>
                        </div>
                        <div class="gender-group">
                            <div class="gender-label" style="text-align:center;margin-bottom:15px;color:#e8e0d8;font-size:16px;letter-spacing:2px;"><span style="margin-right:5px;">â™€</span> ì—¬ì„± ì¸ì—°/ë°°ìš°ììƒ</div>
                            <div class="cards-row" style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;">
                                ${femaleInyeonCard}
                                ${femaleBaewujaCard}
                            </div>
                        </div>
                    `;
                    console.log('[ì¸ì—°ìƒìƒì„±ê¸°] ë‘˜ë‹¤ ëª¨ë“œ ì¹´ë“œ ìƒì„± ì™„ë£Œ (4ê°œ)');
                } catch (e) {
                    console.error('[ì¸ì—°ìƒìƒì„±ê¸°] ë‘˜ë‹¤ ëª¨ë“œ ì¹´ë“œ ìƒì„± ì—ëŸ¬:', e);
                    cardsHTML = '<div style="color:red;">ì¹´ë“œ ìƒì„± ì‹¤íŒ¨: ' + e.message + '</div>';
                }
            } else {
                // ë‹¨ì¼ ì„±ë³„
                console.log('[ì¸ì—°ìƒìƒì„±ê¸°] ë‹¨ì¼ ì„±ë³„ ëª¨ë“œ:', targetGender);

                try {
                    const inyeonCard = createCard('ì¸ì—°ìƒ', inyeon, targetGender);
                    const baewujaCard = createCard('ë°°ìš°ììƒ', baewuja, targetGender);
                    cardsHTML = inyeonCard + baewujaCard;
                    console.log('[ì¸ì—°ìƒìƒì„±ê¸°] ë‹¨ì¼ ì„±ë³„ ì¹´ë“œ ìƒì„± ì™„ë£Œ (2ê°œ)');
                } catch (e) {
                    console.error('[ì¸ì—°ìƒìƒì„±ê¸°] ì¹´ë“œ ìƒì„± ì—ëŸ¬:', e);
                    cardsHTML = '<div style="color:red;">ì¹´ë“œ ìƒì„± ì‹¤íŒ¨: ' + e.message + '</div>';
                }
            }
            
            // ë³¸ì¸ ì •ë³´
            const myInfo = result.ë³¸ì¸ || {};
            const inputInfo = result.ì…ë ¥ || input;
            let myNapeumDisplay = myInfo.ë‚©ìŒ || '';
            const hangulToHanja = {};
            Object.entries(hanjaToHangul).forEach(([h, k]) => { hangulToHanja[k] = h; });
            if (hangulToHanja[myNapeumDisplay]) myNapeumDisplay = hangulToHanja[myNapeumDisplay];
            
            const myOhang = myInfo.ì˜¤í–‰ || 'í† ';
            const myMood = ohangAppearance[myOhang]?.ë¶„ìœ„ê¸° || '';
            
            // ë³¸ì¸ ì •ë³´ HTML (ì–´ë‘ìš´ í…Œë§ˆìš©)
            const userInfoHTML = `
                <div class="user-info" style="text-align:center; margin-bottom:25px; padding-bottom:20px; border-bottom:1px solid rgba(255,255,255,0.1);">
                    <h2 style="font-size:22px; margin:0 0 10px 0; color:#e8e0d8; font-weight:400;">${myNapeumDisplay} Â· ${inputInfo.ì¼ì£¼ || ''} (ë³¸ì¸)</h2>
                    <p style="font-size:14px; margin:0; color:rgba(255,255,255,0.6);">${myMood}</p>
                </div>
            `;
            
            // ë©”íƒ€ë°ì´í„° (ìˆ¨ê¹€ - ì›ë³¸ JSON ì €ì¥)
            const metaJSON = JSON.stringify(result).replace(/"/g, '&quot;');
            const metaHTML = `<div style="display:none;" data-inyun-json="${metaJSON}"></div>`;
            
            // ë°”ê¹¥ ì»¨í…Œì´ë„ˆ ë°•ìŠ¤ í¬í•¨ ì „ì²´ HTML
            // "ë‘˜ë‹¤"ì¼ ë•ŒëŠ” gender-group êµ¬ì¡°, ë‹¨ì¼ ì„±ë³„ì¼ ë•ŒëŠ” inyun-cards-container êµ¬ì¡°
            let fullHTML;
            if (targetGender === 'ë‘˜ë‹¤') {
                fullHTML = `<div class="result-box" style="max-width:900px; margin:0 auto; padding:30px; background:linear-gradient(180deg, #252547 0%, #1a1a2e 100%); border-radius:24px; border:1px solid rgba(255,255,255,0.08); box-shadow:0 20px 60px rgba(0,0,0,0.3);">
${userInfoHTML}
${cardsHTML}
${metaHTML}
</div>`;
            } else {
                fullHTML = `<div class="result-box" style="max-width:700px; margin:0 auto; padding:30px; background:linear-gradient(180deg, #252547 0%, #1a1a2e 100%); border-radius:24px; border:1px solid rgba(255,255,255,0.08); box-shadow:0 20px 60px rgba(0,0,0,0.3);">
${userInfoHTML}
<div class="inyun-cards-container" style="display:flex; gap:20px; justify-content:center; flex-wrap:wrap; padding:20px 0;">
${cardsHTML}
</div>
${metaHTML}
</div>`;
            }

            console.log('[ì¸ì—°ìƒìƒì„±ê¸°] fullHTML ê¸¸ì´:', fullHTML.length);
            console.log('[ì¸ì—°ìƒìƒì„±ê¸°] targetGender:', targetGender);
            
            // CSS í¬í•¨ ì „ì²´ HTML (createCardê°€ ì‚¬ìš©í•˜ëŠ” ì‹¤ì œ CSS)
            const cssStyle = `<style>
/* ì¹´ë“œ ì»¨í…Œì´ë„ˆ */
.inyun-cards-container { display:flex; gap:20px; justify-content:center; flex-wrap:wrap; padding:20px; }
.card-wrapper { text-align:center; flex:0 0 auto; }
.card-label { color:#e8e0d8; font-size:16px; margin-bottom:15px; letter-spacing:2px; }
.card-label span { font-size:20px; margin-right:8px; }

/* ì¹´ë“œ ê¸°ë³¸ */
.card { width:260px; height:400px; border-radius:24px; position:relative; overflow:hidden; }

/* ë°°ê²½ ê¸€ë¡œìš° */
.bg-glow { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:200px; height:200px; border-radius:50%; filter:blur(60px); opacity:0.4; }

/* ë³„ íš¨ê³¼ */
.stars { position:absolute; top:0; left:0; right:0; bottom:0; pointer-events:none; }
.star { position:absolute; width:3px; height:3px; background:white; border-radius:50%; animation:twinkle 2s ease-in-out infinite; }
@keyframes twinkle { 0%,100%{opacity:0.2;transform:scale(1);} 50%{opacity:0.8;transform:scale(1.2);} }

/* ì»¨í…ì¸  */
.content { position:relative; z-index:10; height:100%; display:flex; flex-direction:column; align-items:center; padding:24px 20px; box-sizing:border-box; }
.element-label { font-size:11px; letter-spacing:3px; opacity:0.6; margin-bottom:8px; font-weight:300; }
.character-area { flex:1; display:flex; align-items:center; justify-content:center; position:relative; }
.char-glow { position:absolute; width:140px; height:140px; border-radius:50%; filter:blur(40px); opacity:0.5; }
.character-area svg { position:relative; z-index:1; filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3)); }
.info { text-align:center; margin-top:auto; }
.element-badge { width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 12px; font-size:20px; font-weight:400; backdrop-filter:blur(10px); }
.element-name { font-size:15px; font-weight:500; margin-bottom:4px; letter-spacing:1px; }
.element-desc { font-size:11px; opacity:0.5; font-weight:300; line-height:1.5; max-width:200px; }
.napeum-info { margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.1); font-size:10px; opacity:0.4; letter-spacing:0.5px; }

/* ê¸ˆ(é‡‘) */
.card-ê¸ˆ { background:linear-gradient(180deg,#2a2a3e 0%,#1e1e30 100%); box-shadow:0 10px 40px rgba(200,200,230,0.15); }
.card-ê¸ˆ .bg-glow { background:rgba(210,210,240,0.5); }
.card-ê¸ˆ .char-glow { background:rgba(200,200,230,0.4); }
.card-ê¸ˆ .element-label,.card-ê¸ˆ .element-name,.card-ê¸ˆ .element-desc { color:#e8e8f8; }
.card-ê¸ˆ .element-badge { background:rgba(200,200,230,0.15); border:1px solid rgba(200,200,230,0.3); color:#e8e8f8; }
.card-ê¸ˆ .star { background:#e8e8ff; }
.card-ê¸ˆ .napeum-info { color:#e8e8f8; }

/* ëª©(æœ¨) */
.card-ëª© { background:linear-gradient(180deg,#1a2a1a 0%,#152015 100%); box-shadow:0 10px 40px rgba(100,180,100,0.15); }
.card-ëª© .bg-glow { background:rgba(120,200,120,0.5); }
.card-ëª© .char-glow { background:rgba(100,180,100,0.4); }
.card-ëª© .element-label,.card-ëª© .element-name,.card-ëª© .element-desc { color:#d0f0d0; }
.card-ëª© .element-badge { background:rgba(100,180,100,0.15); border:1px solid rgba(100,180,100,0.3); color:#d0f0d0; }
.card-ëª© .star { background:#c0ffc0; }
.card-ëª© .napeum-info { color:#d0f0d0; }

/* ìˆ˜(æ°´) */
.card-ìˆ˜ { background:linear-gradient(180deg,#1a1a3e 0%,#151528 100%); box-shadow:0 10px 40px rgba(100,150,255,0.15); }
.card-ìˆ˜ .bg-glow { background:rgba(120,170,255,0.5); }
.card-ìˆ˜ .char-glow { background:rgba(100,150,255,0.4); }
.card-ìˆ˜ .element-label,.card-ìˆ˜ .element-name,.card-ìˆ˜ .element-desc { color:#d0e0ff; }
.card-ìˆ˜ .element-badge { background:rgba(100,150,255,0.15); border:1px solid rgba(100,150,255,0.3); color:#d0e0ff; }
.card-ìˆ˜ .star { background:#c0d8ff; }
.card-ìˆ˜ .napeum-info { color:#d0e0ff; }

/* í™”(ç«) */
.card-í™” { background:linear-gradient(180deg,#2e1a1a 0%,#281515 100%); box-shadow:0 10px 40px rgba(255,120,100,0.15); }
.card-í™” .bg-glow { background:rgba(255,140,120,0.5); }
.card-í™” .char-glow { background:rgba(255,120,100,0.4); }
.card-í™” .element-label,.card-í™” .element-name,.card-í™” .element-desc { color:#ffe0d8; }
.card-í™” .element-badge { background:rgba(255,120,100,0.15); border:1px solid rgba(255,120,100,0.3); color:#ffe0d8; }
.card-í™” .star { background:#ffc8c0; }
.card-í™” .napeum-info { color:#ffe0d8; }

/* í† (åœŸ) */
.card-í†  { background:linear-gradient(180deg,#2a2518 0%,#1a1508 100%); box-shadow:0 10px 40px rgba(200,160,100,0.15); }
.card-í†  .bg-glow { background:rgba(210,170,120,0.5); }
.card-í†  .char-glow { background:rgba(200,160,100,0.4); }
.card-í†  .element-label,.card-í†  .element-name,.card-í†  .element-desc { color:#f0e0c8; }
.card-í†  .element-badge { background:rgba(200,160,100,0.15); border:1px solid rgba(200,160,100,0.3); color:#f0e0c8; }
.card-í†  .star { background:#ffe8c0; }
.card-í†  .napeum-info { color:#f0e0c8; }

/* ëª¨ë°”ì¼ ë°˜ì‘í˜• (ë¹„ìœ¨ ìœ ì§€) */
@media (max-width:600px) {
  .inyun-cards-container { gap:10px; padding:10px; }
  .card { width:calc((100vw - 60px) / 2); height:auto; aspect-ratio:260/400; }
  .card-label { font-size:12px; margin-bottom:10px; }
  .content { padding:15px 12px; }
  .element-label { font-size:9px; }
  .character-area svg { transform:scale(0.7); }
  .element-badge { width:32px; height:32px; font-size:14px; margin-bottom:8px; }
  .element-name { font-size:12px; }
  .element-desc { font-size:9px; max-width:120px; }
  .napeum-info { font-size:8px; margin-top:5px; padding-top:5px; }
}
</style>`;
            
            const resultHTML = cssStyle + fullHTML;
            
            // â˜… ì´ë¦„ë³„ localStorage ì €ì¥
            if (customerName) {
                localStorage.setItem('inyeon_' + customerName, resultHTML);
                console.log('âœ… localStorage ì €ì¥:', 'inyeon_' + customerName);
            }
            
            // ê²°ê³¼ ë°˜í™˜
            window.parent.postMessage({
                action: 'inyeonImageResult',
                success: true,
                result: resultHTML
            }, '*');
            
        } catch (error) {
            window.parent.postMessage({
                action: 'inyeonImageResult',
                success: false,
                error: error.message
            }, '*');
        }
    }
});
</script>
</body>
</html>
