<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì£¼ ê³„ì‚°ê¸° | STEP 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Nanum Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            line-height: 1.7;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .step-badge {
            display: inline-block;
            background: rgba(212, 175, 130, 0.2);
            border: 1px solid #d4af82;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            color: #d4af82;
            margin-bottom: 10px;
        }
        
        .header h1 {
            font-size: 28px;
            color: #d4af82;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #888;
            font-size: 14px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section h2 {
            font-size: 16px;
            color: #d4af82;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(212, 175, 130, 0.3);
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 15px;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #d4af82;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #d4af82 0%, #b8956a 100%);
            color: #1a1a2e;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 130, 0.4);
        }
        
        .btn-secondary {
            background: rgba(212, 175, 130, 0.2);
            color: #d4af82;
            border: 1px solid #d4af82;
        }
        
        .result-area {
            display: none;
        }
        
        .result-area.show {
            display: block;
        }
        
        /* ê³ ê° ì •ë³´ */
        .customer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
        }
        
        .info-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-size: 14px;
            color: #fff;
            font-weight: 700;
        }
        
        /* ëª…ì‹ í‘œì‹œ */
        .pillars-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .pillar-box {
            background: linear-gradient(180deg, rgba(212, 175, 130, 0.15) 0%, rgba(212, 175, 130, 0.05) 100%);
            border: 1px solid rgba(212, 175, 130, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        
        .pillar-label {
            font-size: 12px;
            color: #a89068;
            margin-bottom: 8px;
        }
        
        .pillar-hanja {
            font-size: 28px;
            font-weight: 700;
            color: #d4af82;
        }
        
        .pillar-hanja .gan { display: block; }
        .pillar-hanja .ji { display: block; color: #c4b49a; }
        
        .pillar-korean {
            font-size: 12px;
            color: #888;
            margin-top: 6px;
        }
        
        .pillar-ohaeng {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }
        
        /* ì¼ê°„ ì •ë³´ */
        .ilgan-box {
            background: linear-gradient(135deg, rgba(212, 175, 130, 0.2) 0%, rgba(212, 175, 130, 0.05) 100%);
            border: 2px solid rgba(212, 175, 130, 0.4);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .ilgan-char {
            font-size: 56px;
            font-weight: 700;
            color: #d4af82;
        }
        
        .ilgan-name {
            font-size: 20px;
            color: #fff;
            margin-top: 10px;
        }
        
        .ilgan-nature {
            font-size: 14px;
            color: #a89068;
            margin-top: 8px;
        }
        
        /* ì˜¤í–‰ ë°” */
        .ohaeng-display {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .ohaeng-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            border-radius: 10px;
        }
        
        .ohaeng-item.wood { background: rgba(76, 175, 80, 0.2); color: #4caf50; }
        .ohaeng-item.fire { background: rgba(244, 67, 54, 0.2); color: #f44336; }
        .ohaeng-item.earth { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .ohaeng-item.metal { background: rgba(158, 158, 158, 0.2); color: #bdbdbd; }
        .ohaeng-item.water { background: rgba(33, 150, 243, 0.2); color: #2196f3; }
        
        .ohaeng-char { font-size: 20px; font-weight: 700; }
        .ohaeng-count { font-size: 28px; font-weight: 700; margin-top: 5px; }
        .ohaeng-status { font-size: 11px; margin-top: 5px; opacity: 0.8; }
        
        /* ì‹­ì„± */
        .sipsung-display {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .sipsung-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .sipsung-item.dominant {
            background: rgba(212, 175, 130, 0.2);
            border: 1px solid #d4af82;
        }
        
        .sipsung-name { font-size: 13px; color: #d4af82; margin-bottom: 5px; }
        .sipsung-count { font-size: 24px; font-weight: 700; color: #fff; }
        
        /* ì§€ì¥ê°„ */
        .jijanggan-display {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .jijanggan-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .jijanggan-position {
            font-size: 12px;
            color: #888;
            min-width: 35px;
        }
        
        .jijanggan-ji {
            font-size: 18px;
            font-weight: 700;
            color: #d4af82;
            min-width: 60px;
        }
        
        .jijanggan-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .jjg-tag {
            background: rgba(212, 175, 130, 0.15);
            border: 1px solid rgba(212, 175, 130, 0.3);
            border-radius: 15px;
            padding: 4px 10px;
            font-size: 12px;
            color: #d4af82;
        }
        
        /* ê²©êµ­/ìš©ì‹  */
        .gyeokguk-display {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .gyeokguk-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .gyeokguk-item.highlight {
            background: rgba(212, 175, 130, 0.15);
            border-color: rgba(212, 175, 130, 0.4);
        }
        
        .gyeokguk-item.caution {
            background: rgba(200, 100, 100, 0.08);
            border-color: rgba(200, 100, 100, 0.3);
        }
        
        .gyeokguk-item.caution .gyeokguk-value {
            color: #c87070;
        }
        
        .gyeokguk-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .gyeokguk-value {
            font-size: 18px;
            font-weight: 700;
            color: #d4af82;
            margin-bottom: 5px;
        }
        
        .gyeokguk-desc {
            font-size: 13px;
            color: #ccc;
            line-height: 1.5;
        }
        
        .yongsin-row {
            display: flex;
            gap: 12px;
        }
        
        .yongsin-row .gyeokguk-item {
            flex: 1;
        }
        
        /* ëŒ€ìš´ */
        .daeun-display {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .daeun-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 12px;
            text-align: center;
        }
        
        .daeun-item.current {
            background: rgba(212, 175, 130, 0.2);
            border-color: #d4af82;
        }
        
        .daeun-age { font-size: 11px; color: #888; margin-bottom: 3px; }
        .daeun-pillar { font-size: 16px; font-weight: 700; color: #d4af82; }

        /* í•©ì¶©í˜•íŒŒí•´ */
        .hapchung-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .hapchung-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .hapchung-tag.hap {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            color: #81c784;
        }

        .hapchung-tag.chung {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.5);
            color: #e57373;
        }

        .hapchung-tag.hyung {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.5);
            color: #ffb74d;
        }

        .hapchung-tag.pa {
            background: rgba(156, 39, 176, 0.2);
            border: 1px solid rgba(156, 39, 176, 0.5);
            color: #ba68c8;
        }

        .hapchung-tag.hae {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.5);
            color: #64b5f6;
        }

        .hapchung-detail {
            margin-top: 15px;
        }

        .hapchung-category {
            margin-bottom: 12px;
        }

        .hapchung-category-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 6px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hapchung-category-title.hap { color: #81c784; }
        .hapchung-category-title.chung { color: #e57373; }
        .hapchung-category-title.hyung { color: #ffb74d; }
        .hapchung-category-title.pa { color: #ba68c8; }
        .hapchung-category-title.hae { color: #64b5f6; }

        .hapchung-item {
            font-size: 12px;
            color: #ccc;
            padding: 4px 0 4px 12px;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 4px;
        }

        .hapchung-none {
            color: #666;
            font-size: 13px;
            text-align: center;
            padding: 20px;
        }

        /* ê²°ê³¼ í…ìŠ¤íŠ¸ */
        .result-text-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(212, 175, 130, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .result-text-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 13px;
            line-height: 1.8;
            color: #e0e0e0;
        }
        
        /* ì•Œë¦¼ */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(76, 175, 80, 0.95);
            color: #fff;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 700;
            transition: transform 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .footer {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 12px;
        }
        
        @media (max-width: 600px) {
            .container { padding: 15px 10px; }
            .header h1 { font-size: 22px; }
            .section { padding: 15px; margin-bottom: 15px; }
            .section h2 { font-size: 14px; }

            /* ì‚¬ì£¼ ëª…ì‹ - 2x2 ê·¸ë¦¬ë“œ */
            .pillars-display {
                gap: 8px;
                grid-template-columns: repeat(2, 1fr);
            }
            .pillar-box { padding: 10px; }
            .pillar-hanja { font-size: 20px; }
            .pillar-kr { font-size: 10px; }

            /* ì˜¤í–‰ ë¶„í¬ */
            .ohaeng-display { flex-wrap: wrap; gap: 8px; }
            .ohaeng-item {
                min-width: calc(33% - 8px);
                padding: 8px;
            }
            .ohaeng-char { font-size: 16px; }
            .ohaeng-count { font-size: 12px; }

            /* ì‹­ì„± ë¶„í¬ */
            .sipsung-display {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .sipsung-item { padding: 10px; }

            /* ê²©êµ­/ìš©ì‹  */
            .gyeokguk-display { gap: 10px; }
            .gyeokguk-item { padding: 12px; }
            .gyeokguk-value { font-size: 14px; }
            .gyeokguk-desc { font-size: 11px; }
            .yongsin-row {
                flex-direction: column;
                gap: 10px;
            }

            /* ëŒ€ìš´ */
            .daeun-display { gap: 6px; }
            .daeun-item { padding: 8px 10px; min-width: 60px; }
            .daeun-age { font-size: 10px; }
            .daeun-pillar { font-size: 14px; }

            /* ì§€ì¥ê°„ */
            .jijanggan-item { flex-direction: column; gap: 5px; }

            /* ì‹ ì‚´ */
            .sinsal-list { gap: 6px; }
            .sinsal-tag { font-size: 11px; padding: 4px 8px; }

            /* ë²„íŠ¼ */
            .btn { padding: 14px; font-size: 14px; min-height: 48px; }

            /* ì¼ê°„ ë°•ìŠ¤ */
            .ilgan-box { padding: 15px; }
            .ilgan-char { font-size: 40px; }
            .ilgan-name { font-size: 14px; }
        }

        /* íƒœë¸”ë¦¿ */
        @media (max-width: 768px) and (min-width: 601px) {
            .pillars-display { gap: 10px; }
            .yongsin-row { gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="step-badge">STEP 2 / 5</div>
            <h1>ğŸ§® ì‚¬ì£¼ ê³„ì‚°ê¸°</h1>
            <p>ì…ë ¥í¼ ë°ì´í„° ë¶™ì—¬ë„£ê¸° â†’ ë§Œì„¸ë ¥ ê³„ì‚° â†’ ê²°ê³¼ ë³µì‚¬</p>
        </div>
        
        <!-- JSON ì…ë ¥ -->
        <div class="section">
            <h2>ğŸ“‹ ë°ì´í„° ë¶™ì—¬ë„£ê¸°</h2>
            <textarea id="jsonInput" placeholder="[ì‚¬ì£¼ ì œì‘ ì •ë³´]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ì´ë¦„: í™ê¸¸ë™
ìƒë…„ì›”ì¼: 1990ë…„ 5ì›” 15ì¼
ì‹œê°„: 10ì‹œ 30ë¶„
ìŒ/ì–‘ë ¥: ì–‘ë ¥
ì„±ë³„: ì—¬ì„±
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
íŒ¨í‚¤ì§€: ìŠ¤íƒ ë‹¤ë“œ
ì„ íƒ ìš´ì„¸: love,job
...

ë˜ëŠ” JSON í˜•ì‹ë„ ì§€ì›í•©ë‹ˆë‹¤"></textarea>
            <button class="btn btn-primary" onclick="calculateFromJSON()">
                ğŸ”® ì‚¬ì£¼ ê³„ì‚°í•˜ê¸°
            </button>
        </div>
        
        <!-- ê²°ê³¼ ì˜ì—­ -->
        <div class="result-area" id="resultArea">
            
            <!-- ê³ ê° ì •ë³´ -->
            <div class="section">
                <h2>ğŸ‘¤ ê³ ê° ì •ë³´</h2>
                <div class="customer-info" id="customerInfo"></div>
            </div>
            
            <!-- ì¼ê°„ -->
            <div class="ilgan-box">
                <div class="ilgan-char" id="ilganChar">ç”²</div>
                <div class="ilgan-name" id="ilganName">ê°‘ëª© (ç”²æœ¨)</div>
                <div class="ilgan-nature" id="ilganNature">í•˜ëŠ˜ì„ í–¥í•´ ê³§ê²Œ ë»—ì–´ê°€ëŠ” í° ë‚˜ë¬´</div>
            </div>
            
            <!-- ì‚¬ì£¼ ëª…ì‹ -->
            <div class="section">
                <h2>ğŸ“œ ì‚¬ì£¼ ëª…ì‹ (å››æŸ±å…«å­—)</h2>
                <div class="pillars-display" id="pillarsDisplay"></div>
            </div>
            
            <!-- ì˜¤í–‰ ë¶„í¬ -->
            <div class="section">
                <h2>ğŸ”¥ ì˜¤í–‰ ë¶„í¬</h2>
                <div class="ohaeng-display" id="ohaengDisplay"></div>
            </div>
            
            <!-- ì‹­ì„± ë¶„í¬ -->
            <div class="section">
                <h2>â­ ì‹­ì„± ë¶„í¬</h2>
                <div class="sipsung-display" id="sipsungDisplay"></div>
                <p style="font-size: 13px; color: #888; margin-top: 15px;">
                    ğŸ“Œ ê°€ì¥ ê°•í•œ ì‹­ì„±: <strong id="dominantSipsung" style="color: #d4af82;">-</strong>
                </p>
            </div>
            
            <!-- ì§€ì¥ê°„ ë¶„ì„ (ìˆ¨ê²¨ì§„ ë‚´ë©´) -->
            <div class="section">
                <h2>ğŸ”® ì§€ì¥ê°„ ë¶„ì„ (ìˆ¨ê²¨ì§„ ë‚´ë©´)</h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    ì§€ì§€ ì†ì— ìˆ¨ê²¨ì§„ ì²œê°„ë“¤ Â· ë‚´ë©´ì˜ ì§„ì§œ ë‚˜
                </p>
                <div class="jijanggan-display" id="jijangganDisplay"></div>
            </div>
            
            <!-- ê²©êµ­/ìš©ì‹  -->
            <div class="section">
                <h2>âš–ï¸ ê²©êµ­ & ìš©ì‹ </h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    ì¸ìƒì˜ í° í‹€ê³¼ ê· í˜•ì˜ í•µì‹¬
                </p>
                <div class="gyeokguk-display" id="gyeokgukDisplay"></div>
            </div>

            <!-- ì‚¼ì¬ -->
            <div class="section" id="samjaeSection" style="display: none;">
                <h2>âš ï¸ ì‚¼ì¬ (ä¸‰ç½)</h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    12ë…„ ì£¼ê¸°ë¡œ 3ë…„ê°„ ì˜¤ëŠ” ì•¡ìš´ì˜ ì‹œê¸°
                </p>
                <div class="gyeokguk-display" id="samjaeDisplay"></div>
            </div>

            <!-- ëŒ€ìš´ -->
            <div class="section">
                <h2>ğŸŒŠ ëŒ€ìš´ íë¦„</h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    ëŒ€ìš´ ì‹œì‘ ë‚˜ì´: <strong id="daeunStartAge" style="color: #d4af82;">-</strong>ì„¸
                    | ë°©í–¥: <strong id="daeunDirection" style="color: #d4af82;">-</strong>
                </p>
                <div class="daeun-display" id="daeunDisplay"></div>
            </div>

            <!-- í•©ì¶©í˜•íŒŒí•´ -->
            <div class="section">
                <h2>ğŸ”— í•©ì¶©í˜•íŒŒí•´ (åˆæ²–åˆ‘ç ´å®³)</h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    ì‚¬ì£¼ ë‚´ ê¸€ìë“¤ì˜ ìƒí˜¸ì‘ìš© Â· í•©ì€ ê²°í•©, ì¶©ì€ ëŒ€ë¦½, í˜•ì€ ê°ˆë“±, íŒŒëŠ” ê¹¨ì§, í•´ëŠ” í•´ì¹¨
                </p>
                <div id="hapchungDisplay"></div>
            </div>

            <!-- Birth Chart (ì„œì–‘ ì ì„±ìˆ ) -->
            <div class="section" id="birthChartSection" style="display: none;">
                <h2>ğŸŒŸ Birth Chart (ì„œì–‘ ì ì„±ìˆ )</h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 15px;">
                    ì¶œìƒ ì‹œì ì˜ í–‰ì„± ìœ„ì¹˜ Â· Whole Sign í•˜ìš°ìŠ¤ ì‹œìŠ¤í…œ
                </p>
                <div id="birthChartDisplay">
                    <div style="margin-bottom: 20px;">
                        <h3 style="font-size: 14px; color: #d4af82; margin-bottom: 10px;">â˜€ï¸ í–‰ì„± ìœ„ì¹˜ (Planet Positions)</h3>
                        <div id="planetPositions" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px;"></div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <h3 style="font-size: 14px; color: #d4af82; margin-bottom: 10px;">ğŸ  í•˜ìš°ìŠ¤ (Houses)</h3>
                        <div id="housePositions" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px;"></div>
                    </div>
                    <div>
                        <h3 style="font-size: 14px; color: #d4af82; margin-bottom: 10px;">âœ¨ ì£¼ìš” ì• ìŠ¤í™íŠ¸ (Aspects)</h3>
                        <div id="aspectsDisplay" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                    </div>
                </div>
            </div>

            <!-- ë³µì‚¬ìš© ê²°ê³¼ -->
            <div class="section">
                <h2>ğŸ“‹ ë³µì‚¬ìš© ê²°ê³¼ (í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°ìš©)</h2>
                <div class="result-text-box">
                    <pre id="resultText"></pre>
                </div>
                <button class="btn btn-primary" onclick="copyResult()">
                    ğŸ“‹ ê²°ê³¼ ë³µì‚¬í•˜ê¸°
                </button>
                <button class="btn btn-secondary" onclick="openPromptGenerator()">
                    ë‹¤ìŒ ë‹¨ê³„ â†’ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°
                </button>
            </div>
        </div>
        
        <div class="footer">
            Â© 2026 ìš´ëª…ì„ ë“£ë‹¤ Â· Listen to Destiny
        </div>
    </div>
    
    <div class="toast" id="toast">âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <!-- Astronomy Engine ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>

    <script>
        // ============================================
        // ê¸°ë³¸ ë°ì´í„°
        // ============================================
        
        const CHEONGAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
        const CHEONGAN_KR = ["ê°‘", "ì„", "ë³‘", "ì •", "ë¬´", "ê¸°", "ê²½", "ì‹ ", "ì„", "ê³„"];
        
        const JIJI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
        const JIJI_KR = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"];
        
        const CHEONGAN_OHAENG = {
            "ç”²": "ëª©", "ä¹™": "ëª©", "ä¸™": "í™”", "ä¸": "í™”", "æˆŠ": "í† ",
            "å·±": "í† ", "åºš": "ê¸ˆ", "è¾›": "ê¸ˆ", "å£¬": "ìˆ˜", "ç™¸": "ìˆ˜"
        };
        
        const JIJI_OHAENG = {
            "å­": "ìˆ˜", "ä¸‘": "í† ", "å¯…": "ëª©", "å¯": "ëª©", "è¾°": "í† ", "å·³": "í™”",
            "åˆ": "í™”", "æœª": "í† ", "ç”³": "ê¸ˆ", "é…‰": "ê¸ˆ", "æˆŒ": "í† ", "äº¥": "ìˆ˜"
        };
        
        const ILGAN_INFO = {
            "ç”²": { name: "ê°‘ëª©", hanja: "ç”²æœ¨", nature: "í•˜ëŠ˜ì„ í–¥í•´ ê³§ê²Œ ë»—ì–´ê°€ëŠ” í° ë‚˜ë¬´" },
            "ä¹™": { name: "ì„ëª©", hanja: "ä¹™æœ¨", nature: "ë°”ëŒì— í”ë“¤ë¦¬ë©° ì ì‘í•˜ëŠ” ë©êµ´ê³¼ ê½ƒ" },
            "ä¸™": { name: "ë³‘í™”", hanja: "ä¸™ç«", nature: "ë§Œë¬¼ì„ ë¹„ì¶”ëŠ” ë°ì€ íƒœì–‘" },
            "ä¸": { name: "ì •í™”", hanja: "ä¸ç«", nature: "ì–´ë‘ ì„ ë°íˆëŠ” ë”°ëœ»í•œ ì´›ë¶ˆ" },
            "æˆŠ": { name: "ë¬´í† ", hanja: "æˆŠåœŸ", nature: "ìš°ì§í•˜ê²Œ ì„œ ìˆëŠ” ê±°ëŒ€í•œ ì‚°" },
            "å·±": { name: "ê¸°í† ", hanja: "å·±åœŸ", nature: "ë§Œë¬¼ì„ ê¸°ë¥´ëŠ” ë¹„ì˜¥í•œ ë…¼ë°­" },
            "åºš": { name: "ê²½ê¸ˆ", hanja: "åºšé‡‘", nature: "ë‹¨ë‹¨í•˜ê³  ë‚ ì¹´ë¡œìš´ ì¹¼ê³¼ ë„ë¼" },
            "è¾›": { name: "ì‹ ê¸ˆ", hanja: "è¾›é‡‘", nature: "ì •êµí•˜ê²Œ ë‹¤ë“¬ì–´ì§„ ë³´ì„" },
            "å£¬": { name: "ì„ìˆ˜", hanja: "å£¬æ°´", nature: "ëª¨ë“  ê²ƒì„ í’ˆëŠ” ë„“ì€ ë°”ë‹¤" },
            "ç™¸": { name: "ê³„ìˆ˜", hanja: "ç™¸æ°´", nature: "ëŠì„ì—†ì´ ì†Ÿì•„ë‚˜ëŠ” ë§‘ì€ ìƒ˜ë¬¼" }
        };

        // ========== ì§„íƒœì–‘ì‹œ ë³€í™˜ìš© ì§€ì—­ ë°ì´í„° ==========
        const GLOBAL_CITIES = {
            "KR": {
                name: "í•œêµ­",
                flag: "ğŸ‡°ğŸ‡·",
                utcOffset: 9,
                cities: {
                    "ì„œìš¸": { lat: 37.57, lng: 127.00 },
                    "ì¸ì²œ": { lat: 37.45, lng: 126.71 },
                    "ìˆ˜ì›": { lat: 37.26, lng: 127.03 },
                    "ê³ ì–‘": { lat: 37.66, lng: 126.83 },
                    "ìš©ì¸": { lat: 37.24, lng: 127.18 },
                    "ì„±ë‚¨": { lat: 37.42, lng: 127.13 },
                    "ë¶€ì²œ": { lat: 37.50, lng: 126.76 },
                    "ë¶€ì‚°": { lat: 35.18, lng: 129.04 },
                    "ëŒ€êµ¬": { lat: 35.87, lng: 128.60 },
                    "ëŒ€ì „": { lat: 36.35, lng: 127.39 },
                    "ê´‘ì£¼": { lat: 35.16, lng: 126.85 },
                    "ìš¸ì‚°": { lat: 35.54, lng: 129.31 },
                    "ì„¸ì¢…": { lat: 36.48, lng: 127.29 },
                    "ì²­ì£¼": { lat: 36.64, lng: 127.49 },
                    "ì „ì£¼": { lat: 35.82, lng: 127.15 },
                    "ì²œì•ˆ": { lat: 36.81, lng: 127.11 },
                    "ì°½ì›": { lat: 35.23, lng: 128.68 },
                    "í¬í•­": { lat: 36.02, lng: 129.37 },
                    "ì œì£¼": { lat: 33.50, lng: 126.53 },
                    "ê°•ë¦‰": { lat: 37.75, lng: 128.88 },
                    "ì¶˜ì²œ": { lat: 37.87, lng: 127.73 },
                    "ì›ì£¼": { lat: 37.34, lng: 127.95 },
                    "ì—¬ìˆ˜": { lat: 34.76, lng: 127.66 },
                    "ìˆœì²œ": { lat: 34.95, lng: 127.49 },
                    "ëª©í¬": { lat: 34.81, lng: 126.39 },
                    "êµ°ì‚°": { lat: 35.97, lng: 126.71 },
                    "ìµì‚°": { lat: 35.95, lng: 126.96 },
                    "ê²½ì£¼": { lat: 35.86, lng: 129.21 },
                    "ì•ˆë™": { lat: 36.57, lng: 128.73 },
                    "ê¹€í•´": { lat: 35.23, lng: 128.89 },
                    "êµ¬ë¯¸": { lat: 36.12, lng: 128.34 }
                }
            },
            "US": {
                name: "ë¯¸êµ­",
                flag: "ğŸ‡ºğŸ‡¸",
                utcOffset: null,
                cities: {
                    "ë‰´ìš•": { lat: 40.71, lng: -74.01, utcOffset: -5, dst: true },
                    "ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤": { lat: 34.05, lng: -118.24, utcOffset: -8, dst: true },
                    "ì‹œì¹´ê³ ": { lat: 41.88, lng: -87.63, utcOffset: -6, dst: true },
                    "íœ´ìŠ¤í„´": { lat: 29.76, lng: -95.37, utcOffset: -6, dst: true },
                    "í”¼ë‹‰ìŠ¤": { lat: 33.45, lng: -112.07, utcOffset: -7, dst: false },
                    "ìƒŒí”„ë€ì‹œìŠ¤ì½”": { lat: 37.77, lng: -122.42, utcOffset: -8, dst: true },
                    "ì‹œì• í‹€": { lat: 47.61, lng: -122.33, utcOffset: -8, dst: true },
                    "ë´ë²„": { lat: 39.74, lng: -104.99, utcOffset: -7, dst: true },
                    "ë³´ìŠ¤í„´": { lat: 42.36, lng: -71.06, utcOffset: -5, dst: true },
                    "ì• í‹€ëœíƒ€": { lat: 33.75, lng: -84.39, utcOffset: -5, dst: true },
                    "ë§ˆì´ì• ë¯¸": { lat: 25.76, lng: -80.19, utcOffset: -5, dst: true },
                    "ë¼ìŠ¤ë² ì´ê±°ìŠ¤": { lat: 36.17, lng: -115.14, utcOffset: -8, dst: true },
                    "í•˜ì™€ì´(í˜¸ë†€ë£°ë£¨)": { lat: 21.31, lng: -157.86, utcOffset: -10, dst: false }
                }
            },
            "JP": {
                name: "ì¼ë³¸",
                flag: "ğŸ‡¯ğŸ‡µ",
                utcOffset: 9,
                cities: {
                    "ë„ì¿„": { lat: 35.68, lng: 139.69 },
                    "ì˜¤ì‚¬ì¹´": { lat: 34.69, lng: 135.50 },
                    "ë‚˜ê³ ì•¼": { lat: 35.18, lng: 136.91 },
                    "ì‚¿í¬ë¡œ": { lat: 43.06, lng: 141.35 },
                    "í›„ì¿ ì˜¤ì¹´": { lat: 33.59, lng: 130.40 },
                    "êµí† ": { lat: 35.01, lng: 135.77 },
                    "ê³ ë² ": { lat: 34.69, lng: 135.20 },
                    "ìš”ì½”í•˜ë§ˆ": { lat: 35.44, lng: 139.64 },
                    "ì˜¤í‚¤ë‚˜ì™€(ë‚˜í•˜)": { lat: 26.21, lng: 127.68 }
                }
            },
            "CN": {
                name: "ì¤‘êµ­",
                flag: "ğŸ‡¨ğŸ‡³",
                utcOffset: 8,
                cities: {
                    "ë² ì´ì§•": { lat: 39.90, lng: 116.41 },
                    "ìƒí•˜ì´": { lat: 31.23, lng: 121.47 },
                    "ê´‘ì €ìš°": { lat: 23.13, lng: 113.26 },
                    "ì„ ì „": { lat: 22.54, lng: 114.06 },
                    "ì²­ë‘": { lat: 30.57, lng: 104.07 },
                    "ì¶©ì¹­": { lat: 29.43, lng: 106.91 },
                    "í†ˆì§„": { lat: 39.13, lng: 117.20 },
                    "ìš°í•œ": { lat: 30.59, lng: 114.31 },
                    "í•­ì €ìš°": { lat: 30.27, lng: 120.15 },
                    "ì‹œì•ˆ": { lat: 34.27, lng: 108.95 },
                    "ì¹­ë‹¤ì˜¤": { lat: 36.07, lng: 120.38 },
                    "ë‹¤ë¡„": { lat: 38.91, lng: 121.60 },
                    "í•˜ì–¼ë¹ˆ": { lat: 45.80, lng: 126.53 },
                    "ì„ ì–‘": { lat: 41.80, lng: 123.43 }
                }
            },
            "TW": {
                name: "ëŒ€ë§Œ",
                flag: "ğŸ‡¹ğŸ‡¼",
                utcOffset: 8,
                cities: {
                    "íƒ€ì´ë² ì´": { lat: 25.03, lng: 121.57 },
                    "ê°€ì˜¤ìŠ": { lat: 22.62, lng: 120.31 },
                    "íƒ€ì´ì¤‘": { lat: 24.15, lng: 120.67 }
                }
            },
            "GB": {
                name: "ì˜êµ­",
                flag: "ğŸ‡¬ğŸ‡§",
                utcOffset: 0,
                cities: {
                    "ëŸ°ë˜": { lat: 51.51, lng: -0.13, dst: true },
                    "ë§¨ì²´ìŠ¤í„°": { lat: 53.48, lng: -2.24, dst: true },
                    "ë²„ë°ì—„": { lat: 52.49, lng: -1.90, dst: true },
                    "ì—ë“ ë²„ëŸ¬": { lat: 55.95, lng: -3.19, dst: true }
                }
            },
            "DE": {
                name: "ë…ì¼",
                flag: "ğŸ‡©ğŸ‡ª",
                utcOffset: 1,
                cities: {
                    "ë² ë¥¼ë¦°": { lat: 52.52, lng: 13.41, dst: true },
                    "ë®Œí—¨": { lat: 48.14, lng: 11.58, dst: true },
                    "í•¨ë¶€ë¥´í¬": { lat: 53.55, lng: 9.99, dst: true },
                    "í”„ë‘í¬í‘¸ë¥´íŠ¸": { lat: 50.11, lng: 8.68, dst: true }
                }
            },
            "FR": {
                name: "í”„ë‘ìŠ¤",
                flag: "ğŸ‡«ğŸ‡·",
                utcOffset: 1,
                cities: {
                    "íŒŒë¦¬": { lat: 48.86, lng: 2.35, dst: true },
                    "ë§ˆë¥´ì„¸ìœ ": { lat: 43.30, lng: 5.37, dst: true },
                    "ë¦¬ì˜¹": { lat: 45.76, lng: 4.84, dst: true }
                }
            },
            "AU": {
                name: "í˜¸ì£¼",
                flag: "ğŸ‡¦ğŸ‡º",
                utcOffset: null,
                cities: {
                    "ì‹œë“œë‹ˆ": { lat: -33.87, lng: 151.21, utcOffset: 10, dst: true },
                    "ë©œë²„ë¥¸": { lat: -37.81, lng: 144.96, utcOffset: 10, dst: true },
                    "ë¸Œë¦¬ì¦ˆë²ˆ": { lat: -27.47, lng: 153.03, utcOffset: 10, dst: false },
                    "í¼ìŠ¤": { lat: -31.95, lng: 115.86, utcOffset: 8, dst: false }
                }
            },
            "CA": {
                name: "ìºë‚˜ë‹¤",
                flag: "ğŸ‡¨ğŸ‡¦",
                utcOffset: null,
                cities: {
                    "í† ë¡ í† ": { lat: 43.65, lng: -79.38, utcOffset: -5, dst: true },
                    "ë°´ì¿ ë²„": { lat: 49.28, lng: -123.12, utcOffset: -8, dst: true },
                    "ëª¬íŠ¸ë¦¬ì˜¬": { lat: 45.50, lng: -73.57, utcOffset: -5, dst: true },
                    "ìº˜ê±°ë¦¬": { lat: 51.05, lng: -114.07, utcOffset: -7, dst: true }
                }
            },
            "SG": {
                name: "ì‹±ê°€í¬ë¥´",
                flag: "ğŸ‡¸ğŸ‡¬",
                utcOffset: 8,
                cities: {
                    "ì‹±ê°€í¬ë¥´": { lat: 1.35, lng: 103.82 }
                }
            },
            "VN": {
                name: "ë² íŠ¸ë‚¨",
                flag: "ğŸ‡»ğŸ‡³",
                utcOffset: 7,
                cities: {
                    "í˜¸ì¹˜ë¯¼": { lat: 10.82, lng: 106.63 },
                    "í•˜ë…¸ì´": { lat: 21.03, lng: 105.85 },
                    "ë‹¤ë‚­": { lat: 16.05, lng: 108.22 }
                }
            },
            "TH": {
                name: "íƒœêµ­",
                flag: "ğŸ‡¹ğŸ‡­",
                utcOffset: 7,
                cities: {
                    "ë°©ì½•": { lat: 13.76, lng: 100.50 },
                    "ì¹˜ì•™ë§ˆì´": { lat: 18.79, lng: 98.98 },
                    "í‘¸ì¼“": { lat: 7.89, lng: 98.40 }
                }
            },
            "PH": {
                name: "í•„ë¦¬í•€",
                flag: "ğŸ‡µğŸ‡­",
                utcOffset: 8,
                cities: {
                    "ë§ˆë‹ë¼": { lat: 14.60, lng: 120.98 },
                    "ì„¸ë¶€": { lat: 10.32, lng: 123.89 }
                }
            },
            "MY": {
                name: "ë§ë ˆì´ì‹œì•„",
                flag: "ğŸ‡²ğŸ‡¾",
                utcOffset: 8,
                cities: {
                    "ì¿ ì•Œë¼ë£¸í‘¸ë¥´": { lat: 3.14, lng: 101.69 }
                }
            },
            "ID": {
                name: "ì¸ë„ë„¤ì‹œì•„",
                flag: "ğŸ‡®ğŸ‡©",
                utcOffset: null,
                cities: {
                    "ìì¹´ë¥´íƒ€": { lat: -6.21, lng: 106.85, utcOffset: 7 },
                    "ë°œë¦¬(ë´íŒŒì‚¬ë¥´)": { lat: -8.65, lng: 115.22, utcOffset: 8 }
                }
            },
            "NZ": {
                name: "ë‰´ì§ˆëœë“œ",
                flag: "ğŸ‡³ğŸ‡¿",
                utcOffset: 12,
                cities: {
                    "ì˜¤í´ëœë“œ": { lat: -36.85, lng: 174.76, dst: true },
                    "ì›°ë§í„´": { lat: -41.29, lng: 174.78, dst: true }
                }
            },
            "RU": {
                name: "ëŸ¬ì‹œì•„",
                flag: "ğŸ‡·ğŸ‡º",
                utcOffset: null,
                cities: {
                    "ëª¨ìŠ¤í¬ë°”": { lat: 55.76, lng: 37.62, utcOffset: 3 },
                    "ìƒíŠ¸í˜í…Œë¥´ë¶€ë¥´í¬": { lat: 59.93, lng: 30.34, utcOffset: 3 },
                    "ë¸”ë¼ë””ë³´ìŠ¤í† í¬": { lat: 43.12, lng: 131.89, utcOffset: 10 }
                }
            },
            "AE": {
                name: "ì•„ëì—ë¯¸ë¦¬íŠ¸",
                flag: "ğŸ‡¦ğŸ‡ª",
                utcOffset: 4,
                cities: {
                    "ë‘ë°”ì´": { lat: 25.20, lng: 55.27 },
                    "ì•„ë¶€ë‹¤ë¹„": { lat: 24.45, lng: 54.37 }
                }
            },
            "IN": {
                name: "ì¸ë„",
                flag: "ğŸ‡®ğŸ‡³",
                utcOffset: 5.5,
                cities: {
                    "ë­„ë°”ì´": { lat: 19.08, lng: 72.88 },
                    "ë¸ë¦¬": { lat: 28.61, lng: 77.21 },
                    "ë°©ê°ˆë¡œë¥´": { lat: 12.97, lng: 77.59 }
                }
            },
            "CUSTOM": {
                name: "ì§ì ‘ì…ë ¥",
                flag: "ğŸŒ",
                utcOffset: null,
                cities: {}
            }
        };

        // ì§€ì¥ê°„: [ì—¬ê¸°, ì¤‘ê¸°, ì •ê¸°] ìˆœì„œ (ì •ê¸°=ë³¸ê¸°=ë§ˆì§€ë§‰)
        const JIJANGGAN = {
            "å­": ["ç™¸"],                    // ì •ê¸°: ç™¸(30ì¼)
            "ä¸‘": ["ç™¸", "è¾›", "å·±"],        // ì—¬ê¸° ç™¸(9), ì¤‘ê¸° è¾›(3), ì •ê¸° å·±(18)
            "å¯…": ["æˆŠ", "ä¸™", "ç”²"],        // ì—¬ê¸° æˆŠ(7), ì¤‘ê¸° ä¸™(7), ì •ê¸° ç”²(16)
            "å¯": ["ä¹™"],                    // ì •ê¸°: ä¹™(30ì¼)
            "è¾°": ["ä¹™", "ç™¸", "æˆŠ"],        // ì—¬ê¸° ä¹™(9), ì¤‘ê¸° ç™¸(3), ì •ê¸° æˆŠ(18)
            "å·³": ["æˆŠ", "åºš", "ä¸™"],        // ì—¬ê¸° æˆŠ(7), ì¤‘ê¸° åºš(7), ì •ê¸° ä¸™(16)
            "åˆ": ["å·±", "ä¸"],              // ì¤‘ê¸° å·±(9), ì •ê¸° ä¸(21)
            "æœª": ["ä¸", "ä¹™", "å·±"],        // ì—¬ê¸° ä¸(9), ì¤‘ê¸° ä¹™(3), ì •ê¸° å·±(18)
            "ç”³": ["æˆŠ", "å£¬", "åºš"],        // ì—¬ê¸° æˆŠ(7), ì¤‘ê¸° å£¬(7), ì •ê¸° åºš(16)
            "é…‰": ["è¾›"],                    // ì •ê¸°: è¾›(30ì¼)
            "æˆŒ": ["è¾›", "ä¸", "æˆŠ"],        // ì—¬ê¸° è¾›(9), ì¤‘ê¸° ä¸(3), ì •ê¸° æˆŠ(18)
            "äº¥": ["ç”²", "å£¬"]               // ì¤‘ê¸° ç”²(7), ì •ê¸° å£¬(23)
        };
        
        // ì§€ì¥ê°„ ì ìœ ì¼ìˆ˜ ë¹„ìœ¨ (30ì¼ ê¸°ì¤€, ìˆœì„œëŠ” JIJANGGANê³¼ ë™ì¼)
        const JIJANGGAN_RATIO = {
            "å­": [30],           // ç™¸ 100%
            "ä¸‘": [9, 3, 18],     // ç™¸ 30%, è¾› 10%, å·± 60%
            "å¯…": [7, 7, 16],     // æˆŠ 23%, ä¸™ 23%, ç”² 54%
            "å¯": [30],           // ä¹™ 100%
            "è¾°": [9, 3, 18],     // ä¹™ 30%, ç™¸ 10%, æˆŠ 60%
            "å·³": [7, 7, 16],     // æˆŠ 23%, åºš 23%, ä¸™ 54%
            "åˆ": [9, 21],        // å·± 30%, ä¸ 70%
            "æœª": [9, 3, 18],     // ä¸ 30%, ä¹™ 10%, å·± 60%
            "ç”³": [7, 7, 16],     // æˆŠ 23%, å£¬ 23%, åºš 54%
            "é…‰": [30],           // è¾› 100%
            "æˆŒ": [9, 3, 18],     // è¾› 30%, ä¸ 10%, æˆŠ 60%
            "äº¥": [7, 23]         // ç”² 23%, å£¬ 77%
        };
        
        const SIPSUNG_MATRIX = {
            "ç”²": {"ç”²": "ë¹„ê²¬", "ä¹™": "ê²ì¬", "ä¸™": "ì‹ì‹ ", "ä¸": "ìƒê´€", "æˆŠ": "í¸ì¬", "å·±": "ì •ì¬", "åºš": "í¸ê´€", "è¾›": "ì •ê´€", "å£¬": "í¸ì¸", "ç™¸": "ì •ì¸"},
            "ä¹™": {"ç”²": "ê²ì¬", "ä¹™": "ë¹„ê²¬", "ä¸™": "ìƒê´€", "ä¸": "ì‹ì‹ ", "æˆŠ": "ì •ì¬", "å·±": "í¸ì¬", "åºš": "ì •ê´€", "è¾›": "í¸ê´€", "å£¬": "ì •ì¸", "ç™¸": "í¸ì¸"},
            "ä¸™": {"ç”²": "í¸ì¸", "ä¹™": "ì •ì¸", "ä¸™": "ë¹„ê²¬", "ä¸": "ê²ì¬", "æˆŠ": "ì‹ì‹ ", "å·±": "ìƒê´€", "åºš": "í¸ì¬", "è¾›": "ì •ì¬", "å£¬": "í¸ê´€", "ç™¸": "ì •ê´€"},
            "ä¸": {"ç”²": "ì •ì¸", "ä¹™": "í¸ì¸", "ä¸™": "ê²ì¬", "ä¸": "ë¹„ê²¬", "æˆŠ": "ìƒê´€", "å·±": "ì‹ì‹ ", "åºš": "ì •ì¬", "è¾›": "í¸ì¬", "å£¬": "ì •ê´€", "ç™¸": "í¸ê´€"},
            "æˆŠ": {"ç”²": "í¸ê´€", "ä¹™": "ì •ê´€", "ä¸™": "í¸ì¸", "ä¸": "ì •ì¸", "æˆŠ": "ë¹„ê²¬", "å·±": "ê²ì¬", "åºš": "ì‹ì‹ ", "è¾›": "ìƒê´€", "å£¬": "í¸ì¬", "ç™¸": "ì •ì¬"},
            "å·±": {"ç”²": "ì •ê´€", "ä¹™": "í¸ê´€", "ä¸™": "ì •ì¸", "ä¸": "í¸ì¸", "æˆŠ": "ê²ì¬", "å·±": "ë¹„ê²¬", "åºš": "ìƒê´€", "è¾›": "ì‹ì‹ ", "å£¬": "ì •ì¬", "ç™¸": "í¸ì¬"},
            "åºš": {"ç”²": "í¸ì¬", "ä¹™": "ì •ì¬", "ä¸™": "í¸ê´€", "ä¸": "ì •ê´€", "æˆŠ": "í¸ì¸", "å·±": "ì •ì¸", "åºš": "ë¹„ê²¬", "è¾›": "ê²ì¬", "å£¬": "ì‹ì‹ ", "ç™¸": "ìƒê´€"},
            "è¾›": {"ç”²": "ì •ì¬", "ä¹™": "í¸ì¬", "ä¸™": "ì •ê´€", "ä¸": "í¸ê´€", "æˆŠ": "ì •ì¸", "å·±": "í¸ì¸", "åºš": "ê²ì¬", "è¾›": "ë¹„ê²¬", "å£¬": "ìƒê´€", "ç™¸": "ì‹ì‹ "},
            "å£¬": {"ç”²": "ì‹ì‹ ", "ä¹™": "ìƒê´€", "ä¸™": "í¸ì¬", "ä¸": "ì •ì¬", "æˆŠ": "í¸ê´€", "å·±": "ì •ê´€", "åºš": "í¸ì¸", "è¾›": "ì •ì¸", "å£¬": "ë¹„ê²¬", "ç™¸": "ê²ì¬"},
            "ç™¸": {"ç”²": "ìƒê´€", "ä¹™": "ì‹ì‹ ", "ä¸™": "ì •ì¬", "ä¸": "í¸ì¬", "æˆŠ": "ì •ê´€", "å·±": "í¸ê´€", "åºš": "ì •ì¸", "è¾›": "í¸ì¸", "å£¬": "ê²ì¬", "ç™¸": "ë¹„ê²¬"}
        };
        
        const SIPSUNG_GROUP = {
            "ë¹„ê²¬": "ë¹„ê²", "ê²ì¬": "ë¹„ê²",
            "ì‹ì‹ ": "ì‹ìƒ", "ìƒê´€": "ì‹ìƒ",
            "í¸ì¬": "ì¬ì„±", "ì •ì¬": "ì¬ì„±",
            "í¸ê´€": "ê´€ì„±", "ì •ê´€": "ê´€ì„±",
            "í¸ì¸": "ì¸ì„±", "ì •ì¸": "ì¸ì„±"
        };

        // ========== í•©ì¶©í˜•íŒŒí•´(åˆæ²–åˆ‘ç ´å®³) ê·œì¹™ ==========

        // ì²œê°„í•© (å¤©å¹²åˆ) - 5ê°œ
        const CHEONGAN_HAP = {
            "ç”²": { partner: "å·±", result: "í† ", resultHanja: "åœŸ" },
            "å·±": { partner: "ç”²", result: "í† ", resultHanja: "åœŸ" },
            "ä¹™": { partner: "åºš", result: "ê¸ˆ", resultHanja: "é‡‘" },
            "åºš": { partner: "ä¹™", result: "ê¸ˆ", resultHanja: "é‡‘" },
            "ä¸™": { partner: "è¾›", result: "ìˆ˜", resultHanja: "æ°´" },
            "è¾›": { partner: "ä¸™", result: "ìˆ˜", resultHanja: "æ°´" },
            "ä¸": { partner: "å£¬", result: "ëª©", resultHanja: "æœ¨" },
            "å£¬": { partner: "ä¸", result: "ëª©", resultHanja: "æœ¨" },
            "æˆŠ": { partner: "ç™¸", result: "í™”", resultHanja: "ç«" },
            "ç™¸": { partner: "æˆŠ", result: "í™”", resultHanja: "ç«" }
        };

        // ì§€ì§€ìœ¡í•© (åœ°æ”¯å…­åˆ) - 6ê°œ
        const JIJI_YUKHAP = {
            "å­": { partner: "ä¸‘", result: "í† ", resultHanja: "åœŸ" },
            "ä¸‘": { partner: "å­", result: "í† ", resultHanja: "åœŸ" },
            "å¯…": { partner: "äº¥", result: "ëª©", resultHanja: "æœ¨" },
            "äº¥": { partner: "å¯…", result: "ëª©", resultHanja: "æœ¨" },
            "å¯": { partner: "æˆŒ", result: "í™”", resultHanja: "ç«" },
            "æˆŒ": { partner: "å¯", result: "í™”", resultHanja: "ç«" },
            "è¾°": { partner: "é…‰", result: "ê¸ˆ", resultHanja: "é‡‘" },
            "é…‰": { partner: "è¾°", result: "ê¸ˆ", resultHanja: "é‡‘" },
            "å·³": { partner: "ç”³", result: "ìˆ˜", resultHanja: "æ°´" },
            "ç”³": { partner: "å·³", result: "ìˆ˜", resultHanja: "æ°´" },
            "åˆ": { partner: "æœª", result: "í™”", resultHanja: "ç«" },
            "æœª": { partner: "åˆ", result: "í™”", resultHanja: "ç«" }
        };

        // ì§€ì§€ì‚¼í•© (åœ°æ”¯ä¸‰åˆ) - 4ê°œ
        const JIJI_SAMHAP = [
            { members: ["ç”³", "å­", "è¾°"], result: "ìˆ˜êµ­", resultHanja: "æ°´å±€", center: "å­" },
            { members: ["å¯…", "åˆ", "æˆŒ"], result: "í™”êµ­", resultHanja: "ç«å±€", center: "åˆ" },
            { members: ["å·³", "é…‰", "ä¸‘"], result: "ê¸ˆêµ­", resultHanja: "é‡‘å±€", center: "é…‰" },
            { members: ["äº¥", "å¯", "æœª"], result: "ëª©êµ­", resultHanja: "æœ¨å±€", center: "å¯" }
        ];

        // ì§€ì§€ë°©í•© (åœ°æ”¯æ–¹åˆ) - 4ê°œ
        const JIJI_BANGHAP = [
            { members: ["å¯…", "å¯", "è¾°"], result: "ë™ë°©ëª©êµ­", resultHanja: "æ±æ–¹æœ¨å±€", season: "ë´„" },
            { members: ["å·³", "åˆ", "æœª"], result: "ë‚¨ë°©í™”êµ­", resultHanja: "å—æ–¹ç«å±€", season: "ì—¬ë¦„" },
            { members: ["ç”³", "é…‰", "æˆŒ"], result: "ì„œë°©ê¸ˆêµ­", resultHanja: "è¥¿æ–¹é‡‘å±€", season: "ê°€ì„" },
            { members: ["äº¥", "å­", "ä¸‘"], result: "ë¶ë°©ìˆ˜êµ­", resultHanja: "åŒ—æ–¹æ°´å±€", season: "ê²¨ìš¸" }
        ];

        // ì§€ì§€ì¶© (åœ°æ”¯æ²–) - 6ê°œ (ì •ë°˜ëŒ€ ìœ„ì¹˜)
        const JIJI_CHUNG = {
            "å­": "åˆ", "åˆ": "å­",
            "ä¸‘": "æœª", "æœª": "ä¸‘",
            "å¯…": "ç”³", "ç”³": "å¯…",
            "å¯": "é…‰", "é…‰": "å¯",
            "è¾°": "æˆŒ", "æˆŒ": "è¾°",
            "å·³": "äº¥", "äº¥": "å·³"
        };

        // ì§€ì§€í˜• (åœ°æ”¯åˆ‘) - 3ì¢…ë¥˜
        const JIJI_HYUNG = {
            // ë¬´ë¡€ì§€í˜• (ì‚¼í˜•ì‚´) - ìˆœí™˜
            ë¬´ë¡€ì§€í˜•: { members: ["å¯…", "å·³", "ç”³"], description: "ë¬´ë¡€ì§€í˜• - ì˜ˆì˜ ì—†ìŒ, ê´€ì¬ìˆ˜" },
            // ë¬´ì€ì§€í˜• (ì‚¼í˜•ì‚´) - ìˆœí™˜
            ë¬´ì€ì§€í˜•: { members: ["ä¸‘", "æˆŒ", "æœª"], description: "ë¬´ì€ì§€í˜• - ì€í˜œ ëª¨ë¦„, ë°°ì‹ " },
            // ìí˜• (ìŠ¤ìŠ¤ë¡œ í•´ì¹¨)
            ìí˜•: { members: ["è¾°", "åˆ", "é…‰", "äº¥"], description: "ìí˜• - ìŠ¤ìŠ¤ë¡œ í•´ì¹¨" },
            // ìƒí˜• (ì„œë¡œ í˜•)
            ìƒí˜•: { pairs: [["å­", "å¯"]], description: "ìƒí˜• - ë¬´ë¡€, í˜•ë²Œ" }
        };

        // ì§€ì§€íŒŒ (åœ°æ”¯ç ´) - 6ê°œ
        const JIJI_PA = {
            "å­": "é…‰", "é…‰": "å­",
            "ä¸‘": "è¾°", "è¾°": "ä¸‘",
            "å¯…": "äº¥", "äº¥": "å¯…",
            "å¯": "åˆ", "åˆ": "å¯",
            "å·³": "ç”³", "ç”³": "å·³",
            "æœª": "æˆŒ", "æˆŒ": "æœª"
        };

        // ì§€ì§€í•´ (åœ°æ”¯å®³/ç©¿) - 6ê°œ (ìœ¡í•´)
        const JIJI_HAE = {
            "å­": "æœª", "æœª": "å­",
            "ä¸‘": "åˆ", "åˆ": "ä¸‘",
            "å¯…": "å·³", "å·³": "å¯…",
            "å¯": "è¾°", "è¾°": "å¯",
            "ç”³": "äº¥", "äº¥": "ç”³",
            "é…‰": "æˆŒ", "æˆŒ": "é…‰"
        };

        // ì›ì§„ (æ€¨å—”) - ì´ë¯¸ ì‹ ì‚´ì— ìˆì§€ë§Œ ì—¬ê¸°ë„ ì •ì˜
        const JIJI_WONJIN = {
            "å­": "æœª", "æœª": "å­",
            "ä¸‘": "åˆ", "åˆ": "ä¸‘",
            "å¯…": "é…‰", "é…‰": "å¯…",
            "å¯": "ç”³", "ç”³": "å¯",
            "è¾°": "äº¥", "äº¥": "è¾°",
            "å·³": "æˆŒ", "æˆŒ": "å·³"
        };

        // ========== ì‹ ì‚´(ç¥æ®º) 20ì¢… ê·œì¹™ ==========
        // ========================================
        // ê²€ì¦ ì™„ë£Œ ì‹ ì‚´ ê·œì¹™ (2026-01-06)
        // ì¤‘êµ­ì–´ ì›ì „ ë° ë‹¤ìˆ˜ ì¶œì²˜ êµì°¨ ê²€ì¦
        // ========================================

        const SINSAL_RULES = {
            // ========================================
            // === ê¸¸ì‹  (ì¢‹ì€ ê¸°ìš´) ===
            // ========================================
    
            ì²œì„ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ê·€ì¸ì˜ ê¸°ìš´ - ì–´ë ¤ìš¸ ë•Œ ë„ì›€ë°›ìŒ",
                rule: {
                    "ç”²": ["ä¸‘", "æœª"], "æˆŠ": ["ä¸‘", "æœª"], "åºš": ["ä¸‘", "æœª"],
                    "ä¹™": ["å­", "ç”³"], "å·±": ["å­", "ç”³"],
                    "ä¸™": ["äº¥", "é…‰"], "ä¸": ["äº¥", "é…‰"],
                    "å£¬": ["å¯", "å·³"], "ç™¸": ["å¯", "å·³"],
                    "è¾›": ["å¯…", "åˆ"]
                }
            },
    
            ë¬¸ì°½ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "í•™ì—…ì˜ ê¸°ìš´ - ê³µë¶€, ì‹œí—˜ìš´ ì¢‹ìŒ",
                rule: {
                    "ç”²": ["å·³"], "ä¹™": ["åˆ"], "ä¸™": ["ç”³"], "ä¸": ["é…‰"], "æˆŠ": ["ç”³"],
                    "å·±": ["é…‰"], "åºš": ["äº¥"], "è¾›": ["å­"], "å£¬": ["å¯…"], "ç™¸": ["å¯"]
                }
            },
    
            ë¬¸ê³¡ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ë¬¸ì˜ˆì˜ ê¸°ìš´ - ì°½ì‘, ì˜ˆìˆ  ì¬ëŠ¥",
                rule: {
                    "ç”²": ["äº¥"], "ä¹™": ["å­"], "ä¸™": ["å¯…"], "ä¸": ["å¯"], "æˆŠ": ["å¯…"],
                    "å·±": ["å¯"], "åºš": ["å·³"], "è¾›": ["åˆ"], "å£¬": ["ç”³"], "ç™¸": ["é…‰"]
                }
            },
    
            ì²œë•ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì›”ì§€", description: "í•˜ëŠ˜ì˜ ë• - ì¬ë‚œì„ í”¼í•¨",
                rule: {
                    "å¯…": ["ä¸"], "å¯": ["ç”³"], "è¾°": ["å£¬"], "å·³": ["è¾›"], "åˆ": ["äº¥"], "æœª": ["ç”²"],
                    "ç”³": ["ç™¸"], "é…‰": ["å¯…"], "æˆŒ": ["ä¸™"], "äº¥": ["ä¹™"], "å­": ["å·³"], "ä¸‘": ["åºš"]
                },
                matchType: "ì „ì²´"
            },
    
            ì›”ë•ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì›”ì§€", description: "ë‹¬ì˜ ë• - í‰ì•ˆí•¨, ì•ˆì •",
                rule: {
                    "å¯…": ["ä¸™"], "åˆ": ["ä¸™"], "æˆŒ": ["ä¸™"],
                    "ç”³": ["å£¬"], "å­": ["å£¬"], "è¾°": ["å£¬"],
                    "äº¥": ["ç”²"], "å¯": ["ç”²"], "æœª": ["ç”²"],
                    "å·³": ["åºš"], "é…‰": ["åºš"], "ä¸‘": ["åºš"]
                },
                matchType: "ì²œê°„"
            },
    
            í•™ë‹¹ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "í•™ë¬¸ì˜ ê¸°ìš´ - ë°°ì›€ì— ì¬ëŠ¥",
                rule: {
                    "ç”²": ["äº¥"], "ä¹™": ["äº¥"],
                    "ä¸™": ["å¯…"], "ä¸": ["å¯…"],
                    "æˆŠ": ["ç”³"], "å·±": ["ç”³"],
                    "åºš": ["å·³"], "è¾›": ["å·³"],
                    "å£¬": ["ç”³"], "ç™¸": ["ç”³"]
                }
            },
    
            ê¸ˆì—¬ë¡: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ê²°í˜¼ìš´ - ë°°ìš°ìë³µ, ê·€í•œ ì¸ì—°",
                rule: {
                    "ç”²": ["è¾°"], "ä¹™": ["å·³"], "ä¸™": ["æœª"], "ä¸": ["ç”³"], "æˆŠ": ["æœª"],
                    "å·±": ["ç”³"], "åºš": ["æˆŒ"], "è¾›": ["äº¥"], "å£¬": ["ä¸‘"], "ç™¸": ["å¯…"]
                }
            },
    
            ì²œì£¼ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ì²œì£¼ì˜ ê¸°ìš´ - ì£¼ë°©, ìŒì‹ ì¬ëŠ¥",
                rule: {
                    "ç”²": ["æœª", "å·³"], "ä¹™": ["ç”³", "åˆ"], "ä¸™": ["é…‰", "æœª"], "ä¸": ["äº¥", "é…‰"],
                    "æˆŠ": ["é…‰", "æœª"], "å·±": ["äº¥", "é…‰"], "åºš": ["äº¥", "ä¸‘"], "è¾›": ["å¯…", "å­"],
                    "å£¬": ["å¯", "å¯…"], "ç™¸": ["å·³", "è¾°"]
                }
            },
    
            ë³µì„±ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ë³µì˜ ê¸°ìš´ - í–‰ìš´, ì¢‹ì€ ì¼ ìƒê¹€",
                rule: {
                    "ç”²": ["å¯…", "å­"], "ä¸™": ["å¯…", "å­"],
                    "ä¹™": ["ä¸‘", "å¯"], "ç™¸": ["ä¸‘", "å¯"],
                    "æˆŠ": ["ç”³"], "å·±": ["æœª"], "ä¸": ["äº¥"],
                    "åºš": ["åˆ"], "è¾›": ["å·³"], "å£¬": ["è¾°"]
                }
            },
    
            íƒœê·¹ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "íƒœê·¹ì˜ ê¸°ìš´ - ì¢…êµ, ì² í•™ ì¸ì—°",
                rule: {
                    "ç”²": ["å­", "åˆ"], "ä¹™": ["å­", "åˆ"],
                    "ä¸™": ["å¯", "é…‰"], "ä¸": ["å¯", "é…‰"],
                    "æˆŠ": ["è¾°", "æˆŒ", "ä¸‘", "æœª"], "å·±": ["è¾°", "æˆŒ", "ä¸‘", "æœª"],
                    "åºš": ["å¯…", "äº¥"], "è¾›": ["å¯…", "äº¥"],
                    "å£¬": ["å·³", "ç”³"], "ç™¸": ["å·³", "ç”³"]
                }
            },
    
            ì²œì˜ì„±: {
                type: "ê¸¸ì‹ ", basis: "ì›”ì§€", description: "ì˜ë£Œì˜ ê¸°ìš´ - ì˜ë£Œ, ì¹˜ìœ  ì¬ëŠ¥",
                rule: {
                    "å¯…": ["ä¸‘"], "å¯": ["å¯…"], "è¾°": ["å¯"], "å·³": ["è¾°"], "åˆ": ["å·³"], "æœª": ["åˆ"],
                    "ç”³": ["æœª"], "é…‰": ["ç”³"], "æˆŒ": ["é…‰"], "äº¥": ["æˆŒ"], "å­": ["äº¥"], "ä¸‘": ["å­"]
                }
            },
    
            ê±´ë¡: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ê±´ë¡ì˜ ê¸°ìš´ - ì •ì‹ ë…¹ë´‰, ì•ˆì •ì  ì§ì¥",
                rule: {
                    "ç”²": ["å¯…"], "ä¹™": ["å¯"], "ä¸™": ["å·³"], "ä¸": ["åˆ"], "æˆŠ": ["å·³"],
                    "å·±": ["åˆ"], "åºš": ["ç”³"], "è¾›": ["é…‰"], "å£¬": ["äº¥"], "ç™¸": ["å­"]
                }
            },
    
            ì•”ë¡: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "ìˆ¨ì€ ë…¹ - ìˆ¨ì€ ì¬ë¬¼, ëœ»ë°–ì˜ ìˆ˜ì…",
                rule: {
                    "ç”²": ["äº¥"], "ä¹™": ["æˆŒ"], "ä¸™": ["å¯…"], "ä¸": ["æœª"], "æˆŠ": ["å¯…"],
                    "å·±": ["æœª"], "åºš": ["å·³"], "è¾›": ["è¾°"], "å£¬": ["ç”³"], "ç™¸": ["ä¸‘"]
                }
            },
    
            í˜‘ë¡: {
                type: "ê¸¸ì‹ ", basis: "ì¼ê°„", description: "í˜‘ë¡ì˜ ê¸°ìš´ - ì£¼ë³€ì˜ ë„ì›€, í˜‘ì¡°",
                rule: {
                    "ç”²": ["ä¸‘", "å¯"], "ä¹™": ["å¯…", "è¾°"],
                    "ä¸™": ["è¾°", "åˆ"], "ä¸": ["å·³", "æœª"], "æˆŠ": ["è¾°", "åˆ"], "å·±": ["å·³", "æœª"],
                    "åºš": ["æœª", "é…‰"], "è¾›": ["ç”³", "æˆŒ"],
                    "å£¬": ["æˆŒ", "å­"], "ç™¸": ["äº¥", "ä¸‘"]
                }
            },
    
            ì¼ë•: {
                type: "ê¸¸ì‹ ", basis: "ì¼ì£¼", description: "ì¼ë•ì˜ ê¸°ìš´ - ë•ë§, ì¸ê²© ë†’ìŒ",
                rule: ["ç”²å¯…", "ä¸™è¾°", "æˆŠè¾°", "åºšè¾°", "å£¬æˆŒ"]
            },
    
            ì¼ê·€: {
                type: "ê¸¸ì‹ ", basis: "ì¼ì£¼", description: "ì¼ê·€ì˜ ê¸°ìš´ - ê·€í•¨, í’ˆìœ„",
                rule: ["ä¸é…‰", "ä¸äº¥", "ç™¸å·³", "ç™¸å¯"]
            },
    
            ìœ¡ìˆ˜: {
                type: "ê¸¸ì‹ ", basis: "ì¼ì£¼", description: "ìœ¡ìˆ˜ì˜ ê¸°ìš´ - ìˆ˜ë ¤í•¨, ì¬ëŠ¥",
                rule: ["ç”²å¯…", "ä¹™å¯", "ä¸™åˆ", "ä¸å·³", "åºšç”³", "è¾›é…‰"]
            },
    
            ì‹­ë ¹ì¼: {
                type: "ê¸¸ì‹ ", basis: "ì¼ì£¼", description: "ì˜ì  ê°ê° - ì§ê´€ë ¥, ì˜ì„±",
                rule: ["ç”²è¾°", "ä¹™äº¥", "ä¸™è¾°", "ä¸é…‰", "æˆŠåˆ", "åºšå¯…", "åºšæˆŒ", "è¾›äº¥", "å£¬å¯…", "ç™¸æœª"]
            },
    
            // ========================================
            // === 12ì‹ ì‚´ (ë…„ì§€/ì¼ì§€ ê¸°ì¤€) ===
            // ========================================
    
            ì—­ë§ˆì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ì›€ì§ì„ì˜ ê¸°ìš´ - ì´ë™, ë³€í™” ë§ìŒ",
                rule: {
                    "ç”³": ["å¯…"], "å­": ["å¯…"], "è¾°": ["å¯…"],
                    "å¯…": ["ç”³"], "åˆ": ["ç”³"], "æˆŒ": ["ç”³"],
                    "äº¥": ["å·³"], "å¯": ["å·³"], "æœª": ["å·³"],
                    "å·³": ["äº¥"], "é…‰": ["äº¥"], "ä¸‘": ["äº¥"]
                }
            },
    
            ë„í™”ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ë§¤ë ¥ì˜ ê¸°ìš´ - ì´ì„±ìš´, ì¸ê¸°",
                rule: {
                    "ç”³": ["é…‰"], "å­": ["é…‰"], "è¾°": ["é…‰"],
                    "å¯…": ["å¯"], "åˆ": ["å¯"], "æˆŒ": ["å¯"],
                    "äº¥": ["å­"], "å¯": ["å­"], "æœª": ["å­"],
                    "å·³": ["åˆ"], "é…‰": ["åˆ"], "ä¸‘": ["åˆ"]
                }
            },
    
            í™”ê°œì‚´: {
                type: "ê¸¸ì‹ ", basis: "ë…„ì§€", description: "ì˜ˆìˆ ì˜ ê¸°ìš´ - ì°½ì˜ë ¥, ì˜ì  ê°ê°",
                rule: {
                    "ç”³": ["è¾°"], "å­": ["è¾°"], "è¾°": ["è¾°"],
                    "å¯…": ["æˆŒ"], "åˆ": ["æˆŒ"], "æˆŒ": ["æˆŒ"],
                    "äº¥": ["æœª"], "å¯": ["æœª"], "æœª": ["æœª"],
                    "å·³": ["ä¸‘"], "é…‰": ["ä¸‘"], "ä¸‘": ["ä¸‘"]
                }
            },
    
            ì¥ì„±ì‚´: {
                type: "ê¸¸ì‹ ", basis: "ë…„ì§€", description: "ì¥ì„±ì˜ ê¸°ìš´ - ì„±ì¥, ë°œì „",
                rule: {
                    "ç”³": ["å­"], "å­": ["å­"], "è¾°": ["å­"],
                    "å¯…": ["åˆ"], "åˆ": ["åˆ"], "æˆŒ": ["åˆ"],
                    "äº¥": ["å¯"], "å¯": ["å¯"], "æœª": ["å¯"],
                    "å·³": ["é…‰"], "é…‰": ["é…‰"], "ä¸‘": ["é…‰"]
                }
            },
    
            ê²ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ì†ì‹¤ì£¼ì˜ - ì¬ë¬¼ ì†ì‹¤ ì¡°ì‹¬",
                rule: {
                    "ç”³": ["å·³"], "å­": ["å·³"], "è¾°": ["å·³"],
                    "å¯…": ["äº¥"], "åˆ": ["äº¥"], "æˆŒ": ["äº¥"],
                    "äº¥": ["ç”³"], "å¯": ["ç”³"], "æœª": ["ç”³"],
                    "å·³": ["å¯…"], "é…‰": ["å¯…"], "ä¸‘": ["å¯…"]
                }
            },
    
            ì¬ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ì¬ì•™ì˜ ê¸°ìš´ - ì¬ë‚œ ì£¼ì˜",
                rule: {
                    "ç”³": ["åˆ"], "å­": ["åˆ"], "è¾°": ["åˆ"],
                    "å¯…": ["å­"], "åˆ": ["å­"], "æˆŒ": ["å­"],
                    "äº¥": ["é…‰"], "å¯": ["é…‰"], "æœª": ["é…‰"],
                    "å·³": ["å¯"], "é…‰": ["å¯"], "ä¸‘": ["å¯"]
                }
            },
    
            ì²œì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "í•˜ëŠ˜ì˜ ì¬ì•™ - ì²œì¬ì§€ë³€ ì£¼ì˜",
                rule: {
                    "ç”³": ["æœª"], "å­": ["æœª"], "è¾°": ["æœª"],
                    "å¯…": ["ä¸‘"], "åˆ": ["ä¸‘"], "æˆŒ": ["ä¸‘"],
                    "äº¥": ["æˆŒ"], "å¯": ["æˆŒ"], "æœª": ["æˆŒ"],
                    "å·³": ["è¾°"], "é…‰": ["è¾°"], "ä¸‘": ["è¾°"]
                }
            },
    
            ì§€ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ë•…ì˜ ì¬ì•™ - ì•ˆì „ ì£¼ì˜",
                rule: {
                    "ç”³": ["ç”³"], "å­": ["ç”³"], "è¾°": ["ç”³"],
                    "å¯…": ["å¯…"], "åˆ": ["å¯…"], "æˆŒ": ["å¯…"],
                    "äº¥": ["äº¥"], "å¯": ["äº¥"], "æœª": ["äº¥"],
                    "å·³": ["å·³"], "é…‰": ["å·³"], "ä¸‘": ["å·³"]
                }
            },
    
            ì—°ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "í•´ì˜ ì‚´ - ì—°ê°„ ìš´ì„¸ ì˜í–¥",
                rule: {
                    "ç”³": ["é…‰"], "å­": ["é…‰"], "è¾°": ["é…‰"],
                    "å¯…": ["å¯"], "åˆ": ["å¯"], "æˆŒ": ["å¯"],
                    "äº¥": ["å­"], "å¯": ["å­"], "æœª": ["å­"],
                    "å·³": ["åˆ"], "é…‰": ["åˆ"], "ä¸‘": ["åˆ"]
                }
            },
    
            ì›”ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ë‹¬ì˜ ì‚´ - ì›”ê°„ ìš´ì„¸ ì˜í–¥",
                rule: {
                    "ç”³": ["æˆŒ"], "å­": ["æˆŒ"], "è¾°": ["æˆŒ"],
                    "å¯…": ["è¾°"], "åˆ": ["è¾°"], "æˆŒ": ["è¾°"],
                    "äº¥": ["ä¸‘"], "å¯": ["ä¸‘"], "æœª": ["ä¸‘"],
                    "å·³": ["æœª"], "é…‰": ["æœª"], "ä¸‘": ["æœª"]
                }
            },
    
            ë§ì‹ ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ëª…ì˜ˆ ì†ìƒ - ì²´ë©´ ì†ìƒ ì£¼ì˜",
                rule: {
                    "ç”³": ["äº¥"], "å­": ["äº¥"], "è¾°": ["äº¥"],
                    "å¯…": ["å·³"], "åˆ": ["å·³"], "æˆŒ": ["å·³"],
                    "äº¥": ["å¯…"], "å¯": ["å¯…"], "æœª": ["å¯…"],
                    "å·³": ["ç”³"], "é…‰": ["ç”³"], "ä¸‘": ["ç”³"]
                }
            },
    
            ë°˜ì•ˆì‚´: {
                type: "ê¸¸ì‹ ", basis: "ë…„ì§€", description: "ì•ˆì¥ì˜ ê¸°ìš´ - ì•ˆì •, í¸ì•ˆí•¨",
                rule: {
                    "ç”³": ["ä¸‘"], "å­": ["ä¸‘"], "è¾°": ["ä¸‘"],
                    "å¯…": ["æœª"], "åˆ": ["æœª"], "æˆŒ": ["æœª"],
                    "äº¥": ["è¾°"], "å¯": ["è¾°"], "æœª": ["è¾°"],
                    "å·³": ["æˆŒ"], "é…‰": ["æˆŒ"], "ä¸‘": ["æˆŒ"]
                }
            },
    
            // ========================================
            // === ì–‘ë©´ì‹ /í‰ì‹  (ì¡°ì‹¬í•  ê¸°ìš´) ===
            // ========================================
    
            ì–‘ì¸ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ê°„", description: "ê°•í•œ ê¸°ìš´ - ê²°ë‹¨ë ¥, ê³¼ê²©í•¨",
                rule: {
                    "ç”²": ["å¯"], "ä¹™": ["å¯…"],
                    "ä¸™": ["åˆ"], "æˆŠ": ["åˆ"],
                    "ä¸": ["å·³"], "å·±": ["å·³"],
                    "åºš": ["é…‰"], "è¾›": ["ç”³"],
                    "å£¬": ["å­"], "ç™¸": ["äº¥"]
                }
            },
    
            ë¹„ì¸ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ê°„", description: "ë‚ ì•„ê°€ëŠ” ì¹¼ - ìˆ˜ìˆ , ë¶€ìƒ ì£¼ì˜",
                rule: {
                    "ç”²": ["é…‰"], "ä¹™": ["ç”³"],
                    "ä¸™": ["å­"], "æˆŠ": ["å­"],
                    "ä¸": ["äº¥"], "å·±": ["äº¥"],
                    "åºš": ["å¯"], "è¾›": ["å¯…"],
                    "å£¬": ["åˆ"], "ç™¸": ["å·³"]
                }
            },
    
            í™ì—¼ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ê°„", description: "ì—°ì• ì˜ ê¸°ìš´ - ì •ì—´ì  ì‚¬ë‘",
                rule: {
                    "ç”²": ["åˆ"], "ä¹™": ["ç”³"], "ä¸™": ["å¯…"], "ä¸": ["æœª"], "æˆŠ": ["è¾°"],
                    "å·±": ["è¾°"], "åºš": ["æˆŒ"], "è¾›": ["é…‰"], "å£¬": ["å­"], "ç™¸": ["ç”³"]
                }
            },
    
            ì›ì§„ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì§€", description: "ê´€ê³„ ê°ˆë“± - ë¯¸ì›€ë°›ê¸° ì‰¬ì›€",
                rule: {
                    "å­": ["æœª"], "ä¸‘": ["åˆ"], "å¯…": ["é…‰"], "å¯": ["ç”³"],
                    "è¾°": ["äº¥"], "å·³": ["æˆŒ"], "åˆ": ["ä¸‘"], "æœª": ["å­"],
                    "ç”³": ["å¯"], "é…‰": ["å¯…"], "æˆŒ": ["å·³"], "äº¥": ["è¾°"]
                }
            },
    
            ê·€ë¬¸ê´€ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì§€ì§€", description: "ì •ì‹ ì  ê³ í†µ - ìŠ¤íŠ¸ë ˆìŠ¤, ë¶ˆì•ˆ",
                rule: [
                    ["å­", "æœª"], ["ä¸‘", "åˆ"], ["å¯…", "å·³"], ["å¯", "è¾°"], ["ç”³", "äº¥"], ["é…‰", "æˆŒ"]
                ],
                matchType: "ìŒ"
            },
    
            ê³ ì§„ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ì™¸ë¡œì›€ - ê³ ë…, ë…ë¦½ì‹¬ (ë‚¨ì)",
                rule: {
                    "äº¥": ["å¯…"], "å­": ["å¯…"], "ä¸‘": ["å¯…"],
                    "å¯…": ["å·³"], "å¯": ["å·³"], "è¾°": ["å·³"],
                    "å·³": ["ç”³"], "åˆ": ["ç”³"], "æœª": ["ç”³"],
                    "ç”³": ["äº¥"], "é…‰": ["äº¥"], "æˆŒ": ["äº¥"]
                }
            },
    
            ê³¼ìˆ™ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ë°°ìš°ììš´ ì£¼ì˜ - ëŠ¦ì€ ê²°í˜¼ (ì—¬ì)",
                rule: {
                    "äº¥": ["æˆŒ"], "å­": ["æˆŒ"], "ä¸‘": ["æˆŒ"],
                    "å¯…": ["ä¸‘"], "å¯": ["ä¸‘"], "è¾°": ["ä¸‘"],
                    "å·³": ["è¾°"], "åˆ": ["è¾°"], "æœª": ["è¾°"],
                    "ç”³": ["æœª"], "é…‰": ["æœª"], "æˆŒ": ["æœª"]
                }
            },
    
            ë°±í˜¸ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì§€", description: "ì¶©ëŒì˜ ê¸°ìš´ - ê±´ê°•, ì‚¬ê³  ì£¼ì˜",
                rule: {
                    "è¾°": ["è¾°"], "æˆŒ": ["æˆŒ"], "ä¸‘": ["ä¸‘"], "æœª": ["æœª"]
                }
            },
    
            í˜„ì¹¨ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì§€", description: "ë°”ëŠ˜ì˜ ì‚´ - ìˆ˜ìˆ , ì¹¨ìˆ  ê´€ë ¨",
                rule: {
                    "è¾°": ["è¾°"], "å·³": ["å·³"], "åˆ": ["åˆ"]
                }
            },
    
            íƒ•í™”ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì§€", description: "ëœ¨ê±°ìš´ ë¬¼ - í™”ìƒ ì£¼ì˜",
                rule: {
                    "å¯…": ["å¯…"], "åˆ": ["åˆ"], "ä¸‘": ["ä¸‘"]
                }
            },
    
            ë‚™ì •ê´€ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ê°„", description: "ìš°ë¬¼ì— ë¹ ì§ - ì‹¤ìˆ˜, í•¨ì • ì£¼ì˜",
                rule: {
                    "ç”²": ["å·±"], "ä¹™": ["åºš"], "ä¸™": ["è¾›"], "ä¸": ["å£¬"], "æˆŠ": ["ç™¸"],
                    "å·±": ["ç”²"], "åºš": ["ä¹™"], "è¾›": ["ä¸™"], "å£¬": ["ä¸"], "ç™¸": ["æˆŠ"]
                },
                matchType: "ì²œê°„"
            },
    
            ìƒë¬¸ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ìƒë³µì˜ ê¸°ìš´ - ìƒì‚¬ ê´€ë ¨",
                rule: {
                    "å­": ["å¯…"], "ä¸‘": ["å¯"], "å¯…": ["è¾°"], "å¯": ["å·³"], "è¾°": ["åˆ"], "å·³": ["æœª"],
                    "åˆ": ["ç”³"], "æœª": ["é…‰"], "ç”³": ["æˆŒ"], "é…‰": ["äº¥"], "æˆŒ": ["å­"], "äº¥": ["ä¸‘"]
                }
            },
    
            ì¡°ê°ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ë…„ì§€", description: "ì¡°ë¬¸ê°ì˜ ê¸°ìš´ - ì´ë³„ ê´€ë ¨",
                rule: {
                    "å­": ["æˆŒ"], "ä¸‘": ["äº¥"], "å¯…": ["å­"], "å¯": ["ä¸‘"], "è¾°": ["å¯…"], "å·³": ["å¯"],
                    "åˆ": ["è¾°"], "æœª": ["å·³"], "ç”³": ["åˆ"], "é…‰": ["æœª"], "æˆŒ": ["ç”³"], "äº¥": ["é…‰"]
                }
            },
    
            ê¸‰ê°ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì›”ì§€", description: "ë‹¤ë¦¬ ë¶€ìƒ - í•˜ì²´ ê±´ê°• ì£¼ì˜",
                rule: {
                    "å­": ["äº¥"], "ä¸‘": ["æˆŒ"], "å¯…": ["é…‰"], "å¯": ["ç”³"], "è¾°": ["æœª"], "å·³": ["åˆ"],
                    "åˆ": ["å·³"], "æœª": ["è¾°"], "ç”³": ["å¯"], "é…‰": ["å¯…"], "æˆŒ": ["ä¸‘"], "äº¥": ["å­"]
                }
            },
    
            ê²©ê°ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì§€ì§€", description: "ê°ì§„ ê´€ê³„ - ì¸ì—° ë‹¨ì ˆ",
                rule: [
                    ["å­", "äº¥"], ["ä¸‘", "æˆŒ"], ["å¯…", "é…‰"], ["å¯", "ç”³"], ["è¾°", "æœª"], ["å·³", "åˆ"]
                ],
                matchType: "ìŒ"
            },
    
            ê³¡ê°ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ê¸€ì", description: "êµ¬ë¶€ëŸ¬ì§„ ê¸€ì - ë³€í˜•, ì™œê³¡",
                rule: ["ä¹™", "å·±", "å·³", "ä¸‘"]
            },
    
            ê´´ê°•ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "ê°•í•œ ì„±ê²© - ì¹´ë¦¬ìŠ¤ë§ˆ, ê³ ì§‘",
                rule: ["åºšè¾°", "åºšæˆŒ", "å£¬è¾°", "å£¬æˆŒ"]
            },
    
            ì²œë¼ì§€ë§ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì§€ì§€", description: "í•˜ëŠ˜ê³¼ ë•…ì˜ ê·¸ë¬¼ - êµ¬ì†, ì œì•½",
                rule: [
                    ["æˆŒ", "äº¥"], ["è¾°", "å·³"]
                ],
                matchType: "ìŒ"
            },
    
            ê¸ˆì‹ : {
                type: "ì–‘ë©´ì‹ ", basis: "ì‹œì£¼", description: "ê¸ˆì‹ ì˜ ê¸°ìš´ - ê°•ì§í•¨, ê³¼ê²©í•¨",
                rule: ["ä¹™ä¸‘", "å·±å·³", "ç™¸é…‰"]
            },
    
            // ========================================
            // === íŠ¹ìˆ˜ ì‹ ì‚´ (ì¼ì£¼ ê¸°ë°˜) ===
            // ========================================
    
            ê³µë§: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼ìˆœ", description: "ë¹„ì–´ìˆëŠ” ê¸°ìš´ - ë…¸ë ¥í•´ë„ ê²°ê³¼ ëŠ¦ìŒ",
                rule: {
                    "ç”²å­": ["æˆŒ", "äº¥"], "ä¹™ä¸‘": ["æˆŒ", "äº¥"], "ä¸™å¯…": ["æˆŒ", "äº¥"], "ä¸å¯": ["æˆŒ", "äº¥"], "æˆŠè¾°": ["æˆŒ", "äº¥"],
                    "å·±å·³": ["æˆŒ", "äº¥"], "åºšåˆ": ["æˆŒ", "äº¥"], "è¾›æœª": ["æˆŒ", "äº¥"], "å£¬ç”³": ["æˆŒ", "äº¥"], "ç™¸é…‰": ["æˆŒ", "äº¥"],
                    "ç”²æˆŒ": ["ç”³", "é…‰"], "ä¹™äº¥": ["ç”³", "é…‰"], "ä¸™å­": ["ç”³", "é…‰"], "ä¸ä¸‘": ["ç”³", "é…‰"], "æˆŠå¯…": ["ç”³", "é…‰"],
                    "å·±å¯": ["ç”³", "é…‰"], "åºšè¾°": ["ç”³", "é…‰"], "è¾›å·³": ["ç”³", "é…‰"], "å£¬åˆ": ["ç”³", "é…‰"], "ç™¸æœª": ["ç”³", "é…‰"],
                    "ç”²ç”³": ["åˆ", "æœª"], "ä¹™é…‰": ["åˆ", "æœª"], "ä¸™æˆŒ": ["åˆ", "æœª"], "ä¸äº¥": ["åˆ", "æœª"], "æˆŠå­": ["åˆ", "æœª"],
                    "å·±ä¸‘": ["åˆ", "æœª"], "åºšå¯…": ["åˆ", "æœª"], "è¾›å¯": ["åˆ", "æœª"], "å£¬è¾°": ["åˆ", "æœª"], "ç™¸å·³": ["åˆ", "æœª"],
                    "ç”²åˆ": ["è¾°", "å·³"], "ä¹™æœª": ["è¾°", "å·³"], "ä¸™ç”³": ["è¾°", "å·³"], "ä¸é…‰": ["è¾°", "å·³"], "æˆŠæˆŒ": ["è¾°", "å·³"],
                    "å·±äº¥": ["è¾°", "å·³"], "åºšå­": ["è¾°", "å·³"], "è¾›ä¸‘": ["è¾°", "å·³"], "å£¬å¯…": ["è¾°", "å·³"], "ç™¸å¯": ["è¾°", "å·³"],
                    "ç”²è¾°": ["å¯…", "å¯"], "ä¹™å·³": ["å¯…", "å¯"], "ä¸™åˆ": ["å¯…", "å¯"], "ä¸æœª": ["å¯…", "å¯"], "æˆŠç”³": ["å¯…", "å¯"],
                    "å·±é…‰": ["å¯…", "å¯"], "åºšæˆŒ": ["å¯…", "å¯"], "è¾›äº¥": ["å¯…", "å¯"], "å£¬å­": ["å¯…", "å¯"], "ç™¸ä¸‘": ["å¯…", "å¯"],
                    "ç”²å¯…": ["å­", "ä¸‘"], "ä¹™å¯": ["å­", "ä¸‘"], "ä¸™è¾°": ["å­", "ä¸‘"], "ä¸å·³": ["å­", "ä¸‘"], "æˆŠåˆ": ["å­", "ä¸‘"],
                    "å·±æœª": ["å­", "ä¸‘"], "åºšç”³": ["å­", "ä¸‘"], "è¾›é…‰": ["å­", "ä¸‘"], "å£¬æˆŒ": ["å­", "ä¸‘"], "ç™¸äº¥": ["å­", "ä¸‘"]
                }
            },
    
            ì‹­ì•…ëŒ€íŒ¨ì¼: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "ì‹­ì•…ëŒ€íŒ¨ - í° ì‹¤íŒ¨ ì£¼ì˜",
                rule: ["ç”²è¾°", "ä¹™å·³", "ä¸™ç”³", "ä¸äº¥", "æˆŠæˆŒ", "å·±ä¸‘", "åºšè¾°", "è¾›å·³", "å£¬ç”³", "ç™¸äº¥"]
            },
    
            íŒ”ì „ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "íŒ”ì „ - ì¹˜ìš°ì¹œ ì—ë„ˆì§€",
                rule: ["ç”²å¯…", "ä¹™å¯", "æˆŠåˆ", "å·±æœª", "åºšç”³", "è¾›é…‰", "å£¬å­", "ç™¸äº¥"]
            },
    
            êµ¬ì¶”ì¼: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "êµ¬ì¶” - ë³µì¡í•œ ì¸ì—°",
                rule: ["å£¬å­", "å£¬åˆ", "ç™¸å·³", "ç™¸äº¥", "ç”²å¯…", "ç”²åˆ", "ä¹™å¯", "ä¸é…‰", "è¾›å¯"]
            },
    
            ê°„ì—¬ì§€ë™: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "ì²œê°„ê³¼ ì§€ì§€ê°€ ê°™ì€ ì˜¤í–‰ - ê°•í•œ ê¸°ìš´",
                rule: ["ç”²å¯…", "ä¹™å¯", "ä¸™åˆ", "ä¸å·³", "æˆŠåˆ", "å·±å·³", "åºšç”³", "è¾›é…‰", "å£¬å­", "ç™¸äº¥"]
            },
    
            ìŒì–‘ì°¨ì°©: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "ìŒì–‘ ì–´ê¸‹ë‚¨ - ì¸ì—° ë³µì¡",
                rule: ["ä¸™å­", "ä¸ä¸‘", "æˆŠå¯…", "è¾›å¯", "å£¬è¾°", "ç™¸å·³", "ä¸™åˆ", "ä¸æœª", "æˆŠç”³", "è¾›é…‰", "å£¬æˆŒ", "ç™¸äº¥"]
            },
    
            ê³ ë€ì‚´: {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "ì™¸ë¡œìš´ ë‚œìƒˆ - ë°°ìš°ì ì¸ì—° ë³µì¡",
                rule: ["ä¹™å·³", "ä¸å·³", "è¾›äº¥", "æˆŠç”³", "å£¬å¯…", "æˆŠåˆ", "å£¬å­", "ä¸™åˆ"]
            },
    
            ì§„ì‹ : {
                type: "ê¸¸ì‹ ", basis: "ì¼ì£¼", description: "ì „ì§„ì˜ ê¸°ìš´ - ë°œì „, ì§„ë³´",
                rule: ["ç”²å­", "ç”²åˆ", "å·±å¯", "å·±é…‰"]
            },
    
            í‡´ì‹ : {
                type: "ì–‘ë©´ì‹ ", basis: "ì¼ì£¼", description: "í›„í‡´ì˜ ê¸°ìš´ - ì •ì²´, ì¬ì¶©ì „",
                rule: ["ä¸ä¸‘", "ä¸æœª", "å£¬è¾°", "å£¬æˆŒ"]
            },
    
            // ========================================
            // === ì—°ì• /ê²°í˜¼ ê´€ë ¨ ì‹ ì‚´ ===
            // ========================================
    
            í™ë€: {
                type: "ê¸¸ì‹ ", basis: "ë…„ì§€", description: "ë¶‰ì€ ë‚œìƒˆ - ì—°ì• ìš´, ê²°í˜¼ìš´",
                rule: {
                    "å­": ["å¯"], "ä¸‘": ["å¯…"], "å¯…": ["ä¸‘"], "å¯": ["å­"], "è¾°": ["äº¥"], "å·³": ["æˆŒ"],
                    "åˆ": ["é…‰"], "æœª": ["ç”³"], "ç”³": ["æœª"], "é…‰": ["åˆ"], "æˆŒ": ["å·³"], "äº¥": ["è¾°"]
                }
            },
    
            ì²œí¬: {
                type: "ê¸¸ì‹ ", basis: "ë…„ì§€", description: "í•˜ëŠ˜ì˜ ê¸°ì¨ - ê²½ì‚¬, ê¸°ìœ ì¼",
                rule: {
                    "å­": ["é…‰"], "ä¸‘": ["ç”³"], "å¯…": ["æœª"], "å¯": ["åˆ"], "è¾°": ["å·³"], "å·³": ["è¾°"],
                    "åˆ": ["å¯"], "æœª": ["å¯…"], "ç”³": ["ä¸‘"], "é…‰": ["å­"], "æˆŒ": ["äº¥"], "äº¥": ["æˆŒ"]
                }
            },
    
            // ========================================
            // === ê³„ì ˆ ì¡°í•© ì‹ ì‚´ ===
            // ========================================
    
            ì‚¬íŒ¨: {
                type: "ì–‘ë©´ì‹ ", basis: "ì›”ì§€+ì¼ì£¼", description: "ì‚¬íŒ¨ - ë¬´ë ¥í•¨, ê²°ê³¼ ì—†ìŒ",
                rule: {
                    "ë´„_å¯…å¯è¾°": ["åºšç”³", "è¾›é…‰"],
                    "ì—¬ë¦„_å·³åˆæœª": ["å£¬å­", "ç™¸äº¥"],
                    "ê°€ì„_ç”³é…‰æˆŒ": ["ç”²å¯…", "ä¹™å¯"],
                    "ê²¨ìš¸_äº¥å­ä¸‘": ["ä¸™åˆ", "ä¸å·³"]
                },
                matchType: "ê³„ì ˆ"
            },
    
            ì²œì‚¬ì¼: {
                type: "ê¸¸ì‹ ", basis: "ì›”ì§€+ì¼ì£¼", description: "í•˜ëŠ˜ì˜ ì‚¬ë©´ - í‰ì„ ê¸¸ë¡œ",
                rule: {
                    "ë´„_å¯…å¯è¾°": ["æˆŠå¯…"],
                    "ì—¬ë¦„_å·³åˆæœª": ["ç”²åˆ"],
                    "ê°€ì„_ç”³é…‰æˆŒ": ["æˆŠç”³"],
                    "ê²¨ìš¸_äº¥å­ä¸‘": ["ç”²å­"]
                },
                matchType: "ê³„ì ˆ"
            },
    
            // ========================================
            // === ì‚¼ê¸°ê·€ì¸ (ì²œê°„ ë°°ì—´) ===
            // ========================================
    
            ì‚¼ê¸°ê·€ì¸: {
                type: "ê¸¸ì‹ ", basis: "ì²œê°„ë°°ì—´", description: "ì„¸ ê°€ì§€ ê¸°ì´í•œ ê¸°ìš´ - íŠ¹ë³„í•œ ì¬ëŠ¥",
                rule: {
                    "ì²œìƒì‚¼ê¸°": ["ç”²", "æˆŠ", "åºš"],
                    "ì§€í•˜ì‚¼ê¸°": ["ä¹™", "ä¸™", "ä¸"],
                    "ì¸ì¤‘ì‚¼ê¸°": ["è¾›", "å£¬", "ç™¸"]
                },
                matchType: "ë°°ì—´"
            }
        };
        
        const YEAR_MONTH_START = { "ç”²": 2, "å·±": 2, "ä¹™": 4, "åºš": 4, "ä¸™": 6, "è¾›": 6, "ä¸": 8, "å£¬": 8, "æˆŠ": 0, "ç™¸": 0 };
        const DAY_HOUR_START = { "ç”²": 0, "å·±": 0, "ä¹™": 2, "åºš": 2, "ä¸™": 4, "è¾›": 4, "ä¸": 6, "å£¬": 6, "æˆŠ": 8, "ç™¸": 8 };
        
        // ì ˆê¸° ì •í™• í…Œì´ë¸” (1950-2030) - í•œêµ­ì²œë¬¸ì—°êµ¬ì›/NASA DE441 ê¸°ì¤€
        // 12ì ˆê¸°ë§Œ ì‚¬ìš© (ì›”ì£¼ ê³„ì‚°ìš©): ì…ì¶˜,ê²½ì¹©,ì²­ëª…,ì…í•˜,ë§ì¢…,ì†Œì„œ,ì…ì¶”,ë°±ë¡œ,í•œë¡œ,ì…ë™,ëŒ€ì„¤,ì†Œí•œ
        const JEOLGI_DATA = {
            // [ì…ì¶˜, ê²½ì¹©, ì²­ëª…, ì…í•˜, ë§ì¢…, ì†Œì„œ, ì…ì¶”, ë°±ë¡œ, í•œë¡œ, ì…ë™, ëŒ€ì„¤, ì†Œí•œ(ë‹¤ìŒí•´1ì›”)]
            1950: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1951: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,8],ì†Œí•œ:[1,6]},
            1952: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1953: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1954: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1955: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,8],ì†Œí•œ:[1,6]},
            1956: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1957: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1958: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1959: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,8],ì†Œí•œ:[1,6]},
            1960: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1961: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1962: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1963: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,8],ì†Œí•œ:[1,6]},
            1964: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1965: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1966: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1967: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,8],ì†Œí•œ:[1,6]},
            1968: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1969: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1970: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1971: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1972: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1973: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1974: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1975: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1976: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1977: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1978: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1979: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1980: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1981: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1982: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1983: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,8],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1984: {ì…ì¶˜:[2,5],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1985: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1986: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1987: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1988: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1989: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1990: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1991: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1992: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1993: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1994: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1995: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1996: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1997: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            1998: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            1999: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,9],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2000: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2001: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2002: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2003: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2004: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2005: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2006: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2007: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2008: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2009: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2010: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2011: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2012: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2013: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2014: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2015: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2016: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2017: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2018: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2019: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2020: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,6],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2021: {ì…ì¶˜:[2,3],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2022: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2023: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2024: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,6],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2025: {ì…ì¶˜:[2,3],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2026: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2027: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,6],ì²­ëª…:[4,5],ì…í•˜:[5,6],ë§ì¢…:[6,6],ì†Œì„œ:[7,7],ì…ì¶”:[8,8],ë°±ë¡œ:[9,8],í•œë¡œ:[10,8],ì…ë™:[11,8],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,6]},
            2028: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,6],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2029: {ì…ì¶˜:[2,3],ê²½ì¹©:[3,5],ì²­ëª…:[4,4],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]},
            2030: {ì…ì¶˜:[2,4],ê²½ì¹©:[3,5],ì²­ëª…:[4,5],ì…í•˜:[5,5],ë§ì¢…:[6,5],ì†Œì„œ:[7,7],ì…ì¶”:[8,7],ë°±ë¡œ:[9,7],í•œë¡œ:[10,8],ì…ë™:[11,7],ëŒ€ì„¤:[12,7],ì†Œí•œ:[1,5]}
        };
        
        const JEOLGI_MONTH = { "ì…ì¶˜": 1, "ê²½ì¹©": 2, "ì²­ëª…": 3, "ì…í•˜": 4, "ë§ì¢…": 5, "ì†Œì„œ": 6, "ì…ì¶”": 7, "ë°±ë¡œ": 8, "í•œë¡œ": 9, "ì…ë™": 10, "ëŒ€ì„¤": 11, "ì†Œí•œ": 12 };
        
        // ============================================
        // ê³„ì‚° í•¨ìˆ˜
        // ============================================
        
        function getJeolgiMonth(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const data = JEOLGI_DATA[year] || JEOLGI_DATA[2000];
            
            const jeolgiOrder = ["ì†Œí•œ", "ì…ì¶˜", "ê²½ì¹©", "ì²­ëª…", "ì…í•˜", "ë§ì¢…", "ì†Œì„œ", "ì…ì¶”", "ë°±ë¡œ", "í•œë¡œ", "ì…ë™", "ëŒ€ì„¤"];
            let currentJeolgi = "ì†Œí•œ";
            
            for (const jeolgi of jeolgiOrder) {
                const jData = data[jeolgi];
                if (!jData) continue;
                if (month > jData[0] || (month === jData[0] && day >= jData[1])) {
                    currentJeolgi = jeolgi;
                }
            }
            
            return JEOLGI_MONTH[currentJeolgi] || 1;
        }
        
        // ìŒë ¥ â†’ ì–‘ë ¥ ë³€í™˜ í•¨ìˆ˜
        const LUNAR_DATA = [
            0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2, // 1900-1909
            0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977, // 1910-1919
            0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970, // 1920-1929
            0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950, // 1930-1939
            0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557, // 1940-1949
            0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5b0, 0x14573, 0x052b0, 0x0a9a8, 0x0e950, 0x06aa0, // 1950-1959
            0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0, // 1960-1969
            0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b6a0, 0x195a6, // 1970-1979
            0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570, // 1980-1989
            0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0, // 1990-1999
            0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5, // 2000-2009
            0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930, // 2010-2019
            0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530, // 2020-2029
            0x05aa0, 0x076a3, 0x096d0, 0x04afb, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, // 2030-2039
            0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0, // 2040-2049
            0x14b63, 0x09370, 0x049f8, 0x04970, 0x064b0, 0x168a6, 0x0ea50, 0x06b20, 0x1a6c4, 0x0aae0, // 2050-2059
            0x0a2e0, 0x0d2e3, 0x0c960, 0x0d557, 0x0d4a0, 0x0da50, 0x05d55, 0x056a0, 0x0a6d0, 0x055d4, // 2060-2069
            0x052d0, 0x0a9b8, 0x0a950, 0x0b4a0, 0x0b6a6, 0x0ad50, 0x055a0, 0x0aba4, 0x0a5b0, 0x052b0, // 2070-2079
            0x0b273, 0x06930, 0x07337, 0x06aa0, 0x0ad50, 0x14b55, 0x04b60, 0x0a570, 0x054e4, 0x0d160, // 2080-2089
            0x0e968, 0x0d520, 0x0daa0, 0x16aa6, 0x056d0, 0x04ae0, 0x0a9d4, 0x0a2d0, 0x0d150, 0x0f252, // 2090-2099
            0x0d520 // 2100
        ];
        
        function getLunarMonthDays(year, month) {
            const data = LUNAR_DATA[year - 1900];
            return (data & (0x10000 >> month)) ? 30 : 29;
        }
        
        function getLunarLeapMonth(year) {
            const data = LUNAR_DATA[year - 1900];
            return data & 0xf;
        }
        
        function getLunarLeapDays(year) {
            if (getLunarLeapMonth(year)) {
                return (LUNAR_DATA[year - 1900] & 0x10000) ? 30 : 29;
            }
            return 0;
        }
        
        function getLunarYearDays(year) {
            let sum = 348;
            for (let i = 0x8000; i > 0x8; i >>= 1) {
                sum += (LUNAR_DATA[year - 1900] & i) ? 1 : 0;
            }
            return sum + getLunarLeapDays(year);
        }
        
        function lunarToSolar(lunarYear, lunarMonth, lunarDay, isLeapMonth = false) {
            if (lunarYear < 1900 || lunarYear > 2100) {
                return null;
            }
            
            let offset = 0;
            
            // 1900ë…„ 1ì›” 31ì¼ì´ ìŒë ¥ 1900ë…„ 1ì›” 1ì¼
            for (let y = 1900; y < lunarYear; y++) {
                offset += getLunarYearDays(y);
            }
            
            const leapMonth = getLunarLeapMonth(lunarYear);
            let isAfterLeap = false;
            
            for (let m = 1; m < lunarMonth; m++) {
                if (leapMonth > 0 && m === leapMonth + 1) {
                    isAfterLeap = true;
                }
                offset += getLunarMonthDays(lunarYear, m);
                if (m === leapMonth) {
                    offset += getLunarLeapDays(lunarYear);
                }
            }
            
            if (isLeapMonth && lunarMonth === leapMonth) {
                offset += getLunarMonthDays(lunarYear, lunarMonth);
            }
            
            offset += lunarDay - 1;
            
            // ê¸°ì¤€ì¼: 1900ë…„ 1ì›” 31ì¼
            const baseDate = new Date(1900, 0, 31);
            const resultDate = new Date(baseDate.getTime() + offset * 24 * 60 * 60 * 1000);
            
            return {
                year: resultDate.getFullYear(),
                month: resultDate.getMonth() + 1,
                day: resultDate.getDate()
            };
        }

        // ========== ì§„íƒœì–‘ì‹œ(True Solar Time) ë³€í™˜ í•¨ìˆ˜ë“¤ ==========

        // ì—°ì¤‘ ì¼ìˆ˜ ê³„ì‚°
        function getDayOfYear(date) {
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        // ê· ì‹œì°¨ ê³„ì‚° (ê·¼ì‚¬ ê³µì‹, ì˜¤ì°¨ Â±2ë¶„)
        function getEquationOfTime(dayOfYear) {
            // B = (360/365) Ã— (n - 81) (ë¼ë””ì•ˆ ë³€í™˜)
            const B = (360 / 365) * (dayOfYear - 81) * (Math.PI / 180);
            // E = 9.87Â·sin(2B) - 7.53Â·cos(B) - 1.5Â·sin(B)
            const E = 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B);
            return E; // ë¶„ ë‹¨ìœ„
        }

        // ì§€ì—­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getLocationInfo(country, city, customLng, customUtcOffset) {
            console.log('ğŸŒ [getLocationInfo] ì…ë ¥ - country:', country, ', city:', city, ', customLng:', customLng);
            // customLngê°€ ìˆì§€ë§Œ cityë„ ìˆìœ¼ë©´ ë„ì‹œëª… ìœ ì§€ (ì…ë ¥í¼ì—ì„œ ìë™ ì €ì¥ëœ ê²½ìš°)
            if (customLng !== null && city && city !== 'ì„œìš¸') {
                // í•œêµ­ ë„ì‹œì—ì„œ ë§¤ì¹­ ì‹œë„
                const krCities = GLOBAL_CITIES['KR']?.cities || {};
                let matchedCityName = city;
                let matchedLng = customLng;

                // ë¶€ë¶„ ë§¤ì¹­ìœ¼ë¡œ ë„ì‹œëª… ì •ê·œí™” (ëŒ€ì „ê´‘ì—­ì‹œ â†’ ëŒ€ì „)
                for (const krCity of Object.keys(krCities)) {
                    if (city.includes(krCity) || krCity.includes(city)) {
                        matchedCityName = krCity;
                        break;
                    }
                }

                return {
                    country: country || 'KR',
                    countryName: GLOBAL_CITIES[country]?.name || 'í•œêµ­',
                    city: matchedCityName,
                    lng: customLng,
                    utcOffset: customUtcOffset !== null ? customUtcOffset : 9,
                    flag: GLOBAL_CITIES[country]?.flag || 'ğŸ‡°ğŸ‡·'
                };
            }

            // ì§ì ‘ ì…ë ¥ì¸ ê²½ìš° (city ì—†ì´ customLngë§Œ ìˆëŠ” ê²½ìš°)
            if (country === 'CUSTOM' || (customLng !== null && (!city || city === 'ì„œìš¸'))) {
                return {
                    country: 'CUSTOM',
                    countryName: 'ì§ì ‘ì…ë ¥',
                    city: 'ì‚¬ìš©ìì§€ì •',
                    lng: customLng || 127.0,
                    utcOffset: customUtcOffset !== null ? customUtcOffset : 9,
                    flag: 'ğŸŒ'
                };
            }

            // ê¸°ë³¸ê°’: í•œêµ­ ì„œìš¸
            if (!country) country = 'KR';
            if (!city) city = 'ì„œìš¸';

            let countryData = GLOBAL_CITIES[country];

            // êµ­ê°€ ì½”ë“œë¥¼ ëª» ì°¾ìœ¼ë©´ (XX ë“±) í•œêµ­ ë„ì‹œì—ì„œ ì°¾ì•„ë³´ê¸°
            if (!countryData) {
                // ë„ì‹œëª…ìœ¼ë¡œ í•œêµ­ ë„ì‹œì¸ì§€ í™•ì¸
                const krCities = GLOBAL_CITIES['KR'].cities;
                for (const krCity of Object.keys(krCities)) {
                    if (city && (city.includes(krCity) || krCity.includes(city))) {
                        countryData = GLOBAL_CITIES['KR'];
                        break;
                    }
                }
            }

            // ê·¸ë˜ë„ ëª» ì°¾ìœ¼ë©´ ê¸°ë³¸ê°’
            if (!countryData) {
                return {
                    country: 'KR',
                    countryName: 'í•œêµ­',
                    city: 'ì„œìš¸',
                    lng: 127.0,
                    utcOffset: 9,
                    flag: 'ğŸ‡°ğŸ‡·'
                };
            }

            let cityData = countryData.cities[city];
            let matchedCity = city;
            console.log('ğŸŒ [getLocationInfo] ì§ì ‘ ë§¤ì¹­ ì‹œë„ - cityData:', cityData ? 'ìˆìŒ' : 'ì—†ìŒ');

            // ì •í™•íˆ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ë¶€ë¶„ ë§¤ì¹­ ì‹œë„
            if (!cityData) {
                // "ëŒ€ì „ê´‘ì—­ì‹œ" â†’ "ëŒ€ì „" ë§¤ì¹­ ì‹œë„
                const cityKeys = Object.keys(countryData.cities);
                console.log('ğŸŒ [getLocationInfo] ë¶€ë¶„ ë§¤ì¹­ ì‹œë„ - ë„ì‹œ ëª©ë¡:', cityKeys.slice(0, 10));
                for (const key of cityKeys) {
                    if (city.includes(key) || key.includes(city)) {
                        cityData = countryData.cities[key];
                        matchedCity = key;
                        console.log('ğŸŒ [getLocationInfo] ë¶€ë¶„ ë§¤ì¹­ ì„±ê³µ! -', city, 'â†’', key);
                        break;
                    }
                }
            }

            if (!cityData) {
                // ê·¸ë˜ë„ ëª» ì°¾ìœ¼ë©´ í•´ë‹¹ êµ­ê°€ì˜ ì²« ë²ˆì§¸ ë„ì‹œ ì‚¬ìš©
                const firstCity = Object.keys(countryData.cities)[0];
                const firstCityData = countryData.cities[firstCity];
                console.log('ğŸŒ [getLocationInfo] ë§¤ì¹­ ì‹¤íŒ¨! ê¸°ë³¸ ë„ì‹œ:', firstCity);
                return {
                    country: country,
                    countryName: countryData.name,
                    city: firstCity,
                    lng: firstCityData.lng,
                    utcOffset: firstCityData.utcOffset !== undefined ? firstCityData.utcOffset : countryData.utcOffset,
                    flag: countryData.flag
                };
            }

            console.log('ğŸŒ [getLocationInfo] ìµœì¢… ê²°ê³¼ - city:', matchedCity, ', lng:', cityData.lng);
            return {
                country: country,
                countryName: countryData.name,
                city: matchedCity,
                lng: cityData.lng,
                utcOffset: cityData.utcOffset !== undefined ? cityData.utcOffset : countryData.utcOffset,
                flag: countryData.flag
            };
        }

        // ì‹œê²½ê³„ ê²€ì‚¬ í•¨ìˆ˜
        function checkTimeBoundary(hour, minute) {
            const siStart = [23, 1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21];
            const siNames = ['ì', 'ì¶•', 'ì¸', 'ë¬˜', 'ì§„', 'ì‚¬', 'ì˜¤', 'ë¯¸', 'ì‹ ', 'ìœ ', 'ìˆ ', 'í•´'];

            for (let i = 0; i < siStart.length; i++) {
                const start = siStart[i];
                const end = siStart[(i + 1) % 12];

                // ìì‹œ íŠ¹ë³„ ì²˜ë¦¬ (23~01)
                if (i === 0) {
                    if ((hour === 23 && minute >= 30) || (hour === 0 && minute <= 30)) {
                        return { isNearBoundary: true, prevSi: 'í•´ì‹œ', nextSi: 'ìì‹œ', boundaryTime: '23:00' };
                    }
                    if (hour === 0 && minute >= 30 && minute <= 90) continue;
                }

                // ì¼ë°˜ ì‹œ ê²½ê³„
                if (hour === start && minute <= 30) {
                    const prevIdx = (i - 1 + 12) % 12;
                    return {
                        isNearBoundary: true,
                        prevSi: siNames[prevIdx] + 'ì‹œ',
                        nextSi: siNames[i] + 'ì‹œ',
                        boundaryTime: `${String(start).padStart(2, '0')}:00`
                    };
                }
            }
            return { isNearBoundary: false };
        }

        // ì§„íƒœì–‘ì‹œ ë³€í™˜ ë©”ì¸ í•¨ìˆ˜
        function convertToTrueSolarTime(date, hour, minute, locationInfo) {
            if (hour === null) {
                return {
                    applied: false,
                    correctedHour: null,
                    correctedMinute: null
                };
            }

            const lng = locationInfo.lng;
            const utcOffset = locationInfo.utcOffset;

            // 1. í‘œì¤€ê²½ë„ ê³„ì‚° (UTC offset Ã— 15)
            const standardLng = utcOffset * 15;

            // 2. ê²½ë„ ë³´ì •: (ì¶œìƒì§€ ê²½ë„ - í‘œì¤€ê²½ë„) Ã— 4ë¶„
            const lngCorrection = (lng - standardLng) * 4;

            // 3. ê· ì‹œì°¨ (Equation of Time)
            const dayOfYear = getDayOfYear(date);
            const eot = getEquationOfTime(dayOfYear);

            // 4. ì´ ë³´ì • ì‹œê°„ (ë¶„)
            const totalCorrection = lngCorrection + eot;

            // 5. ë³´ì •ëœ ì‹œê°„ ê³„ì‚°
            let totalMinutes = hour * 60 + minute + totalCorrection;

            // ë‚ ì§œ ë„˜ê¹€ ì²˜ë¦¬
            let dayOffset = 0;
            if (totalMinutes < 0) {
                dayOffset = -1;
                totalMinutes += 24 * 60;
            } else if (totalMinutes >= 24 * 60) {
                dayOffset = 1;
                totalMinutes -= 24 * 60;
            }

            const correctedHour = Math.floor(totalMinutes / 60);
            const correctedMinute = Math.round(totalMinutes % 60);

            return {
                applied: true,
                originalHour: hour,
                originalMinute: minute,
                correctedHour: correctedHour,
                correctedMinute: correctedMinute,
                lngCorrection: lngCorrection,
                eot: eot,
                totalCorrection: totalCorrection,
                dayOffset: dayOffset
            };
        }

        function calculateYearPillar(date) {
            let year = date.getFullYear();
            const data = JEOLGI_DATA[year] || JEOLGI_DATA[2000];
            const ipchun = new Date(year, data.ì…ì¶˜[0] - 1, data.ì…ì¶˜[1]);
            if (date < ipchun) year -= 1;
            
            const baseYear = 1984;
            const diff = year - baseYear;
            const ganIndex = ((diff % 10) + 10) % 10;
            const jiIndex = ((diff % 12) + 12) % 12;
            
            return { gan: CHEONGAN[ganIndex], ji: JIJI[jiIndex], ganKr: CHEONGAN_KR[ganIndex], jiKr: JIJI_KR[jiIndex] };
        }
        
        function calculateMonthPillar(date, yearGan) {
            const month = getJeolgiMonth(date);
            const jiIndex = (month + 1) % 12;
            const ganStart = YEAR_MONTH_START[yearGan];
            const ganIndex = (ganStart + month - 1) % 10;
            
            return { gan: CHEONGAN[ganIndex], ji: JIJI[jiIndex], ganKr: CHEONGAN_KR[ganIndex], jiKr: JIJI_KR[jiIndex] };
        }
        
        function calculateDayPillar(date, hour = null, jasiType = 'unified') {
            // ê¸°ì¤€: 1900ë…„ 1ì›” 1ì¼ = ç”²æˆŒ (ê°‘ìˆ )
            // ì¶œì²˜: í•œêµ­ë¯¼ì¡±ë¬¸í™”ëŒ€ë°±ê³¼ì‚¬ì „ - "1901ë…„ 1ì›” 1ì¼ì˜ ì¼ì§„ì´ ê¸°ë¬˜" ì—­ì‚°
            let calcDate = new Date(date);
            
            // ë¶„ë¦¬ ìì‹œ: 23ì‹œ ì´í›„ë©´ ë‹¤ìŒë‚ ë¡œ ê³„ì‚°
            if (jasiType === 'split' && hour !== null && hour >= 23) {
                calcDate.setDate(calcDate.getDate() + 1);
            }
            
            const baseDate = new Date(1900, 0, 1);
            const diff = Math.floor((calcDate - baseDate) / (1000 * 60 * 60 * 24));
            const ganIndex = ((0 + diff) % 10 + 10) % 10;  // ç”² = 0
            const jiIndex = ((10 + diff) % 12 + 12) % 12;  // æˆŒ = 10 (ìˆ˜ì •ë¨!)
            
            return { gan: CHEONGAN[ganIndex], ji: JIJI[jiIndex], ganKr: CHEONGAN_KR[ganIndex], jiKr: JIJI_KR[jiIndex] };
        }
        
        function calculateHourPillar(hour, dayGan) {
            let jiIndex;
            if (hour >= 23 || hour < 1) jiIndex = 0;
            else if (hour < 3) jiIndex = 1;
            else if (hour < 5) jiIndex = 2;
            else if (hour < 7) jiIndex = 3;
            else if (hour < 9) jiIndex = 4;
            else if (hour < 11) jiIndex = 5;
            else if (hour < 13) jiIndex = 6;
            else if (hour < 15) jiIndex = 7;
            else if (hour < 17) jiIndex = 8;
            else if (hour < 19) jiIndex = 9;
            else if (hour < 21) jiIndex = 10;
            else jiIndex = 11;
            
            const ganStart = DAY_HOUR_START[dayGan];
            const ganIndex = (ganStart + jiIndex) % 10;
            
            return { gan: CHEONGAN[ganIndex], ji: JIJI[jiIndex], ganKr: CHEONGAN_KR[ganIndex], jiKr: JIJI_KR[jiIndex] };
        }
        
        function calculateOhaeng(pillars) {
            const count = { ëª©: 0, í™”: 0, í† : 0, ê¸ˆ: 0, ìˆ˜: 0 };
            for (const p of pillars) {
                if (!p) continue;
                // ì²œê°„: 1ì 
                count[CHEONGAN_OHAENG[p.gan]] += 1;
                // ì§€ì§€: 0.5ì 
                count[JIJI_OHAENG[p.ji]] += 0.5;
                // ì§€ì¥ê°„: ê° 0.25ì 
                const jjgList = JIJANGGAN[p.ji] || [];
                for (let i = 0; i < jjgList.length; i++) {
                    count[CHEONGAN_OHAENG[jjgList[i]]] += 0.25;
                }
            }
            // ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬ê¹Œì§€ ë°˜ì˜¬ë¦¼
            for (const k in count) count[k] = Math.round(count[k] * 100) / 100;
            return count;
        }
        
        // 5ì  ë§Œì  ì •ê·œí™” í•¨ìˆ˜
        function normalizeOhaengTo5(ohaengCount) {
            const total = Object.values(ohaengCount).reduce((a, b) => a + b, 0);
            if (total === 0) return { ëª©: 0, í™”: 0, í† : 0, ê¸ˆ: 0, ìˆ˜: 0 };
            
            const normalized = {};
            for (const k in ohaengCount) {
                normalized[k] = Math.round((ohaengCount[k] / total) * 5 * 100) / 100;
            }
            return normalized;
        }
        
        // ì§€ì¥ê°„ ìƒì„¸ ë¶„ì„ (ìˆ¨ê²¨ì§„ ë‚´ë©´)
        function analyzeJijanggan(dayGan, pillars) {
            const result = [];
            const labels = ['ë…„ì§€', 'ì›”ì§€', 'ì¼ì§€', 'ì‹œì§€'];
            
            for (let i = 0; i < pillars.length; i++) {
                const p = pillars[i];
                if (!p) continue;
                
                const jjgList = JIJANGGAN[p.ji] || [];
                const jjgAnalysis = jjgList.map(jjg => {
                    const sipsung = SIPSUNG_MATRIX[dayGan][jjg];
                    const ohaeng = CHEONGAN_OHAENG[jjg];
                    const ganKr = CHEONGAN_KR[CHEONGAN.indexOf(jjg)];
                    return { gan: jjg, ganKr, sipsung, ohaeng };
                });
                
                result.push({
                    position: labels[i],
                    ji: p.ji,
                    jiKr: p.jiKr,
                    jijanggan: jjgAnalysis
                });
            }
            return result;
        }
        
        function calculateSipsung(dayGan, pillars) {
            const count = { ë¹„ê²: 0, ì‹ìƒ: 0, ì¬ì„±: 0, ê´€ì„±: 0, ì¸ì„±: 0 };

            for (let idx = 0; idx < pillars.length; idx++) {
                const p = pillars[idx];
                if (!p) continue;

                // ì²œê°„ ì‹­ì„± (ì¼ì£¼ ì²œê°„=ì¼ê°„ ë³¸ì¸ë§Œ ì œì™¸, ì—°ê°„/ì›”ê°„/ì‹œê°„ì€ ëª¨ë‘ ì¹´ìš´íŠ¸)
                // pillars ìˆœì„œ: [ì—°, ì›”, ì¼, ì‹œ] â†’ index 2ê°€ ì¼ì£¼
                if (idx !== 2) {
                    const sipsung = SIPSUNG_MATRIX[dayGan][p.gan];
                    if (sipsung && SIPSUNG_GROUP[sipsung]) {
                        count[SIPSUNG_GROUP[sipsung]] += 1;
                    }
                }

                // ì§€ì¥ê°„: ë¹„ìœ¨ ë°˜ì˜
                const jjgList = JIJANGGAN[p.ji] || [];
                const ratioList = JIJANGGAN_RATIO[p.ji] || [];
                for (let i = 0; i < jjgList.length; i++) {
                    const sipsung = SIPSUNG_MATRIX[dayGan][jjgList[i]];
                    const ratio = ratioList[i] || 10;
                    if (sipsung && SIPSUNG_GROUP[sipsung]) {
                        count[SIPSUNG_GROUP[sipsung]] += ratio / 30; // 30ì¼=1ì 
                    }
                }
            }

            for (const k in count) count[k] = parseFloat(count[k].toFixed(2));
            return count;
        }
        
        // ê²©êµ­ ê³„ì‚° (ì›”ì§€ ì •ê¸° ê¸°ì¤€)
        function calculateGyeokguk(dayGan, monthJi) {
            // ì›”ì§€ì˜ ì •ê¸°(ë³¸ê¸°) = ì§€ì¥ê°„ì˜ ë§ˆì§€ë§‰ ê²ƒ
            const jjgList = JIJANGGAN[monthJi] || [];
            const mainJjg = jjgList[jjgList.length - 1]; // ì •ê¸°
            
            if (!mainJjg) return { name: 'ë¯¸ì •', description: 'ê²©êµ­ì„ íŒë‹¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' };
            
            // ì •ê¸°ì˜ ì‹­ì„±ìœ¼ë¡œ ê²©êµ­ ê²°ì •
            const sipsung = SIPSUNG_MATRIX[dayGan][mainJjg];
            
            const gyeokgukInfo = {
                'ë¹„ê²¬': { name: 'ë¹„ê²¬ê²©(æ¯”è‚©æ ¼)', description: 'ë…ë¦½ì‹¬ê³¼ ìì¡´ì‹¬ì´ ê°•í•˜ë©°, ìŠ¤ìŠ¤ë¡œì˜ í˜ìœ¼ë¡œ ì„±ì·¨í•˜ë ¤ëŠ” ì„±í–¥' },
                'ê²ì¬': { name: 'ê²ì¬ê²©(åŠ«è²¡æ ¼)', description: 'ê²½ìŸì‹¬ê³¼ ì¶”ì§„ë ¥ì´ ê°•í•˜ë©°, ë„ì „ì ì´ê³  ìŠ¹ë¶€ìš•ì´ ê°•í•œ ì„±í–¥' },
                'ì‹ì‹ ': { name: 'ì‹ì‹ ê²©(é£Ÿç¥æ ¼)', description: 'ì°½ì˜ë ¥ê³¼ í‘œí˜„ë ¥ì´ ë›°ì–´ë‚˜ë©°, ì—¬ìœ ë¡­ê³  ë‚™ì²œì ì¸ ì„±í–¥' },
                'ìƒê´€': { name: 'ìƒê´€ê²©(å‚·å®˜æ ¼)', description: 'ì¬ëŠ¥ê³¼ ë¼ê°€ ë„˜ì¹˜ë©°, ê¸°ì¡´ í‹€ì„ ê¹¨ëŠ” í˜ì‹ ì  ì„±í–¥' },
                'í¸ì¬': { name: 'í¸ì¬ê²©(åè²¡æ ¼)', description: 'ì‚¬ì—… ìˆ˜ì™„ê³¼ ì‚¬êµì„±ì´ ë›°ì–´ë‚˜ë©°, í° ì¬ë¬¼ì„ ë‹¤ë£¨ëŠ” ì„±í–¥' },
                'ì •ì¬': { name: 'ì •ì¬ê²©(æ­£è²¡æ ¼)', description: 'ì„±ì‹¤í•˜ê³  ê¾¸ì¤€í•˜ë©°, ì•ˆì •ì  ì¬ë¬¼ì„ ì¶•ì í•˜ëŠ” ì„±í–¥' },
                'í¸ê´€': { name: 'í¸ê´€ê²©(åå®˜æ ¼)', description: 'ê¶Œìœ„ì™€ ì‹¤í–‰ë ¥ì´ ê°•í•˜ë©°, ê°•í•œ ì¹´ë¦¬ìŠ¤ë§ˆë¥¼ ê°€ì§„ ì„±í–¥' },
                'ì •ê´€': { name: 'ì •ê´€ê²©(æ­£å®˜æ ¼)', description: 'ëª…ì˜ˆì™€ ì±…ì„ê°ì´ ê°•í•˜ë©°, ì¡°ì§ ë‚´ ë¦¬ë”ì‹­ì„ ë°œíœ˜í•˜ëŠ” ì„±í–¥' },
                'í¸ì¸': { name: 'í¸ì¸ê²©(åå°æ ¼)', description: 'ì§ê´€ë ¥ê³¼ í†µì°°ë ¥ì´ ë›°ì–´ë‚˜ë©°, íŠ¹ìˆ˜ ë¶„ì•¼ì— ì¬ëŠ¥ì„ ë³´ì´ëŠ” ì„±í–¥' },
                'ì •ì¸': { name: 'ì •ì¸ê²©(æ­£å°æ ¼)', description: 'í•™ë¬¸ê³¼ ì§€í˜œë¥¼ ì¶”êµ¬í•˜ë©°, ë°°ì›€ê³¼ ê°€ë¥´ì¹¨ì— ë›°ì–´ë‚œ ì„±í–¥' }
            };
            
            return gyeokgukInfo[sipsung] || { name: 'í˜¼í•©ê²©', description: 'ì—¬ëŸ¬ ê¸°ìš´ì´ ì„ì¸ ë³µí•©ì  ì„±í–¥' };
        }
        
        // ìš©ì‹ /í¬ì‹ /ê¸°ì‹ /êµ¬ì‹  ê³„ì‚° (ì‹ ê°•/ì‹ ì•½ ê¸°ë°˜ ì •í†µ ë°©ì‹)
        function calculateYongsin(dayGan, ohaeng, sipsung) {
            const dayOhaeng = CHEONGAN_OHAENG[dayGan];

            // ì˜¤í–‰ ìƒìƒìƒê·¹ ê´€ê³„
            const saengMe = { 'ëª©': 'ìˆ˜', 'í™”': 'ëª©', 'í† ': 'í™”', 'ê¸ˆ': 'í† ', 'ìˆ˜': 'ê¸ˆ' }; // ë‚˜ë¥¼ ìƒí•˜ëŠ” ê²ƒ (ì¸ì„±)
            const iSaeng = { 'ëª©': 'í™”', 'í™”': 'í† ', 'í† ': 'ê¸ˆ', 'ê¸ˆ': 'ìˆ˜', 'ìˆ˜': 'ëª©' }; // ë‚´ê°€ ìƒí•˜ëŠ” ê²ƒ (ì‹ìƒ)
            const geukMe = { 'ëª©': 'ê¸ˆ', 'í™”': 'ìˆ˜', 'í† ': 'ëª©', 'ê¸ˆ': 'í™”', 'ìˆ˜': 'í† ' }; // ë‚˜ë¥¼ ê·¹í•˜ëŠ” ê²ƒ (ê´€ì„±)
            const iGeuk = { 'ëª©': 'í† ', 'í™”': 'ê¸ˆ', 'í† ': 'ìˆ˜', 'ê¸ˆ': 'ëª©', 'ìˆ˜': 'í™”' }; // ë‚´ê°€ ê·¹í•˜ëŠ” ê²ƒ (ì¬ì„±)

            // ì¼ê°„ ê°•ì•½ íŒë‹¨: ì¼ê°„ ì˜¤í–‰ + ë‚˜ë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰ vs ë‚˜ë¨¸ì§€
            const myOhaeng = dayOhaeng;
            const helpOhaeng = saengMe[dayOhaeng]; // ì¸ì„± ì˜¤í–‰

            const strongForce = ohaeng[myOhaeng] + ohaeng[helpOhaeng]; // ë¹„ê² + ì¸ì„±
            const totalForce = Object.values(ohaeng).reduce((a, b) => a + b, 0);

            // ì‹ ê°•/ì‹ ì•½ íŒë‹¨ (40% ì´ìƒì´ë©´ ì‹ ê°•)
            const isStrong = strongForce >= totalForce * 0.4;

            // ìƒìƒìƒê·¹ ê´€ê³„ (4ì‹  ê³„ì‚°ìš©)
            const whoSaeng = { 'ëª©': 'ìˆ˜', 'í™”': 'ëª©', 'í† ': 'í™”', 'ê¸ˆ': 'í† ', 'ìˆ˜': 'ê¸ˆ' }; // Xë¥¼ ìƒí•˜ëŠ” ì˜¤í–‰
            const whoGeuk = { 'ëª©': 'ê¸ˆ', 'í™”': 'ìˆ˜', 'í† ': 'ëª©', 'ê¸ˆ': 'í™”', 'ìˆ˜': 'í† ' }; // Xë¥¼ ê·¹í•˜ëŠ” ì˜¤í–‰

            let yongsin, huisin, gisin, gusin;

            if (isStrong) {
                // ì‹ ê°• ì‚¬ì£¼: ì¼ê°„ ê¸°ìš´ì„ ë¹¼ì¤˜ì•¼ í•¨
                // ìš©ì‹ : ì‹ìƒ(ë‚´ê°€ ìƒí•˜ëŠ” ê²ƒ) ë˜ëŠ” ì¬ì„±(ë‚´ê°€ ê·¹í•˜ëŠ” ê²ƒ) ë˜ëŠ” ê´€ì„±(ë‚˜ë¥¼ ê·¹í•˜ëŠ” ê²ƒ)
                // ê°€ì¥ ë¶€ì¡±í•œ ê²ƒ ì¤‘ì—ì„œ ì„ íƒ
                const candidates = [iSaeng[dayOhaeng], iGeuk[dayOhaeng], geukMe[dayOhaeng]]; // ì‹ìƒ, ì¬ì„±, ê´€ì„±
                const sorted = candidates.map(o => ({ name: o, value: ohaeng[o] }))
                                         .sort((a, b) => a.value - b.value);
                yongsin = sorted[0].name; // ê°€ì¥ ë¶€ì¡±í•œ ê²ƒì´ ìš©ì‹ 
            } else {
                // ì‹ ì•½ ì‚¬ì£¼: ì¼ê°„ ê¸°ìš´ì„ ë³´ì¶©í•´ì•¼ í•¨
                // ìš©ì‹ : ì¸ì„±(ë‚˜ë¥¼ ìƒí•˜ëŠ” ê²ƒ) ë˜ëŠ” ë¹„ê²(ë‚˜ì™€ ê°™ì€ ê²ƒ)
                const candidates = [saengMe[dayOhaeng], dayOhaeng]; // ì¸ì„±, ë¹„ê²
                const sorted = candidates.map(o => ({ name: o, value: ohaeng[o] }))
                                         .sort((a, b) => a.value - b.value);
                yongsin = sorted[0].name; // ê°€ì¥ ë¶€ì¡±í•œ ê²ƒì´ ìš©ì‹ 
            }

            // í¬ì‹ : ìš©ì‹ ì„ ìƒí•˜ëŠ” ì˜¤í–‰ (ìš©ì‹ ì„ ë„ì›€)
            huisin = whoSaeng[yongsin];
            // ê¸°ì‹ : ìš©ì‹ ì„ ê·¹í•˜ëŠ” ì˜¤í–‰ (ìš©ì‹ ì„ ë°©í•´)
            gisin = whoGeuk[yongsin];
            // êµ¬ì‹ : ê¸°ì‹ ì„ ìƒí•˜ëŠ” ì˜¤í–‰ (ê¸°ì‹ ì„ ë„ì›€)
            gusin = whoSaeng[gisin];
            
            // ì„¤ëª… ìƒì„±
            const ohaengDesc = {
                'ëª©': { yong: 'ì„±ì¥, ì‹œì‘, ìƒˆë¡œìš´ ë„ì „', hui: 'ì°½ì˜ë ¥ê³¼ í™•ì¥ì˜ ê¸°ìš´', gi: 'ê³¼í•œ ìš•ì‹¬, ë¬´ë¦¬í•œ í™•ì¥', gu: 'ë°©í–¥ ì—†ëŠ” ë¶„ì‚°' },
                'í™”': { yong: 'ì—´ì •, í‘œí˜„, ë”°ëœ»í•œ ê´€ê³„', hui: 'í™œë ¥ê³¼ ìì‹ ê° ìƒìŠ¹', gi: 'ê¸‰í•œ ì„±ê²©, ì¶©ë™ì  í–‰ë™', gu: 'ê°ì • ê³¼ì‰, ë²ˆì•„ì›ƒ' },
                'í† ': { yong: 'ì•ˆì •, ì‹ ë¢°, ì¤‘ì‹¬ ì¡ê¸°', hui: 'í˜„ì‹¤ ê°ê°ê³¼ ì‹¤í–‰ë ¥', gi: 'ê³ ì§‘, ìœµí†µì„± ë¶€ì¡±', gu: 'ë¬´ê±°ì›€, ì •ì²´' },
                'ê¸ˆ': { yong: 'ê²°ë‹¨ë ¥, ì •ë¦¬, ë§ˆë¬´ë¦¬', hui: 'ì§‘ì¤‘ë ¥ê³¼ ì™„ì„±ë„', gi: 'ëƒ‰ì •í•¨, ì˜ˆë¯¼í•¨ ê³¼ë‹¤', gu: 'ê²½ì§, ê³ ë¦½' },
                'ìˆ˜': { yong: 'ì§€í˜œ, ìœ ì—°í•¨, ì†Œí†µ', hui: 'ì ì‘ë ¥ê³¼ í†µì°°ë ¥', gi: 'ìš°ìœ ë¶€ë‹¨, ë¶ˆì•ˆê°', gu: 'ê°ì • ê¸°ë³µ, ë°©í™©' }
            };
            
            const ohaengHanja = { 'ëª©': 'æœ¨', 'í™”': 'ç«', 'í† ': 'åœŸ', 'ê¸ˆ': 'é‡‘', 'ìˆ˜': 'æ°´' };
            
            return {
                isStrong,
                strengthDesc: isStrong ? 'ì‹ ê°•(èº«å¼·) - ì¼ê°„ì˜ í˜ì´ ê°•í•¨' : 'ì‹ ì•½(èº«å¼±) - ì¼ê°„ì˜ í˜ì´ ì•½í•¨',
                yongsin: `${yongsin}(${ohaengHanja[yongsin]})`,
                yongsinOhaeng: yongsin,
                yongsinDesc: ohaengDesc[yongsin].yong,
                huisin: `${huisin}(${ohaengHanja[huisin]})`,
                huisinOhaeng: huisin,
                huisinDesc: ohaengDesc[huisin].hui,
                gisin: `${gisin}(${ohaengHanja[gisin]})`,
                gisinOhaeng: gisin,
                gisinDesc: ohaengDesc[gisin].gi,
                gusin: `${gusin}(${ohaengHanja[gusin]})`,
                gusinOhaeng: gusin,
                gusinDesc: ohaengDesc[gusin].gu
            };
        }
        
        // ê° ì£¼ë³„ ì‹­ì„± ìƒì„¸ ê³„ì‚°
        function getPillarSipsung(dayGan, pillar) {
            if (!pillar) return { ganSipsung: '?', jiSipsung: '?' };
            
            let ganSipsung = 'ì¼ê°„';
            if (pillar.gan !== dayGan) {
                ganSipsung = SIPSUNG_MATRIX[dayGan][pillar.gan] || '?';
            }
            
            // ì§€ì§€ì˜ ëŒ€í‘œ ì‹­ì„± (ì§€ì¥ê°„ ì¤‘ ê°€ì¥ ê°•í•œ ê²ƒ = ë§ˆì§€ë§‰ ê²ƒ)
            const jjgList = JIJANGGAN[pillar.ji] || [];
            let jiSipsung = '?';
            if (jjgList.length > 0) {
                const mainJjg = jjgList[jjgList.length - 1]; // ì •ê¸°(ë³¸ê¸°)
                jiSipsung = SIPSUNG_MATRIX[dayGan][mainJjg] || '?';
            }
            
            return { ganSipsung, jiSipsung };
        }
        
        // ========== ì‹ ì‚´ ê³„ì‚° ==========
        // ì‹ ì‚´ ê³„ì‚° í•¨ìˆ˜ (ê¸°ì¡´ í˜¸ì¶œ ë°©ì‹ í˜¸í™˜)
        function calculateSinsal(dayGan, dayJi, monthJi, yearJi, hourJi, pillars) {
            const results = { ê¸¸ì‹ : [], ì–‘ë©´ì‹ : [] };
    
            // ê¸°ë³¸ ì •ë³´ ì¶”ì¶œ
            const ë…„ê°„ = pillars[0].gan;
            const ì›”ê°„ = pillars[1].gan;
            const ì¼ê°„ = dayGan;
            const ì‹œê°„ = pillars[3] ? pillars[3].gan : null;
    
            const ë…„ì§€ = yearJi;
            const ì›”ì§€ = monthJi;
            const ì¼ì§€ = dayJi;
            const ì‹œì§€ = hourJi;
    
            const ì²œê°„ = [ë…„ê°„, ì›”ê°„, ì¼ê°„];
            if (ì‹œê°„) ì²œê°„.push(ì‹œê°„);
    
            const ì§€ì§€ = [ë…„ì§€, ì›”ì§€, ì¼ì§€];
            if (ì‹œì§€) ì§€ì§€.push(ì‹œì§€);
    
            const ì¼ì£¼ë¬¸ì = ì¼ê°„ + ì¼ì§€;
            const ì‹œì£¼ë¬¸ì = ì‹œê°„ && ì‹œì§€ ? ì‹œê°„ + ì‹œì§€ : null;
    
            Object.entries(SINSAL_RULES).forEach(([name, rule]) => {
                let found = false;
                let foundIn = [];
        
                // 1. ì¼ê°„ ê¸°ì¤€ (ì§€ì§€ì—ì„œ ì°¾ê¸°)
                if (rule.basis === "ì¼ê°„" && rule.rule[ì¼ê°„]) {
                    const targets = rule.rule[ì¼ê°„];
                    const targetArray = Array.isArray(targets) ? targets : [targets];
            
                    if (rule.matchType === "ì²œê°„") {
                        ì²œê°„.forEach((g, i) => {
                            if (targetArray.includes(g)) {
                                found = true;
                                foundIn.push(["ë…„ê°„", "ì›”ê°„", "ì¼ê°„", "ì‹œê°„"][i]);
                            }
                        });
                    } else {
                        ì§€ì§€.forEach((z, i) => {
                            if (z && targetArray.includes(z)) {
                                found = true;
                                foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                            }
                        });
                    }
                }
        
                // 2. ì›”ì§€ ê¸°ì¤€
                else if (rule.basis === "ì›”ì§€" && rule.rule[ì›”ì§€]) {
                    const targets = rule.rule[ì›”ì§€];
                    const targetArray = Array.isArray(targets) ? targets : [targets];
            
                    if (rule.matchType === "ì²œê°„") {
                        ì²œê°„.forEach((g, i) => {
                            if (g && targetArray.includes(g)) {
                                found = true;
                                foundIn.push(["ë…„ê°„", "ì›”ê°„", "ì¼ê°„", "ì‹œê°„"][i]);
                            }
                        });
                    } else if (rule.matchType === "ì „ì²´") {
                        ì²œê°„.forEach((g, i) => {
                            if (g && targetArray.includes(g)) {
                                found = true;
                                foundIn.push(["ë…„ê°„", "ì›”ê°„", "ì¼ê°„", "ì‹œê°„"][i]);
                            }
                        });
                        ì§€ì§€.forEach((z, i) => {
                            if (z && targetArray.includes(z)) {
                                found = true;
                                foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                            }
                        });
                    } else {
                        ì§€ì§€.forEach((z, i) => {
                            if (z && targetArray.includes(z)) {
                                found = true;
                                foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                            }
                        });
                    }
                }
        
                // 3. ë…„ì§€ ê¸°ì¤€
                else if (rule.basis === "ë…„ì§€" && rule.rule[ë…„ì§€]) {
                    const targets = rule.rule[ë…„ì§€];
                    const targetArray = Array.isArray(targets) ? targets : [targets];
            
                    ì§€ì§€.forEach((z, i) => {
                        if (z && targetArray.includes(z)) {
                            found = true;
                            foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                        }
                    });
                }
        
                // 4. ì¼ì§€ ê¸°ì¤€
                else if (rule.basis === "ì¼ì§€") {
                    if (rule.rule[ì¼ì§€]) {
                        const targets = rule.rule[ì¼ì§€];
                        const targetArray = Array.isArray(targets) ? targets : [targets];
                
                        // ì¼ì§€ ìì²´ê°€ í•´ë‹¹í•˜ëŠ” ê²½ìš° (ë°±í˜¸ì‚´, í˜„ì¹¨ì‚´ ë“±)
                        if (targetArray.includes(ì¼ì§€)) {
                            found = true;
                            foundIn.push("ì¼ì§€");
                        }
                
                        // ë‹¤ë¥¸ ì§€ì§€ì—ì„œ ì°¾ê¸°
                        ì§€ì§€.forEach((z, i) => {
                            if (i !== 2 && z && targetArray.includes(z)) {
                                found = true;
                                foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                            }
                        });
                    }
                }
        
                // 5. ì¼ì£¼ ê¸°ì¤€ (ë°°ì—´)
                else if (rule.basis === "ì¼ì£¼" && Array.isArray(rule.rule)) {
                    if (rule.rule.includes(ì¼ì£¼ë¬¸ì)) {
                        found = true;
                        foundIn.push("ì¼ì£¼");
                    }
                }
        
                // 6. ì¼ì£¼ìˆœ ê¸°ì¤€ (ê³µë§)
                else if (rule.basis === "ì¼ì£¼ìˆœ" && rule.rule[ì¼ì£¼ë¬¸ì]) {
                    const ê³µë§ì§€ì§€ = rule.rule[ì¼ì£¼ë¬¸ì];
                    ì§€ì§€.forEach((z, i) => {
                        if (z && ê³µë§ì§€ì§€.includes(z)) {
                            found = true;
                            foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i] + "(ê³µë§)");
                        }
                    });
                }
        
                // 7. ì‹œì£¼ ê¸°ì¤€
                else if (rule.basis === "ì‹œì£¼" && Array.isArray(rule.rule)) {
                    if (ì‹œì£¼ë¬¸ì && rule.rule.includes(ì‹œì£¼ë¬¸ì)) {
                        found = true;
                        foundIn.push("ì‹œì£¼");
                    }
                }
        
                // 8. ì§€ì§€ ìŒ ê¸°ì¤€ (ê·€ë¬¸ê´€ì‚´, ì²œë¼ì§€ë§ì‚´, ê²©ê°ì‚´ ë“±)
                else if (rule.basis === "ì§€ì§€" && rule.matchType === "ìŒ" && Array.isArray(rule.rule)) {
                    for (let i = 0; i < ì§€ì§€.length; i++) {
                        if (!ì§€ì§€[i]) continue;
                        for (let j = i + 1; j < ì§€ì§€.length; j++) {
                            if (!ì§€ì§€[j]) continue;
                            for (const pair of rule.rule) {
                                if ((ì§€ì§€[i] === pair[0] && ì§€ì§€[j] === pair[1]) ||
                                    (ì§€ì§€[i] === pair[1] && ì§€ì§€[j] === pair[0])) {
                                    found = true;
                                    const positions = ["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"];
                                    foundIn.push(positions[i] + "-" + positions[j]);
                                }
                            }
                        }
                    }
                }
        
                // 9. ê¸€ì ê¸°ì¤€ (ê³¡ê°ì‚´)
                else if (rule.basis === "ê¸€ì" && Array.isArray(rule.rule)) {
                    ì²œê°„.forEach((g, i) => {
                        if (g && rule.rule.includes(g)) {
                            found = true;
                            foundIn.push(["ë…„ê°„", "ì›”ê°„", "ì¼ê°„", "ì‹œê°„"][i]);
                        }
                    });
                    ì§€ì§€.forEach((z, i) => {
                        if (z && rule.rule.includes(z)) {
                            found = true;
                            foundIn.push(["ë…„ì§€", "ì›”ì§€", "ì¼ì§€", "ì‹œì§€"][i]);
                        }
                    });
                }
        
                // 10. ê³„ì ˆ+ì¼ì£¼ ì¡°í•© (ì‚¬íŒ¨, ì²œì‚¬ì¼)
                else if (rule.basis === "ì›”ì§€+ì¼ì£¼" && rule.matchType === "ê³„ì ˆ") {
                    let ê³„ì ˆ = "";
                    if (["å¯…", "å¯", "è¾°"].includes(ì›”ì§€)) ê³„ì ˆ = "ë´„_å¯…å¯è¾°";
                    else if (["å·³", "åˆ", "æœª"].includes(ì›”ì§€)) ê³„ì ˆ = "ì—¬ë¦„_å·³åˆæœª";
                    else if (["ç”³", "é…‰", "æˆŒ"].includes(ì›”ì§€)) ê³„ì ˆ = "ê°€ì„_ç”³é…‰æˆŒ";
                    else if (["äº¥", "å­", "ä¸‘"].includes(ì›”ì§€)) ê³„ì ˆ = "ê²¨ìš¸_äº¥å­ä¸‘";
            
                    if (ê³„ì ˆ && rule.rule[ê³„ì ˆ]) {
                        if (rule.rule[ê³„ì ˆ].includes(ì¼ì£¼ë¬¸ì)) {
                            found = true;
                            foundIn.push("ì›”ì§€+ì¼ì£¼");
                        }
                    }
                }
        
                // 11. ì‚¼ê¸°ê·€ì¸ (ì²œê°„ ë°°ì—´)
                else if (rule.basis === "ì²œê°„ë°°ì—´" && rule.matchType === "ë°°ì—´") {
                    const ganStr = ì²œê°„.filter(g => g).join('');
                    // ì²œìƒì‚¼ê¸°: ç”²æˆŠåºš ìˆœì„œ
                    if (ganStr.includes('ç”²') && ganStr.includes('æˆŠ') && ganStr.includes('åºš')) {
                        const ê°‘idx = ì²œê°„.indexOf('ç”²');
                        const ë¬´idx = ì²œê°„.indexOf('æˆŠ');
                        const ê²½idx = ì²œê°„.indexOf('åºš');
                        if (ê°‘idx !== -1 && ë¬´idx !== -1 && ê²½idx !== -1 && ê°‘idx < ë¬´idx && ë¬´idx < ê²½idx) {
                            found = true;
                            foundIn.push("ì²œìƒì‚¼ê¸°");
                        }
                    }
                    // ì§€í•˜ì‚¼ê¸°: ä¹™ä¸™ä¸ ìˆœì„œ
                    if (ganStr.includes('ä¹™') && ganStr.includes('ä¸™') && ganStr.includes('ä¸')) {
                        const ì„idx = ì²œê°„.indexOf('ä¹™');
                        const ë³‘idx = ì²œê°„.indexOf('ä¸™');
                        const ì •idx = ì²œê°„.indexOf('ä¸');
                        if (ì„idx !== -1 && ë³‘idx !== -1 && ì •idx !== -1 && ì„idx < ë³‘idx && ë³‘idx < ì •idx) {
                            found = true;
                            foundIn.push("ì§€í•˜ì‚¼ê¸°");
                        }
                    }
                    // ì¸ì¤‘ì‚¼ê¸°: è¾›å£¬ç™¸ (ìˆœì„œ ë¬´ê´€)
                    if (ganStr.includes('è¾›') && ganStr.includes('å£¬') && ganStr.includes('ç™¸')) {
                        found = true;
                        foundIn.push("ì¸ì¤‘ì‚¼ê¸°");
                    }
                }
        
                // ê²°ê³¼ ì €ì¥
                if (found) {
                    const sinsalInfo = {
                        name: name,
                        type: rule.type,
                        description: rule.description,
                        foundIn: [...new Set(foundIn)].join(', ')
                    };
            
                    if (rule.type === "ê¸¸ì‹ ") {
                        results.ê¸¸ì‹ .push(sinsalInfo);
                    } else {
                        results.ì–‘ë©´ì‹ .push(sinsalInfo);
                    }
                }
            });
    
            return results;
        }
        
        // ì„¸ìš´ ê³„ì‚° (íŠ¹ì • ì—°ë„ ì²œê°„ì§€ì§€)
        function calculateSeun(targetYear = null) {
            const year = targetYear || new Date().getFullYear();
            const baseYear = 1984; // ê°‘ìë…„
            const diff = year - baseYear;
            const ganIndex = ((diff % 10) + 10) % 10;
            const jiIndex = ((diff % 12) + 12) % 12;
            return {
                year: year,
                gan: CHEONGAN[ganIndex],
                ji: JIJI[jiIndex],
                ganKr: CHEONGAN_KR[ganIndex],
                jiKr: JIJI_KR[jiIndex]
            };
        }

        // ========== ì›”ìš´ ê³„ì‚° (ì—°ë„ë³„ 12ê°œì›” ì²œê°„ì§€ì§€ + ì ìˆ˜) ==========
        function calculateMonthlyFortune(targetYear, dayGan, yongsinOhaeng, huisinOhaeng, gisinOhaeng, gusinOhaeng) {
            // ì›”ë³„ ì§€ì§€ (ê³ ì •): 1ì›”=å¯…, 2ì›”=å¯, ... 12ì›”=ä¸‘
            const MONTH_JIJI = ['å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥', 'å­', 'ä¸‘'];
            const MONTH_JIJI_KR = ['ì¸', 'ë¬˜', 'ì§„', 'ì‚¬', 'ì˜¤', 'ë¯¸', 'ì‹ ', 'ìœ ', 'ìˆ ', 'í•´', 'ì', 'ì¶•'];

            // ì—°ê°„ì— ë”°ë¥¸ ì›”ê°„ ì‹œì‘ (ë…„ê°„â†’1ì›” ì²œê°„)
            const YEAR_MONTH_GAN_START = {
                'ç”²': 2, 'å·±': 2,  // ë³‘ì¸ì›” ì‹œì‘
                'ä¹™': 4, 'åºš': 4,  // ë¬´ì¸ì›” ì‹œì‘
                'ä¸™': 6, 'è¾›': 6,  // ê²½ì¸ì›” ì‹œì‘
                'ä¸': 8, 'å£¬': 8,  // ì„ì¸ì›” ì‹œì‘
                'æˆŠ': 0, 'ç™¸': 0   // ê°‘ì¸ì›” ì‹œì‘
            };

            // í•´ë‹¹ ì—°ë„ì˜ ì²œê°„ êµ¬í•˜ê¸°
            const seun = calculateSeun(targetYear);
            const yearGan = seun.gan;
            const ganStartIndex = YEAR_MONTH_GAN_START[yearGan];

            // ì˜¤í–‰ ë§¤í•‘
            const GAN_OHAENG = {'ç”²':'ëª©','ä¹™':'ëª©','ä¸™':'í™”','ä¸':'í™”','æˆŠ':'í† ','å·±':'í† ','åºš':'ê¸ˆ','è¾›':'ê¸ˆ','å£¬':'ìˆ˜','ç™¸':'ìˆ˜'};
            const JI_OHAENG = {'å¯…':'ëª©','å¯':'ëª©','è¾°':'í† ','å·³':'í™”','åˆ':'í™”','æœª':'í† ','ç”³':'ê¸ˆ','é…‰':'ê¸ˆ','æˆŒ':'í† ','äº¥':'ìˆ˜','å­':'ìˆ˜','ä¸‘':'í† '};

            const monthlyData = [];

            for (let i = 0; i < 12; i++) {
                const month = i + 1;
                const ganIndex = (ganStartIndex + i) % 10;
                const gan = CHEONGAN[ganIndex];
                const ganKr = CHEONGAN_KR[ganIndex];
                const ji = MONTH_JIJI[i];
                const jiKr = MONTH_JIJI_KR[i];

                // ì˜¤í–‰ ê³„ì‚°
                const ganOhaeng = GAN_OHAENG[gan];
                const jiOhaeng = JI_OHAENG[ji];

                // ì ìˆ˜ ê³„ì‚° (ìš©ì‹ /í¬ì‹ /ê¸°ì‹ /êµ¬ì‹  ê¸°ì¤€)
                let score = 50; // ê¸°ë³¸ ì ìˆ˜
                let scoreFactors = [];

                // ì²œê°„ ì˜¤í–‰ ì²´í¬
                if (ganOhaeng === yongsinOhaeng) { score += 25; scoreFactors.push('ì²œê°„ìš©ì‹ '); }
                else if (ganOhaeng === huisinOhaeng) { score += 15; scoreFactors.push('ì²œê°„í¬ì‹ '); }
                else if (ganOhaeng === gisinOhaeng) { score -= 15; scoreFactors.push('ì²œê°„ê¸°ì‹ '); }
                else if (ganOhaeng === gusinOhaeng) { score -= 20; scoreFactors.push('ì²œê°„êµ¬ì‹ '); }

                // ì§€ì§€ ì˜¤í–‰ ì²´í¬
                if (jiOhaeng === yongsinOhaeng) { score += 25; scoreFactors.push('ì§€ì§€ìš©ì‹ '); }
                else if (jiOhaeng === huisinOhaeng) { score += 15; scoreFactors.push('ì§€ì§€í¬ì‹ '); }
                else if (jiOhaeng === gisinOhaeng) { score -= 15; scoreFactors.push('ì§€ì§€ê¸°ì‹ '); }
                else if (jiOhaeng === gusinOhaeng) { score -= 20; scoreFactors.push('ì§€ì§€êµ¬ì‹ '); }

                // ì ìˆ˜ ë²”ìœ„ ì œí•œ (20~100)
                score = Math.max(20, Math.min(100, score));

                // ì´ëª¨ì§€ ë³€í™˜
                let emoji = '';
                if (score >= 90) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•';
                else if (score >= 80) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ”';
                else if (score >= 70) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ”ğŸŒ‘';
                else if (score >= 60) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘';
                else if (score >= 50) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ”ğŸŒ‘ğŸŒ‘';
                else if (score >= 40) emoji = 'ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘';
                else if (score >= 30) emoji = 'ğŸŒ•ğŸŒ”ğŸŒ‘ğŸŒ‘ğŸŒ‘';
                else emoji = 'ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘ğŸŒ‘';

                // í‚¤ì›Œë“œ ìƒì„±
                let keyword = '';
                if (score >= 80) keyword = 'ê¸°íšŒ, í–‰ìš´';
                else if (score >= 70) keyword = 'ìˆœì¡°, ë°œì „';
                else if (score >= 60) keyword = 'ì•ˆì •, í‰ì˜¨';
                else if (score >= 50) keyword = 'ë³´í†µ, ìœ ì§€';
                else if (score >= 40) keyword = 'ì£¼ì˜, ì‹ ì¤‘';
                else keyword = 'ì¡°ì‹¬, íœ´ì‹';

                // íŠ¹ìˆ˜ í‘œì‹œ
                let mark = '';
                if (score >= 85) mark = 'â­';
                else if (score <= 35) mark = 'âš ï¸';

                monthlyData.push({
                    month: month,
                    gan: gan,
                    ganKr: ganKr,
                    ji: ji,
                    jiKr: jiKr,
                    ganJi: gan + ji,
                    ganJiKr: ganKr + jiKr,
                    ganOhaeng: ganOhaeng,
                    jiOhaeng: jiOhaeng,
                    ohaengDisplay: ganOhaeng.charAt(0).toUpperCase() + jiOhaeng.charAt(0).toUpperCase(),
                    score: score,
                    emoji: emoji,
                    keyword: keyword,
                    mark: mark,
                    factors: scoreFactors
                });
            }

            return {
                year: targetYear,
                seun: seun.gan + seun.ji,
                seunKr: seun.ganKr + seun.jiKr,
                months: monthlyData
            };
        }

        // ========== ì‚¼ì¬(ä¸‰ç½) ê³„ì‚° ==========
        function calculateSamjae(yearJi) {
            // ì‚¼ì¬ ê·œì¹™: ë ë³„ë¡œ 3ë…„ê°„ ì‚¼ì¬ê°€ ì˜´
            // ì‹ ìì§„(ç”³å­è¾°)ë  â†’ ì¸ë¬˜ì§„(å¯…å¯è¾°)ë…„ ì‚¼ì¬
            // ì¸ì˜¤ìˆ (å¯…åˆæˆŒ)ë  â†’ ì‹ ìœ ìˆ (ç”³é…‰æˆŒ)ë…„ ì‚¼ì¬
            // ì‚¬ìœ ì¶•(å·³é…‰ä¸‘)ë  â†’ í•´ìì¶•(äº¥å­ä¸‘)ë…„ ì‚¼ì¬
            // í•´ë¬˜ë¯¸(äº¥å¯æœª)ë  â†’ ì‚¬ì˜¤ë¯¸(å·³åˆæœª)ë…„ ì‚¼ì¬
            const samjaeMap = {
                'ç”³': ['å¯…', 'å¯', 'è¾°'], 'å­': ['å¯…', 'å¯', 'è¾°'], 'è¾°': ['å¯…', 'å¯', 'è¾°'],
                'å¯…': ['ç”³', 'é…‰', 'æˆŒ'], 'åˆ': ['ç”³', 'é…‰', 'æˆŒ'], 'æˆŒ': ['ç”³', 'é…‰', 'æˆŒ'],
                'å·³': ['äº¥', 'å­', 'ä¸‘'], 'é…‰': ['äº¥', 'å­', 'ä¸‘'], 'ä¸‘': ['äº¥', 'å­', 'ä¸‘'],
                'äº¥': ['å·³', 'åˆ', 'æœª'], 'å¯': ['å·³', 'åˆ', 'æœª'], 'æœª': ['å·³', 'åˆ', 'æœª']
            };

            const samjaeYears = samjaeMap[yearJi] || [];
            if (samjaeYears.length === 0) {
                return { isSamjae: false, type: null, samjaeYears: [], currentYearJi: null };
            }

            // í˜„ì¬ ì—°ë„ì˜ ì§€ì§€ ê³„ì‚°
            const currentYear = new Date().getFullYear();
            const baseYear = 1984; // ê°‘ìë…„
            const diff = currentYear - baseYear;
            const jiIndex = ((diff % 12) + 12) % 12;
            const currentYearJi = JIJI[jiIndex];

            // ì‚¼ì¬ ìœ í˜• íŒë‹¨ (ë“¤ì‚¼ì¬/ëˆ”ì‚¼ì¬/ë‚ ì‚¼ì¬)
            const idx = samjaeYears.indexOf(currentYearJi);
            let samjaeType = null;
            let samjaeDesc = null;

            if (idx === 0) {
                samjaeType = 'ë“¤ì‚¼ì¬';
                samjaeDesc = 'ì‚¼ì¬ê°€ ì‹œì‘ë˜ëŠ” í•´ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì¼ì„ ì‹œì‘í•˜ê¸°ë³´ë‹¤ ì¤€ë¹„í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.';
            } else if (idx === 1) {
                samjaeType = 'ëˆ”ì‚¼ì¬';
                samjaeDesc = 'ì‚¼ì¬ì˜ ì¤‘ê°„ í•´ì…ë‹ˆë‹¤. ê°€ì¥ ì£¼ì˜ê°€ í•„ìš”í•œ ì‹œê¸°ë¡œ, ê±´ê°•ê³¼ ì•ˆì „ì— ìœ ì˜í•˜ì„¸ìš”.';
            } else if (idx === 2) {
                samjaeType = 'ë‚ ì‚¼ì¬';
                samjaeDesc = 'ì‚¼ì¬ê°€ ëë‚˜ê°€ëŠ” í•´ì…ë‹ˆë‹¤. ê³§ ì‚¼ì¬ì—ì„œ ë²—ì–´ë‚˜ë‹ˆ í¬ë§ì„ ê°€ì§€ì„¸ìš”.';
            }

            // ì‚¼ì¬ ì—°ë„ë¥¼ í•œê¸€ë¡œ ë³€í™˜
            const jiToKr = {
                'å¯…': 'ì¸(í˜¸ë‘ì´)', 'å¯': 'ë¬˜(í† ë¼)', 'è¾°': 'ì§„(ìš©)',
                'ç”³': 'ì‹ (ì›ìˆ­ì´)', 'é…‰': 'ìœ (ë‹­)', 'æˆŒ': 'ìˆ (ê°œ)',
                'äº¥': 'í•´(ë¼ì§€)', 'å­': 'ì(ì¥)', 'ä¸‘': 'ì¶•(ì†Œ)',
                'å·³': 'ì‚¬(ë±€)', 'åˆ': 'ì˜¤(ë§)', 'æœª': 'ë¯¸(ì–‘)'
            };

            const samjaeYearsKr = samjaeYears.map(ji => `${ji}(${jiToKr[ji]?.split('(')[1] || ji}ë…„`);

            return {
                isSamjae: samjaeType !== null,
                type: samjaeType,
                description: samjaeDesc,
                samjaeYears: samjaeYears,
                samjaeYearsKr: samjaeYearsKr,
                currentYearJi: currentYearJi,
                currentYear: currentYear
            };
        }

        // ========== Birth Chart (ì„œì–‘ ì ì„±ìˆ ) ê³„ì‚° ==========
        function calculateBirthChart(birthDate, birthHour, birthMinute, latitude, longitude) {
            // Astronomy Engineì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof Astronomy === 'undefined') {
                console.error('Astronomy Engineì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return null;
            }

            console.log('Birth Chart ê³„ì‚° ì‹œì‘:', { birthDate, birthHour, birthMinute, latitude, longitude });

            try {
                // ë‚ ì§œ/ì‹œê°„ ê°ì²´ ìƒì„±
                const date = new Date(birthDate);
                date.setHours(birthHour || 12, birthMinute || 0, 0, 0);
                console.log('ê³„ì‚° ë‚ ì§œ:', date);

                // í™©ë„ëŒ€ ê¸°í˜¸
                const ZODIAC_SIGNS = [
                    { name: 'ì–‘ìë¦¬', symbol: 'â™ˆ', emoji: 'ğŸ' },
                    { name: 'í™©ì†Œìë¦¬', symbol: 'â™‰', emoji: 'ğŸ‚' },
                    { name: 'ìŒë‘¥ì´ìë¦¬', symbol: 'â™Š', emoji: 'ğŸ‘¯' },
                    { name: 'ê²Œìë¦¬', symbol: 'â™‹', emoji: 'ğŸ¦€' },
                    { name: 'ì‚¬ììë¦¬', symbol: 'â™Œ', emoji: 'ğŸ¦' },
                    { name: 'ì²˜ë…€ìë¦¬', symbol: 'â™', emoji: 'ğŸ‘©' },
                    { name: 'ì²œì¹­ìë¦¬', symbol: 'â™', emoji: 'âš–ï¸' },
                    { name: 'ì „ê°ˆìë¦¬', symbol: 'â™', emoji: 'ğŸ¦‚' },
                    { name: 'ì‚¬ìˆ˜ìë¦¬', symbol: 'â™', emoji: 'ğŸ¹' },
                    { name: 'ì—¼ì†Œìë¦¬', symbol: 'â™‘', emoji: 'ğŸ' },
                    { name: 'ë¬¼ë³‘ìë¦¬', symbol: 'â™’', emoji: 'ğŸº' },
                    { name: 'ë¬¼ê³ ê¸°ìë¦¬', symbol: 'â™“', emoji: 'ğŸŸ' }
                ];

                // í–‰ì„± ëª©ë¡
                const PLANETS = [
                    { name: 'Sun', kr: 'íƒœì–‘', emoji: 'â˜€ï¸', body: Astronomy.Body.Sun },
                    { name: 'Moon', kr: 'ë‹¬', emoji: 'ğŸŒ™', body: Astronomy.Body.Moon },
                    { name: 'Mercury', kr: 'ìˆ˜ì„±', emoji: 'â˜¿ï¸', body: Astronomy.Body.Mercury },
                    { name: 'Venus', kr: 'ê¸ˆì„±', emoji: 'â™€ï¸', body: Astronomy.Body.Venus },
                    { name: 'Mars', kr: 'í™”ì„±', emoji: 'â™‚ï¸', body: Astronomy.Body.Mars },
                    { name: 'Jupiter', kr: 'ëª©ì„±', emoji: 'â™ƒ', body: Astronomy.Body.Jupiter },
                    { name: 'Saturn', kr: 'í† ì„±', emoji: 'â™„', body: Astronomy.Body.Saturn },
                    { name: 'Uranus', kr: 'ì²œì™•ì„±', emoji: 'â›¢', body: Astronomy.Body.Uranus },
                    { name: 'Neptune', kr: 'í•´ì™•ì„±', emoji: 'â™†', body: Astronomy.Body.Neptune },
                    { name: 'Pluto', kr: 'ëª…ì™•ì„±', emoji: 'â™‡', body: Astronomy.Body.Pluto }
                ];

                // í™©ê²½ì„ ë³„ìë¦¬ì™€ ë„ìˆ˜ë¡œ ë³€í™˜
                function eclipticToZodiac(longitude) {
                    const signIndex = Math.floor(longitude / 30) % 12;
                    const degree = longitude % 30;
                    return {
                        sign: ZODIAC_SIGNS[signIndex],
                        degree: degree.toFixed(2),
                        longitude: longitude.toFixed(2)
                    };
                }

                // í–‰ì„± ìœ„ì¹˜ ê³„ì‚°
                const planetPositions = [];
                for (const planet of PLANETS) {
                    try {
                        let eclLon;

                        if (planet.name === 'Sun') {
                            // íƒœì–‘ì€ SunPosition ì‚¬ìš© (ë” ì •í™•)
                            const sunPos = Astronomy.SunPosition(date);
                            eclLon = sunPos.elon;
                        } else if (planet.name === 'Moon') {
                            // ë‹¬ì€ EclipticGeoMoon ì‚¬ìš©
                            const moonPos = Astronomy.EclipticGeoMoon(date);
                            eclLon = moonPos.lon;
                        } else {
                            // ë‹¤ë¥¸ í–‰ì„±ì€ GeoVector + Ecliptic ì‚¬ìš©
                            const geo = Astronomy.GeoVector(planet.body, date, true);
                            const ecl = Astronomy.Ecliptic(geo);
                            eclLon = ecl.elon;
                        }

                        const zodiac = eclipticToZodiac(eclLon);

                        planetPositions.push({
                            name: planet.name,
                            kr: planet.kr,
                            emoji: planet.emoji,
                            longitude: eclLon,
                            sign: zodiac.sign,
                            degree: zodiac.degree
                        });
                    } catch (e) {
                        console.log(`í–‰ì„± ê³„ì‚° ì˜¤ë¥˜ (${planet.kr}):`, e);
                    }
                }

                // ASC (Ascendant/ìƒìŠ¹ì ) ê³„ì‚° - Whole Sign ì‹œìŠ¤í…œ
                let ascendant = null;
                let ascSignIndex = 0;
                try {
                    // í•­ì„±ì‹œ ê³„ì‚°
                    const gst = Astronomy.SiderealTime(date);
                    const lst = (gst + longitude / 15 + 24) % 24; // ì§€ë°©í•­ì„±ì‹œ
                    const lstDegrees = lst * 15; // ë„ ë‹¨ìœ„ë¡œ ë³€í™˜

                    // í™©ë„ ê²½ì‚¬ê°
                    const obliquity = 23.44;
                    const latRad = latitude * Math.PI / 180;
                    const oblRad = obliquity * Math.PI / 180;

                    // RAMC (Right Ascension of Medium Coeli)
                    const ramcRad = lstDegrees * Math.PI / 180;

                    // ASC ê³µì‹ (ì •ë°€ ê³„ì‚°)
                    const y = -Math.cos(ramcRad);
                    const x = Math.sin(ramcRad) * Math.cos(oblRad) + Math.tan(latRad) * Math.sin(oblRad);
                    let ascLon = Math.atan2(y, x) * 180 / Math.PI;
                    ascLon = (ascLon + 360) % 360;

                    ascendant = eclipticToZodiac(ascLon);
                    ascSignIndex = Math.floor(ascLon / 30);
                    console.log('ASC ê³„ì‚° ì™„ë£Œ:', ascLon.toFixed(2) + 'Â°', ascendant.sign.name);
                } catch (e) {
                    console.log('ASC ê³„ì‚° ì˜¤ë¥˜:', e);
                    // ê¸°ë³¸ê°’: íƒœì–‘ ë³„ìë¦¬ ì‚¬ìš©
                    const sunPlanet = planetPositions.find(p => p.name === 'Sun');
                    if (sunPlanet) {
                        ascSignIndex = Math.floor(sunPlanet.longitude / 30);
                        ascendant = eclipticToZodiac(sunPlanet.longitude);
                    }
                }

                // í•˜ìš°ìŠ¤ ê³„ì‚° (Whole Sign ì‹œìŠ¤í…œ - ASC ë³„ìë¦¬ê°€ 1í•˜ìš°ìŠ¤)
                const houses = [];
                for (let i = 0; i < 12; i++) {
                    const houseSignIndex = (ascSignIndex + i) % 12;
                    houses.push({
                        house: i + 1,
                        sign: ZODIAC_SIGNS[houseSignIndex],
                        cusp: (houseSignIndex * 30) % 360
                    });
                }

                // ì• ìŠ¤í™íŠ¸ ê³„ì‚° (ì£¼ìš” ì• ìŠ¤í™íŠ¸ë§Œ)
                const ASPECTS = [
                    { name: 'í•©', symbol: 'â˜Œ', angle: 0, orb: 8 },
                    { name: 'ìœ¡í•©', symbol: 'âš¹', angle: 60, orb: 6 },
                    { name: 'ì‚¬ê°', symbol: 'â–¡', angle: 90, orb: 6 },
                    { name: 'ì‚¼í•©', symbol: 'â–³', angle: 120, orb: 8 },
                    { name: 'ì¶©', symbol: 'â˜', angle: 180, orb: 8 }
                ];

                const aspects = [];
                for (let i = 0; i < planetPositions.length; i++) {
                    for (let j = i + 1; j < planetPositions.length; j++) {
                        const p1 = planetPositions[i];
                        const p2 = planetPositions[j];
                        let diff = Math.abs(p1.longitude - p2.longitude);
                        if (diff > 180) diff = 360 - diff;

                        for (const aspect of ASPECTS) {
                            if (Math.abs(diff - aspect.angle) <= aspect.orb) {
                                aspects.push({
                                    planet1: p1,
                                    planet2: p2,
                                    aspect: aspect,
                                    exactAngle: diff.toFixed(1)
                                });
                                break;
                            }
                        }
                    }
                }

                return {
                    planets: planetPositions,
                    ascendant: ascendant,
                    houses: houses,
                    aspects: aspects.slice(0, 15) // ìƒìœ„ 15ê°œë§Œ
                };
            } catch (e) {
                console.error('Birth Chart ê³„ì‚° ì˜¤ë¥˜:', e);
                return null;
            }
        }

        // Birth Chart UI í‘œì‹œ
        function displayBirthChart(chart) {
            if (!chart) return;

            const section = document.getElementById('birthChartSection');
            section.style.display = 'block';

            // í–‰ì„± ìœ„ì¹˜ í‘œì‹œ
            const planetDiv = document.getElementById('planetPositions');
            planetDiv.innerHTML = chart.planets.map(p => `
                <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 20px;">${p.emoji}</div>
                    <div style="font-size: 12px; color: #888;">${p.kr}</div>
                    <div style="color: #d4af82; font-size: 14px;">${p.sign.symbol} ${p.degree}Â°</div>
                    <div style="font-size: 10px; color: #666;">${p.sign.name}</div>
                </div>
            `).join('');

            // í•˜ìš°ìŠ¤ í‘œì‹œ
            const houseDiv = document.getElementById('housePositions');
            if (chart.houses.length > 0) {
                houseDiv.innerHTML = chart.houses.map(h => `
                    <div style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 10px; color: #888;">${h.house}í•˜ìš°ìŠ¤</div>
                        <div style="font-size: 16px;">${h.sign.symbol}</div>
                        <div style="font-size: 10px; color: #666;">${h.sign.name}</div>
                    </div>
                `).join('');
            } else {
                houseDiv.innerHTML = '<div style="color: #888;">í•˜ìš°ìŠ¤ ê³„ì‚° ë¶ˆê°€</div>';
            }

            // ì• ìŠ¤í™íŠ¸ í‘œì‹œ
            const aspectDiv = document.getElementById('aspectsDisplay');
            if (chart.aspects.length > 0) {
                aspectDiv.innerHTML = chart.aspects.map(a => `
                    <div style="background: rgba(0,0,0,0.2); padding: 6px 10px; border-radius: 20px; font-size: 12px;">
                        ${a.planet1.emoji}${a.aspect.symbol}${a.planet2.emoji}
                        <span style="color: #888; margin-left: 4px;">${a.aspect.name}</span>
                    </div>
                `).join('');
            } else {
                aspectDiv.innerHTML = '<div style="color: #888;">ì• ìŠ¤í™íŠ¸ ì—†ìŒ</div>';
            }
        }

        // ========== í•©ì¶©í˜•íŒŒí•´(åˆæ²–åˆ‘ç ´å®³) ë¶„ì„ í•¨ìˆ˜ ==========

        function analyzeHapChungHyungPaHae(yearP, monthP, dayP, hourP) {
            const result = {
                // í•© (ì¢‹ì€ ê´€ê³„)
                cheonganHap: [],      // ì²œê°„í•©
                yukhap: [],           // ì§€ì§€ìœ¡í•©
                samhap: [],           // ì§€ì§€ì‚¼í•©
                banghap: [],          // ì§€ì§€ë°©í•©
                // ì¶© (ì¶©ëŒ)
                chung: [],            // ì§€ì§€ì¶©
                // í˜•íŒŒí•´ (ë‚˜ìœ ê´€ê³„)
                hyung: [],            // ì§€ì§€í˜•
                pa: [],               // ì§€ì§€íŒŒ
                hae: [],              // ì§€ì§€í•´
                // ìš”ì•½
                summary: []
            };

            // ì²œê°„ê³¼ ì§€ì§€ ëª¨ìœ¼ê¸°
            const cheongans = [
                { pos: "ë…„", char: yearP.gan },
                { pos: "ì›”", char: monthP.gan },
                { pos: "ì¼", char: dayP.gan }
            ];
            const jijis = [
                { pos: "ë…„ì§€", char: yearP.ji },
                { pos: "ì›”ì§€", char: monthP.ji },
                { pos: "ì¼ì§€", char: dayP.ji }
            ];

            if (hourP) {
                cheongans.push({ pos: "ì‹œ", char: hourP.gan });
                jijis.push({ pos: "ì‹œì§€", char: hourP.ji });
            }

            // 1. ì²œê°„í•© ë¶„ì„
            for (let i = 0; i < cheongans.length; i++) {
                for (let j = i + 1; j < cheongans.length; j++) {
                    const gan1 = cheongans[i];
                    const gan2 = cheongans[j];
                    const hapInfo = CHEONGAN_HAP[gan1.char];
                    if (hapInfo && hapInfo.partner === gan2.char) {
                        result.cheonganHap.push({
                            pos1: gan1.pos,
                            pos2: gan2.pos,
                            char1: gan1.char,
                            char2: gan2.char,
                            result: hapInfo.result,
                            resultHanja: hapInfo.resultHanja,
                            display: `${gan1.char}${gan2.char}í•©(${hapInfo.resultHanja})`
                        });
                    }
                }
            }

            // 2. ì§€ì§€ìœ¡í•© ë¶„ì„
            for (let i = 0; i < jijis.length; i++) {
                for (let j = i + 1; j < jijis.length; j++) {
                    const ji1 = jijis[i];
                    const ji2 = jijis[j];
                    const hapInfo = JIJI_YUKHAP[ji1.char];
                    if (hapInfo && hapInfo.partner === ji2.char) {
                        result.yukhap.push({
                            pos1: ji1.pos,
                            pos2: ji2.pos,
                            char1: ji1.char,
                            char2: ji2.char,
                            result: hapInfo.result,
                            resultHanja: hapInfo.resultHanja,
                            display: `${ji1.char}${ji2.char}í•©(${hapInfo.resultHanja})`
                        });
                    }
                }
            }

            // 3. ì§€ì§€ì‚¼í•© ë¶„ì„
            const jijiChars = jijis.map(j => j.char);
            for (const samhap of JIJI_SAMHAP) {
                const matched = samhap.members.filter(m => jijiChars.includes(m));
                if (matched.length >= 2) {
                    const missing = samhap.members.filter(m => !jijiChars.includes(m));
                    const hasCenter = jijiChars.includes(samhap.center);
                    result.samhap.push({
                        matched: matched,
                        missing: missing,
                        result: samhap.result,
                        resultHanja: samhap.resultHanja,
                        isComplete: matched.length === 3,
                        hasCenter: hasCenter,
                        display: matched.length === 3
                            ? `${matched.join('')} ì‚¼í•©(${samhap.resultHanja})`
                            : `${matched.join('')} ë°˜í•©(${samhap.resultHanja}) - ${missing[0]} í•„ìš”`
                    });
                }
            }

            // 4. ì§€ì§€ë°©í•© ë¶„ì„
            for (const banghap of JIJI_BANGHAP) {
                const matched = banghap.members.filter(m => jijiChars.includes(m));
                if (matched.length >= 2) {
                    const missing = banghap.members.filter(m => !jijiChars.includes(m));
                    result.banghap.push({
                        matched: matched,
                        missing: missing,
                        result: banghap.result,
                        resultHanja: banghap.resultHanja,
                        season: banghap.season,
                        isComplete: matched.length === 3,
                        display: matched.length === 3
                            ? `${matched.join('')} ë°©í•©(${banghap.resultHanja})`
                            : `${matched.join('')} ë°©í•© ë¯¸ì™„ì„± - ${missing.join(',')} í•„ìš”`
                    });
                }
            }

            // 5. ì§€ì§€ì¶© ë¶„ì„
            for (let i = 0; i < jijis.length; i++) {
                for (let j = i + 1; j < jijis.length; j++) {
                    const ji1 = jijis[i];
                    const ji2 = jijis[j];
                    if (JIJI_CHUNG[ji1.char] === ji2.char) {
                        result.chung.push({
                            pos1: ji1.pos,
                            pos2: ji2.pos,
                            char1: ji1.char,
                            char2: ji2.char,
                            display: `${ji1.char}${ji2.char}ì¶©`,
                            description: `${ji1.pos}â†”${ji2.pos} ì¶©ëŒ`
                        });
                    }
                }
            }

            // 6. ì§€ì§€í˜• ë¶„ì„
            // ë¬´ë¡€ì§€í˜•/ë¬´ì€ì§€í˜• ì²´í¬
            for (const [type, info] of Object.entries(JIJI_HYUNG)) {
                if (type === 'ìƒí˜•') {
                    // ìƒí˜• (å­å¯)
                    for (const pair of info.pairs) {
                        if (jijiChars.includes(pair[0]) && jijiChars.includes(pair[1])) {
                            result.hyung.push({
                                type: type,
                                chars: pair,
                                display: `${pair[0]}${pair[1]}í˜•`,
                                description: info.description
                            });
                        }
                    }
                } else if (type === 'ìí˜•') {
                    // ìí˜• (ê°™ì€ ê¸€ì 2ê°œ ì´ìƒ)
                    for (const char of info.members) {
                        const count = jijiChars.filter(j => j === char).length;
                        if (count >= 2) {
                            result.hyung.push({
                                type: type,
                                chars: [char, char],
                                display: `${char}${char}ìí˜•`,
                                description: info.description
                            });
                        }
                    }
                } else {
                    // ë¬´ë¡€ì§€í˜•, ë¬´ì€ì§€í˜• (2ê°œ ì´ìƒ ìˆìœ¼ë©´)
                    const matched = info.members.filter(m => jijiChars.includes(m));
                    if (matched.length >= 2) {
                        result.hyung.push({
                            type: type,
                            chars: matched,
                            display: `${matched.join('')}í˜•`,
                            description: info.description
                        });
                    }
                }
            }

            // 7. ì§€ì§€íŒŒ ë¶„ì„
            for (let i = 0; i < jijis.length; i++) {
                for (let j = i + 1; j < jijis.length; j++) {
                    const ji1 = jijis[i];
                    const ji2 = jijis[j];
                    if (JIJI_PA[ji1.char] === ji2.char) {
                        result.pa.push({
                            pos1: ji1.pos,
                            pos2: ji2.pos,
                            char1: ji1.char,
                            char2: ji2.char,
                            display: `${ji1.char}${ji2.char}íŒŒ`
                        });
                    }
                }
            }

            // 8. ì§€ì§€í•´ ë¶„ì„
            for (let i = 0; i < jijis.length; i++) {
                for (let j = i + 1; j < jijis.length; j++) {
                    const ji1 = jijis[i];
                    const ji2 = jijis[j];
                    if (JIJI_HAE[ji1.char] === ji2.char) {
                        result.hae.push({
                            pos1: ji1.pos,
                            pos2: ji2.pos,
                            char1: ji1.char,
                            char2: ji2.char,
                            display: `${ji1.char}${ji2.char}í•´`
                        });
                    }
                }
            }

            // ìš”ì•½ íƒœê·¸ ìƒì„±
            if (result.cheonganHap.length > 0) {
                result.summary.push(...result.cheonganHap.map(h => h.display));
            }
            if (result.yukhap.length > 0) {
                result.summary.push(...result.yukhap.map(h => h.display));
            }
            if (result.samhap.length > 0) {
                result.summary.push(...result.samhap.map(h => h.display));
            }
            if (result.chung.length > 0) {
                result.summary.push(...result.chung.map(c => c.display));
            }
            if (result.hyung.length > 0) {
                result.summary.push(...result.hyung.map(h => h.display));
            }
            if (result.pa.length > 0) {
                result.summary.push(...result.pa.map(p => p.display));
            }
            if (result.hae.length > 0) {
                result.summary.push(...result.hae.map(h => h.display));
            }

            return result;
        }

        // ëŒ€ìš´ìˆ˜ ê³„ì‚° (ìƒì¼ ~ ì ˆê¸°ê¹Œì§€ ì¼ìˆ˜ Ã· 3)
        function calculateDaeunStartAge(birthDate, isForward) {
            const year = birthDate.getFullYear();
            const data = JEOLGI_DATA[year] || JEOLGI_DATA[2000];
            const nextYearData = JEOLGI_DATA[year + 1] || JEOLGI_DATA[2000];
            const prevYearData = JEOLGI_DATA[year - 1] || JEOLGI_DATA[2000];
            
            // ì ˆê¸° ìˆœì„œ (ì›” ê¸°ì¤€)
            const jeolgiOrder = ["ì†Œí•œ", "ì…ì¶˜", "ê²½ì¹©", "ì²­ëª…", "ì…í•˜", "ë§ì¢…", 
                                 "ì†Œì„œ", "ì…ì¶”", "ë°±ë¡œ", "í•œë¡œ", "ì…ë™", "ëŒ€ì„¤"];
            
            // ëª¨ë“  ì ˆê¸°ë¥¼ ë‚ ì§œ ê°ì²´ë¡œ ë³€í™˜
            const jeolgiDates = [];
            
            // ì „ë…„ë„ ëŒ€ì„¤
            jeolgiDates.push({
                name: "ëŒ€ì„¤",
                date: new Date(year - 1, prevYearData.ëŒ€ì„¤[0] - 1, prevYearData.ëŒ€ì„¤[1])
            });
            
            // ì˜¬í•´ ì ˆê¸°ë“¤
            for (const j of jeolgiOrder) {
                const jData = data[j];
                if (jData) {
                    jeolgiDates.push({
                        name: j,
                        date: new Date(year, jData[0] - 1, jData[1])
                    });
                }
            }
            
            // ë‚´ë…„ ì†Œí•œ, ì…ì¶˜
            jeolgiDates.push({
                name: "ì†Œí•œ",
                date: new Date(year + 1, nextYearData.ì†Œí•œ[0] - 1, nextYearData.ì†Œí•œ[1])
            });
            jeolgiDates.push({
                name: "ì…ì¶˜",
                date: new Date(year + 1, nextYearData.ì…ì¶˜[0] - 1, nextYearData.ì…ì¶˜[1])
            });
            
            // ë‚ ì§œìˆœ ì •ë ¬
            jeolgiDates.sort((a, b) => a.date - b.date);
            
            // ìƒì¼ ê¸°ì¤€ ì´ì „/ë‹¤ìŒ ì ˆê¸° ì°¾ê¸°
            let prevJeolgi = jeolgiDates[0];
            let nextJeolgi = jeolgiDates[1];
            
            for (let i = 0; i < jeolgiDates.length - 1; i++) {
                if (birthDate >= jeolgiDates[i].date && birthDate < jeolgiDates[i + 1].date) {
                    prevJeolgi = jeolgiDates[i];
                    nextJeolgi = jeolgiDates[i + 1];
                    break;
                }
            }
            
            // ìˆœí–‰: ë‹¤ìŒ ì ˆê¸°ê¹Œì§€, ì—­í–‰: ì´ì „ ì ˆê¸°ê¹Œì§€
            let daysDiff;
            if (isForward) {
                daysDiff = Math.ceil((nextJeolgi.date - birthDate) / (1000 * 60 * 60 * 24));
            } else {
                daysDiff = Math.ceil((birthDate - prevJeolgi.date) / (1000 * 60 * 60 * 24));
            }
            
            // 3ì¼ = 1ë…„, ë°˜ì˜¬ë¦¼
            const daeunAge = Math.round(daysDiff / 3);
            
            // ìµœì†Œ 1ì„¸, ìµœëŒ€ 10ì„¸
            return Math.max(1, Math.min(10, daeunAge));
        }
        
        function calculateDaeun(yearGan, monthGan, monthJi, gender, birthDate) {
            const yangGan = ["ç”²", "ä¸™", "æˆŠ", "åºš", "å£¬"];
            const isYangYear = yangGan.includes(yearGan);
            const isForward = (gender === "ë‚¨") ? isYangYear : !isYangYear;
            
            // ì •í™•í•œ ëŒ€ìš´ ì‹œì‘ ë‚˜ì´ ê³„ì‚°
            const startAge = calculateDaeunStartAge(birthDate, isForward);
            
            const daeunList = [];
            let ganIndex = CHEONGAN.indexOf(monthGan);
            let jiIndex = JIJI.indexOf(monthJi);
            
            const currentYear = new Date().getFullYear();
            const birthYear = birthDate.getFullYear();
            const currentAge = currentYear - birthYear + 1;
            
            for (let i = 0; i < 9; i++) {
                if (isForward) {
                    ganIndex = (ganIndex + 1) % 10;
                    jiIndex = (jiIndex + 1) % 12;
                } else {
                    ganIndex = (ganIndex - 1 + 10) % 10;
                    jiIndex = (jiIndex - 1 + 12) % 12;
                }
                
                const ageStart = startAge + (i * 10);
                const ageEnd = ageStart + 9;
                const isCurrent = currentAge >= ageStart && currentAge <= ageEnd;
                
                daeunList.push({
                    age: `${ageStart}-${ageEnd}`,
                    gan: CHEONGAN[ganIndex],
                    ji: JIJI[jiIndex],
                    isCurrent: isCurrent
                });
            }
            
            return { startAge, isForward, list: daeunList };
        }
        
        // ============================================
        // ë©”ì¸ ê³„ì‚°
        // ============================================
        
        function parseTextFormat(text) {
            // í…ìŠ¤íŠ¸ í˜•ì‹ íŒŒì‹±
            const data = {};
            const lines = text.split('\n');
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed || trimmed.startsWith('â”') || trimmed.startsWith('[')) continue;
                
                if (trimmed.includes(':')) {
                    const colonIndex = trimmed.indexOf(':');
                    const key = trimmed.substring(0, colonIndex).trim();
                    const value = trimmed.substring(colonIndex + 1).trim();
                    
                    // í‚¤ ë§¤í•‘
                    if (key === 'ì£¼ë¬¸ì½”ë“œ') data.orderCode = value;
                    else if (key === 'ì´ë¦„') data.name = value;
                    else if (key === 'ì„±ë³„') data.gender = value.replace('ì„±', '');
                    else if (key === 'ì¸ì—°ì„±ë³„') data.partnerGender = value;
                    else if (key === 'íƒœì–´ë‚œ ê³³') {
                        // "ì„œìš¸, KR" í˜•ì‹ íŒŒì‹±
                        console.log('ğŸŒ [íŒŒì‹±] íƒœì–´ë‚œ ê³³ ë°œê²¬:', value);
                        if (value && value !== '-') {
                            const parts = value.split(',').map(s => s.trim());
                            console.log('ğŸŒ [íŒŒì‹±] ë¶„ë¦¬ëœ parts:', parts);
                            if (parts.length >= 2) {
                                data.birthCity = parts[0];
                                data.birthCountry = parts[1];
                                console.log('ğŸŒ [íŒŒì‹±] ì„¤ì •ë¨ - birthCity:', parts[0], ', birthCountry:', parts[1]);
                            } else if (parts.length === 1) {
                                data.birthCity = parts[0];
                                console.log('ğŸŒ [íŒŒì‹±] ì„¤ì •ë¨ - birthCityë§Œ:', parts[0]);
                            }
                        } else {
                            console.log('ğŸŒ [íŒŒì‹±] íƒœì–´ë‚œ ê³³ ê°’ì´ ë¹„ì–´ìˆê±°ë‚˜ -');
                        }
                    }
                    else if (key === 'ìŒ/ì–‘ë ¥') data.calendarType = value === 'ìŒë ¥' ? 'lunar' : 'solar';
                    else if (key === 'íŒ¨í‚¤ì§€') {
                        if (value.includes('ë¼ì´íŠ¸')) data.package = 'light';
                        else if (value.includes('í”„ë¦¬ë¯¸ì—„')) data.package = 'premium';
                        else data.package = 'standard';
                    }
                    else if (key === 'ìƒë…„ì›”ì¼') {
                        // "2000ë…„ 3ì›” 3ì¼" í˜•ì‹ íŒŒì‹±
                        const match = value.match(/(\d+)ë…„\s*(\d+)ì›”\s*(\d+)ì¼/);
                        if (match) {
                            data.birthYear = match[1];
                            data.birthMonth = match[2];
                            data.birthDay = match[3];
                        }
                    }
                    else if (key === 'ì‹œê°„') {
                        // "15ì‹œ 40ë¶„" ë˜ëŠ” "ëª¨ë¦„" í˜•ì‹
                        if (value === 'ëª¨ë¦„' || value === '-') {
                            data.birthHour = 'ëª¨ë¦„';
                        } else {
                            const match = value.match(/(\d+)ì‹œ\s*(\d*)ë¶„?/);
                            if (match) {
                                data.birthHour = match[1];
                                data.birthMinute = match[2] || '0';
                            }
                        }
                    }
                    else if (key === 'ì„ íƒ ìš´ì„¸') {
                        data.fortune_type = value.split(',').map(s => s.trim());
                    }
                    else if (key === 'ì„ íƒ ì§ˆë¬¸') {
                        data.questions = value.split(',').map(s => s.trim());
                    }
                    else if (key === 'í•µì‹¬ ê³ ë¯¼' || key === 'ê°€ì¥ ê³ ë¯¼' || key === 'ê°€ì¥ í° ê³ ë¯¼') {
                        data.main_concern = value;
                    }
                    else if (key === 'ë°˜ë³µë˜ëŠ” íŒ¨í„´' && value !== '-') {
                        data.repeat_pattern = value;
                    }
                    else if ((key === 'ë§ì¶¤ ì§ˆë¬¸' || key === 'ë§ì¶¤ ì§ˆë¬¸ (í”„ë¦¬ë¯¸ì—„)') && value !== '-') {
                        data.custom_question = value;
                    }
                    else if (key === 'ì—°ì•  ìƒíƒœ') data.love_status = value;
                    else if (key === 'ì§ì—… ìƒíƒœ') data.job_status = value;
                }
            }
            
            return data;
        }
        
        function calculateFromJSON() {
            const inputText = document.getElementById('jsonInput').value.trim();
            
            if (!inputText) {
                alert('ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            let data;
            
            // JSONì¸ì§€ í…ìŠ¤íŠ¸ì¸ì§€ íŒë³„
            if (inputText.startsWith('{')) {
                // JSON í˜•ì‹
                try {
                    data = JSON.parse(inputText);
                } catch (e) {
                    alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n' + e.message);
                    return;
                }
            } else {
                // í…ìŠ¤íŠ¸ í˜•ì‹
                data = parseTextFormat(inputText);
                if (!data.birthYear) {
                    alert('ìƒë…„ì›”ì¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\ní…ìŠ¤íŠ¸ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            // ë°ì´í„° ì¶”ì¶œ
            const name = data.name || 'ê³ ê°';
            const gender = data.gender || 'ì—¬';
            const partnerGender = data.partnerGender || '';
            const year = parseInt(data.birthYear || data.year || 1990);
            const month = parseInt(data.birthMonth || data.month || 1);
            const day = parseInt(data.birthDay || data.day || 1);
            const hour = data.birthHour === 'ëª¨ë¦„' ? null : parseInt(data.birthHour || data.hour || 12);
            const minute = parseInt(data.birthMinute || data.minute || 0) || 0;
            const calendarType = data.calendarType || 'solar';
            const packageType = data.package || 'standard';
            const fortuneTypes = data.fortune_type || [];
            const questions = data.questions || [];
            const mainConcern = data.main_concern || data.mainConcern || '';
            const repeatPattern = data.repeat_pattern || data.repeatPattern || '';
            const customQuestion = data.custom_question || data.customQuestion || '';
            const loveStatus = data.love_status || '';
            const jobStatus = data.job_status || '';
            const jasiType = data.jasi_type || data.jasiType || 'split';
            const orderCode = data.orderCode || '';

            // â˜… ì§€ì—­ ì •ë³´ ì¶”ì¶œ (ì§„íƒœì–‘ì‹œìš©)
            console.log('ğŸŒ [ê³„ì‚°] data.birthCity:', data.birthCity);
            console.log('ğŸŒ [ê³„ì‚°] data.birthCountry:', data.birthCountry);
            console.log('ğŸŒ [ê³„ì‚°] data.customLongitude:', data.customLongitude);
            const birthCountry = data.birthCountry || data.country || 'KR';
            const birthCity = data.birthCity || data.city || 'ì„œìš¸';
            const customLongitude = data.customLongitude !== undefined ? data.customLongitude : null;
            const customUtcOffset = data.customUtcOffset !== undefined ? data.customUtcOffset : null;
            console.log('ğŸŒ [ê³„ì‚°] ìµœì¢… birthCity:', birthCity, ', birthCountry:', birthCountry);

            if (calendarType === 'lunar' || calendarType === 'lunar_leap') {
                // ìŒë ¥ â†’ ì–‘ë ¥ ë³€í™˜
                const isLeapMonth = (calendarType === 'lunar_leap');
                const solarDate = lunarToSolar(year, month, day, isLeapMonth);
                if (!solarDate) {
                    alert('âš ï¸ ìŒë ¥ ë³€í™˜ ì‹¤íŒ¨: ì§€ì› ë²”ìœ„(1900~2100ë…„)ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.');
                    return;
                }
                var finalYear = solarDate.year;
                var finalMonth = solarDate.month;
                var finalDay = solarDate.day;
                console.log(`ìŒë ¥ ${year}.${month}.${day} â†’ ì–‘ë ¥ ${finalYear}.${finalMonth}.${finalDay} ë³€í™˜ ì™„ë£Œ`);
            } else {
                var finalYear = year;
                var finalMonth = month;
                var finalDay = day;
            }
            
            const date = new Date(finalYear, finalMonth - 1, finalDay, hour || 12, minute);

            // â˜… ì§„íƒœì–‘ì‹œ ë³€í™˜ ì ìš©
            const locationInfo = getLocationInfo(birthCountry, birthCity, customLongitude, customUtcOffset);
            const solarTimeResult = convertToTrueSolarTime(date, hour, minute, locationInfo);

            // ë³´ì •ëœ ì‹œê°„ ì‚¬ìš©
            let correctedHour = hour;
            let correctedMinute = minute;
            let timeBoundaryWarning = null;

            if (solarTimeResult.applied) {
                correctedHour = solarTimeResult.correctedHour;
                correctedMinute = solarTimeResult.correctedMinute;

                // ì‹œê²½ê³„ ê²€ì‚¬
                timeBoundaryWarning = checkTimeBoundary(correctedHour, correctedMinute);

                console.log(`â° ì§„íƒœì–‘ì‹œ ë³€í™˜: ${hour}:${String(minute).padStart(2, '0')} â†’ ${correctedHour}:${String(correctedMinute).padStart(2, '0')} (${locationInfo.flag} ${locationInfo.city}, ë³´ì • ${solarTimeResult.totalCorrection.toFixed(1)}ë¶„)`);
            }

            // ê³„ì‚° (ë³´ì •ëœ ì‹œê°„ ì‚¬ìš©)
            const yearP = calculateYearPillar(date);
            const monthP = calculateMonthPillar(date, yearP.gan);
            const dayP = calculateDayPillar(date, correctedHour, jasiType);
            const hourP = correctedHour !== null ? calculateHourPillar(correctedHour, dayP.gan) : null;
            
            const pillars = [yearP, monthP, dayP, hourP];
            const ohaeng = calculateOhaeng(pillars.filter(p => p));
            const ohaengNorm = normalizeOhaengTo5(ohaeng); // 5ì  ì •ê·œí™”
            const sipsung = calculateSipsung(dayP.gan, pillars); // filter ì œê±° - ë‚´ë¶€ì—ì„œ null ì²˜ë¦¬
            const daeun = calculateDaeun(yearP.gan, monthP.gan, monthP.ji, gender, date);
            
            // ê° ì£¼ë³„ ì‹­ì„± ìƒì„¸
            const yearSipsung = getPillarSipsung(dayP.gan, yearP);
            const monthSipsung = getPillarSipsung(dayP.gan, monthP);
            const daySipsung = getPillarSipsung(dayP.gan, dayP);
            const hourSipsung = hourP ? getPillarSipsung(dayP.gan, hourP) : null;
            
            // ì„¸ìš´ (ì˜¬í•´)
            const seun = calculateSeun();
            const seunSipsung = getPillarSipsung(dayP.gan, seun);
            
            // ì„¸ìš´ (2026ë…„)
            const seun2026 = calculateSeun(2026);
            const seun2026Sipsung = getPillarSipsung(dayP.gan, seun2026);

            // â˜… í•©ì¶©í˜•íŒŒí•´ ë¶„ì„
            const hapChung = analyzeHapChungHyungPaHae(yearP, monthP, dayP, hourP);

            // í‘œì‹œ
            displayResult({
                name, gender, partnerGender, year, month, day, hour, minute,
                calendarType, finalYear, finalMonth, finalDay,
                packageType, fortuneTypes, questions, mainConcern, repeatPattern, customQuestion,
                loveStatus, jobStatus, jasiType, orderCode,
                yearP, monthP, dayP, hourP, ohaeng, ohaengNorm, sipsung, daeun,
                yearSipsung, monthSipsung, daySipsung, hourSipsung,
                seun, seunSipsung, seun2026, seun2026Sipsung,
                // â˜… ì§„íƒœì–‘ì‹œ ë³´ì • ì •ë³´
                solarTimeResult, locationInfo, correctedHour, correctedMinute, timeBoundaryWarning,
                birthCountry, birthCity,
                // â˜… í•©ì¶©í˜•íŒŒí•´ ë¶„ì„
                hapChung
            });
        }
        
        // ============================================
        // ê²°ê³¼ í‘œì‹œ
        // ============================================
        
        function displayResult(r) {
            document.getElementById('resultArea').classList.add('show');
            
            // ìì‹œ íƒ€ì… í‘œì‹œ (23ì‹œ ë˜ëŠ” 0ì‹œì´ê³  ë¶„ë¦¬ìì‹œì¸ ê²½ìš°ì—ë§Œ)
            const jasiDisplay = (r.hour === 23 || r.hour === 0) && r.jasiType === 'split' ? ' (ë¶„ë¦¬ìì‹œ ì ìš©)' : '';

            // â˜… ì§„íƒœì–‘ì‹œ ë³´ì • ì •ë³´ ìƒì„±
            let solarTimeDisplay = '';
            if (r.solarTimeResult && r.solarTimeResult.applied) {
                const st = r.solarTimeResult;
                const loc = r.locationInfo;
                const correctionSign = st.totalCorrection >= 0 ? '+' : '';
                solarTimeDisplay = `
                    <div class="info-item" style="grid-column: 1 / -1; background: rgba(212, 175, 130, 0.15); border: 1px solid rgba(212, 175, 130, 0.3);">
                        <div class="info-label">â° ì§„íƒœì–‘ì‹œ ë³´ì •</div>
                        <div class="info-value" style="font-size: 13px; line-height: 1.6;">
                            ${loc.flag} ${loc.countryName} ${loc.city} (ê²½ë„ ${loc.lng.toFixed(1)}Â°)<br>
                            ì…ë ¥: ${r.hour}ì‹œ ${r.minute}ë¶„ â†’ <strong style="color: #d4af82;">ì§„íƒœì–‘ì‹œ: ${r.correctedHour}ì‹œ ${r.correctedMinute}ë¶„</strong><br>
                            <span style="font-size: 11px; color: #888;">ê²½ë„ë³´ì • ${st.lngCorrection >= 0 ? '+' : ''}${st.lngCorrection.toFixed(1)}ë¶„ / ê· ì‹œì°¨ ${st.eot >= 0 ? '+' : ''}${st.eot.toFixed(1)}ë¶„ = ì´ ${correctionSign}${st.totalCorrection.toFixed(1)}ë¶„</span>
                            ${r.timeBoundaryWarning && r.timeBoundaryWarning.isNearBoundary ? '<br><span style="color: #e8a87c; font-size: 12px;">âš ï¸ ' + r.timeBoundaryWarning.prevSi + '/' + r.timeBoundaryWarning.nextSi + ' ê²½ê³„ ì£¼ì˜</span>' : ''}
                        </div>
                    </div>
                `;
            }

            // ê³ ê° ì •ë³´
            document.getElementById('customerInfo').innerHTML = `
                <div class="info-item"><div class="info-label">ì´ë¦„</div><div class="info-value">${r.name}</div></div>
                <div class="info-item"><div class="info-label">ì„±ë³„</div><div class="info-value">${r.gender}</div></div>
                <div class="info-item"><div class="info-label">ìƒë…„ì›”ì¼</div><div class="info-value">${r.calendarType === 'lunar' ? 'ìŒë ¥ ' + r.year + '.' + r.month + '.' + r.day + ' â†’ ì–‘ë ¥ ' + r.finalYear + '.' + r.finalMonth + '.' + r.finalDay : r.year + '.' + r.month + '.' + r.day}</div></div>
                <div class="info-item"><div class="info-label">íƒœì–´ë‚œ ì‹œê°„</div><div class="info-value">${r.hour !== null ? r.hour + 'ì‹œ ' + r.minute + 'ë¶„' + jasiDisplay : 'ëª¨ë¦„'}</div></div>
                <div class="info-item"><div class="info-label">íƒœì–´ë‚œ ê³³</div><div class="info-value">${r.birthCity || r.birthCountry ? (r.birthCity || '') + (r.birthCity && r.birthCountry ? ', ' : '') + (r.birthCountry || '') : 'ë¯¸ì…ë ¥'}</div></div>
                <div class="info-item"><div class="info-label">íŒ¨í‚¤ì§€</div><div class="info-value">${r.packageType}</div></div>
                ${solarTimeDisplay}
            `;
            
            // ì¼ê°„
            const ilgan = ILGAN_INFO[r.dayP.gan];
            document.getElementById('ilganChar').textContent = r.dayP.gan;
            document.getElementById('ilganName').textContent = `${ilgan.name} (${ilgan.hanja})`;
            document.getElementById('ilganNature').textContent = ilgan.nature;
            
            // ëª…ì‹ (ì‹­ì„± í¬í•¨)
            const hourPillarHTML = r.hourP ? `
                <div class="pillar-box">
                    <div class="pillar-label">ì‹œì£¼</div>
                    <div class="pillar-hanja"><span class="gan">${r.hourP.gan}</span><span class="ji">${r.hourP.ji}</span></div>
                    <div class="pillar-korean">${r.hourP.ganKr}${r.hourP.jiKr}</div>
                    <div class="pillar-sipsung">${r.hourSipsung.ganSipsung}/${r.hourSipsung.jiSipsung}</div>
                </div>
            ` : `
                <div class="pillar-box" style="opacity: 0.5;">
                    <div class="pillar-label">ì‹œì£¼</div>
                    <div class="pillar-hanja"><span class="gan">?</span><span class="ji">?</span></div>
                    <div class="pillar-korean">ëª¨ë¦„</div>
                </div>
            `;
            
            document.getElementById('pillarsDisplay').innerHTML = `
                ${hourPillarHTML}
                <div class="pillar-box">
                    <div class="pillar-label">ì¼ì£¼</div>
                    <div class="pillar-hanja"><span class="gan">${r.dayP.gan}</span><span class="ji">${r.dayP.ji}</span></div>
                    <div class="pillar-korean">${r.dayP.ganKr}${r.dayP.jiKr}</div>
                    <div class="pillar-sipsung">${r.daySipsung.ganSipsung}/${r.daySipsung.jiSipsung}</div>
                </div>
                <div class="pillar-box">
                    <div class="pillar-label">ì›”ì£¼</div>
                    <div class="pillar-hanja"><span class="gan">${r.monthP.gan}</span><span class="ji">${r.monthP.ji}</span></div>
                    <div class="pillar-korean">${r.monthP.ganKr}${r.monthP.jiKr}</div>
                    <div class="pillar-sipsung">${r.monthSipsung.ganSipsung}/${r.monthSipsung.jiSipsung}</div>
                </div>
                <div class="pillar-box">
                    <div class="pillar-label">ì—°ì£¼</div>
                    <div class="pillar-hanja"><span class="gan">${r.yearP.gan}</span><span class="ji">${r.yearP.ji}</span></div>
                    <div class="pillar-korean">${r.yearP.ganKr}${r.yearP.jiKr}</div>
                    <div class="pillar-sipsung">${r.yearSipsung.ganSipsung}/${r.yearSipsung.jiSipsung}</div>
                </div>
            `;
            
            // ì˜¤í–‰
            const missingOhaeng = Object.entries(r.ohaeng).filter(([k, v]) => v === 0).map(([k]) => k);
            const excessOhaeng = Object.entries(r.ohaengNorm).filter(([k, v]) => v >= 1.5).map(([k]) => k);
            const weakOhaeng = Object.entries(r.ohaengNorm).filter(([k, v]) => v > 0 && v <= 0.5).map(([k]) => k);
            
            const getStatus = (name, count) => {
                if (count === 0) return 'ì—†ìŒ';
                if (count >= 1.5) return 'ê³¼ë‹¤';
                if (count <= 0.5) return 'ë¶€ì¡±';
                return '';
            };
            
            document.getElementById('ohaengDisplay').innerHTML = `
                <div class="ohaeng-item wood">
                    <div class="ohaeng-char">æœ¨</div>
                    <div class="ohaeng-count">${r.ohaeng.ëª©} <small style="color:#888">(${r.ohaengNorm.ëª©})</small></div>
                    <div class="ohaeng-status">${getStatus('ëª©', r.ohaengNorm.ëª©)}</div>
                </div>
                <div class="ohaeng-item fire">
                    <div class="ohaeng-char">ç«</div>
                    <div class="ohaeng-count">${r.ohaeng.í™”} <small style="color:#888">(${r.ohaengNorm.í™”})</small></div>
                    <div class="ohaeng-status">${getStatus('í™”', r.ohaengNorm.í™”)}</div>
                </div>
                <div class="ohaeng-item earth">
                    <div class="ohaeng-char">åœŸ</div>
                    <div class="ohaeng-count">${r.ohaeng.í† } <small style="color:#888">(${r.ohaengNorm.í† })</small></div>
                    <div class="ohaeng-status">${getStatus('í† ', r.ohaengNorm.í† )}</div>
                </div>
                <div class="ohaeng-item metal">
                    <div class="ohaeng-char">é‡‘</div>
                    <div class="ohaeng-count">${r.ohaeng.ê¸ˆ} <small style="color:#888">(${r.ohaengNorm.ê¸ˆ})</small></div>
                    <div class="ohaeng-status">${getStatus('ê¸ˆ', r.ohaengNorm.ê¸ˆ)}</div>
                </div>
                <div class="ohaeng-item water">
                    <div class="ohaeng-char">æ°´</div>
                    <div class="ohaeng-count">${r.ohaeng.ìˆ˜} <small style="color:#888">(${r.ohaengNorm.ìˆ˜})</small></div>
                    <div class="ohaeng-status">${getStatus('ìˆ˜', r.ohaengNorm.ìˆ˜)}</div>
                </div>
            `;
            
            // ì‹­ì„±
            const dominantSipsung = Object.entries(r.sipsung).sort((a, b) => b[1] - a[1])[0][0];
            document.getElementById('sipsungDisplay').innerHTML = Object.entries(r.sipsung).map(([name, count]) => `
                <div class="sipsung-item ${name === dominantSipsung ? 'dominant' : ''}">
                    <div class="sipsung-name">${name}</div>
                    <div class="sipsung-count">${count}</div>
                </div>
            `).join('');
            document.getElementById('dominantSipsung').textContent = dominantSipsung;
            
            // ì§€ì¥ê°„ ë¶„ì„
            const jijangganAnalysis = analyzeJijanggan(r.dayP.gan, [r.yearP, r.monthP, r.dayP, r.hourP]);
            document.getElementById('jijangganDisplay').innerHTML = jijangganAnalysis.map(item => `
                <div class="jijanggan-item">
                    <div class="jijanggan-position">${item.position}</div>
                    <div class="jijanggan-ji">${item.ji}(${item.jiKr})</div>
                    <div class="jijanggan-list">
                        ${item.jijanggan.map(j => `<span class="jjg-tag">${j.gan}(${j.ganKr}) ${j.sipsung}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            
            // ê²©êµ­/ìš©ì‹  ê³„ì‚°
            const gyeokguk = calculateGyeokguk(r.dayP.gan, r.monthP.ji);
            const yongsin = calculateYongsin(r.dayP.gan, r.ohaeng, r.sipsung);
            
            document.getElementById('gyeokgukDisplay').innerHTML = `
                <div class="gyeokguk-item highlight">
                    <div class="gyeokguk-label">ê²©êµ­ (ì¸ìƒì˜ í° í‹€)</div>
                    <div class="gyeokguk-value">${gyeokguk.name}</div>
                    <div class="gyeokguk-desc">${gyeokguk.description}</div>
                </div>
                <div class="gyeokguk-item">
                    <div class="gyeokguk-label">ì¼ê°„ ê°•ì•½</div>
                    <div class="gyeokguk-value">${yongsin.strengthDesc}</div>
                </div>
                <div class="yongsin-row">
                    <div class="gyeokguk-item highlight">
                        <div class="gyeokguk-label">ìš©ì‹  (í•„ìš”í•œ ê¸°ìš´) âœ¨</div>
                        <div class="gyeokguk-value">${yongsin.yongsin}</div>
                        <div class="gyeokguk-desc">${yongsin.yongsinDesc}</div>
                    </div>
                    <div class="gyeokguk-item">
                        <div class="gyeokguk-label">í¬ì‹  (ë„ì›€ë˜ëŠ” ê¸°ìš´) ğŸ‘</div>
                        <div class="gyeokguk-value">${yongsin.huisin}</div>
                        <div class="gyeokguk-desc">${yongsin.huisinDesc}</div>
                    </div>
                </div>
                <div class="yongsin-row">
                    <div class="gyeokguk-item caution">
                        <div class="gyeokguk-label">ê¸°ì‹  (í”¼í•´ì•¼ í•  ê¸°ìš´) âš ï¸</div>
                        <div class="gyeokguk-value">${yongsin.gisin}</div>
                        <div class="gyeokguk-desc">${yongsin.gisinDesc}</div>
                    </div>
                    <div class="gyeokguk-item caution">
                        <div class="gyeokguk-label">êµ¬ì‹  (ë” í”¼í•´ì•¼ í•  ê¸°ìš´) ğŸš«</div>
                        <div class="gyeokguk-value">${yongsin.gusin}</div>
                        <div class="gyeokguk-desc">${yongsin.gusinDesc}</div>
                    </div>
                </div>
            `;

            // ì‚¼ì¬ ê³„ì‚° ë° í‘œì‹œ
            const samjae = calculateSamjae(r.yearP.ji);
            const samjaeSection = document.getElementById('samjaeSection');
            const samjaeDisplay = document.getElementById('samjaeDisplay');

            if (samjae.isSamjae) {
                samjaeSection.style.display = 'block';
                samjaeDisplay.innerHTML = `
                    <div class="gyeokguk-item caution" style="border-left: 4px solid #e74c3c;">
                        <div class="gyeokguk-label">í˜„ì¬ ìƒíƒœ</div>
                        <div class="gyeokguk-value" style="color: #e74c3c; font-size: 1.3em;">${samjae.type}</div>
                        <div class="gyeokguk-desc">${samjae.description}</div>
                    </div>
                    <div class="gyeokguk-item">
                        <div class="gyeokguk-label">ì‚¼ì¬ ê¸°ê°„</div>
                        <div class="gyeokguk-value">${samjae.samjaeYears.join(' â†’ ')}</div>
                        <div class="gyeokguk-desc">í˜„ì¬ ${samjae.currentYear}ë…„ (${samjae.currentYearJi}ë…„)</div>
                    </div>
                `;
            } else {
                samjaeSection.style.display = 'block';
                samjaeDisplay.innerHTML = `
                    <div class="gyeokguk-item highlight" style="border-left: 4px solid #27ae60;">
                        <div class="gyeokguk-label">í˜„ì¬ ìƒíƒœ</div>
                        <div class="gyeokguk-value" style="color: #27ae60;">ì‚¼ì¬ ì•„ë‹˜ âœ“</div>
                        <div class="gyeokguk-desc">í˜„ì¬ ${samjae.currentYear}ë…„ì€ ì‚¼ì¬ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ì ê·¹ì ìœ¼ë¡œ í™œë™í•˜ê¸° ì¢‹ì€ ì‹œê¸°ì…ë‹ˆë‹¤.</div>
                    </div>
                    <div class="gyeokguk-item">
                        <div class="gyeokguk-label">ë‹¤ìŒ ì‚¼ì¬ ê¸°ê°„</div>
                        <div class="gyeokguk-value">${samjae.samjaeYears.join(' â†’ ')}</div>
                        <div class="gyeokguk-desc">ìœ„ ì§€ì§€ì— í•´ë‹¹í•˜ëŠ” ì—°ë„ì— ì‚¼ì¬ê°€ ì˜µë‹ˆë‹¤</div>
                    </div>
                `;
            }

            // ëŒ€ìš´
            document.getElementById('daeunStartAge').textContent = r.daeun.startAge;
            document.getElementById('daeunDirection').textContent = r.daeun.isForward ? 'ìˆœí–‰' : 'ì—­í–‰';
            document.getElementById('daeunDisplay').innerHTML = r.daeun.list.map(d => `
                <div class="daeun-item ${d.isCurrent ? 'current' : ''}">
                    <div class="daeun-age">${d.age}ì„¸</div>
                    <div class="daeun-pillar">${d.gan}${d.ji}</div>
                </div>
            `).join('');
            
            // í˜„ì¬ ëŒ€ìš´ ì‹­ì„±
            const currentDaeun = r.daeun.list.find(d => d.isCurrent);
            const currentDaeunSipsung = currentDaeun ? getPillarSipsung(r.dayP.gan, currentDaeun) : null;
            
            // ì‹ ì‚´ ê³„ì‚°
            const pillars = [r.yearP, r.monthP, r.dayP];
            if (r.hourP) pillars.push(r.hourP);
            const sinsal = calculateSinsal(
                r.dayP.gan,
                r.dayP.ji,
                r.monthP.ji,
                r.yearP.ji,
                r.hourP ? r.hourP.ji : null,
                pillars
            );

            // â˜… í•©ì¶©í˜•íŒŒí•´ HTML ë Œë”ë§
            const hapChung = r.hapChung;
            let hapchungHTML = '';

            if (hapChung) {
                const totalCount = hapChung.cheonganHap.length + hapChung.yukhap.length +
                    hapChung.samhap.length + hapChung.banghap.length + hapChung.chung.length +
                    hapChung.hyung.length + hapChung.pa.length + hapChung.hae.length;

                if (totalCount === 0) {
                    hapchungHTML = '<div class="hapchung-none">ì‚¬ì£¼ ë‚´ í•©ì¶©í˜•íŒŒí•´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    // ìš”ì•½ íƒœê·¸
                    let summaryHTML = '<div class="hapchung-summary">';
                    if (hapChung.cheonganHap.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hap">ğŸ¤ ì²œê°„í•© ${hapChung.cheonganHap.length}</span>`;
                    }
                    if (hapChung.yukhap.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hap">ğŸ’‘ ìœ¡í•© ${hapChung.yukhap.length}</span>`;
                    }
                    if (hapChung.samhap.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hap">ğŸ”º ì‚¼í•© ${hapChung.samhap.length}</span>`;
                    }
                    if (hapChung.banghap.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hap">ğŸ“ ë°©í•© ${hapChung.banghap.length}</span>`;
                    }
                    if (hapChung.chung.length > 0) {
                        summaryHTML += `<span class="hapchung-tag chung">âš”ï¸ ì¶© ${hapChung.chung.length}</span>`;
                    }
                    if (hapChung.hyung.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hyung">âš¡ í˜• ${hapChung.hyung.length}</span>`;
                    }
                    if (hapChung.pa.length > 0) {
                        summaryHTML += `<span class="hapchung-tag pa">ğŸ’” íŒŒ ${hapChung.pa.length}</span>`;
                    }
                    if (hapChung.hae.length > 0) {
                        summaryHTML += `<span class="hapchung-tag hae">ğŸ—¡ï¸ í•´ ${hapChung.hae.length}</span>`;
                    }
                    summaryHTML += '</div>';

                    // ìƒì„¸ ë‚´ì—­
                    let detailHTML = '<div class="hapchung-detail">';

                    // í•© ê³„ì—´ (ì²œê°„í•©, ìœ¡í•©, ì‚¼í•©, ë°©í•©)
                    if (hapChung.cheonganHap.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hap">ğŸ¤ ì²œê°„í•© (å¤©å¹²åˆ)</div>';
                        hapChung.cheonganHap.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }
                    if (hapChung.yukhap.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hap">ğŸ’‘ ì§€ì§€ìœ¡í•© (åœ°æ”¯å…­åˆ)</div>';
                        hapChung.yukhap.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }
                    if (hapChung.samhap.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hap">ğŸ”º ì§€ì§€ì‚¼í•© (åœ°æ”¯ä¸‰åˆ)</div>';
                        hapChung.samhap.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }
                    if (hapChung.banghap.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hap">ğŸ“ ì§€ì§€ë°©í•© (åœ°æ”¯æ–¹åˆ)</div>';
                        hapChung.banghap.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }

                    // ì¶©
                    if (hapChung.chung.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title chung">âš”ï¸ ì§€ì§€ì¶© (åœ°æ”¯æ²–)</div>';
                        hapChung.chung.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }

                    // í˜•
                    if (hapChung.hyung.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hyung">âš¡ ì§€ì§€í˜• (åœ°æ”¯åˆ‘)</div>';
                        hapChung.hyung.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }

                    // íŒŒ
                    if (hapChung.pa.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title pa">ğŸ’” ì§€ì§€íŒŒ (åœ°æ”¯ç ´)</div>';
                        hapChung.pa.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }

                    // í•´
                    if (hapChung.hae.length > 0) {
                        detailHTML += '<div class="hapchung-category"><div class="hapchung-category-title hae">ğŸ—¡ï¸ ì§€ì§€í•´ (åœ°æ”¯å®³)</div>';
                        hapChung.hae.forEach(item => {
                            detailHTML += `<div class="hapchung-item">${item.display}</div>`;
                        });
                        detailHTML += '</div>';
                    }

                    detailHTML += '</div>';
                    hapchungHTML = summaryHTML + detailHTML;
                }
            } else {
                hapchungHTML = '<div class="hapchung-none">í•©ì¶©í˜•íŒŒí•´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
            document.getElementById('hapchungDisplay').innerHTML = hapchungHTML;

            // Birth Chart (ì„œì–‘ ì ì„±ìˆ ) ê³„ì‚° ë° í‘œì‹œ
            let birthChartData = null;
            try {
                const lat = r.locationInfo?.lat || 37.57; // ê¸°ë³¸ê°’: ì„œìš¸
                const lng = r.locationInfo?.lng || 127.00;
                birthChartData = calculateBirthChart(
                    new Date(r.finalYear, r.finalMonth - 1, r.finalDay),
                    r.correctedHour || r.hour || 12,
                    r.correctedMinute || r.minute || 0,
                    lat,
                    lng
                );
                if (birthChartData) {
                    displayBirthChart(birthChartData);
                }
            } catch (e) {
                console.log('Birth Chart ê³„ì‚° ìƒëµ:', e);
            }

            // ì–‘/ìŒ ê¸°ìš´ ê³„ì‚°
            const yangGanList = ["ç”²", "ä¸™", "æˆŠ", "åºš", "å£¬"];
            const yangJiList = ["å­", "å¯…", "è¾°", "åˆ", "ç”³", "æˆŒ"];

            // ì‚¬ì£¼íŒ”ìì—ì„œ ì–‘/ìŒ ì„¸ê¸°
            const allGan = [r.yearP.gan, r.monthP.gan, r.dayP.gan];
            const allJi = [r.yearP.ji, r.monthP.ji, r.dayP.ji];
            if (r.hourP) {
                allGan.push(r.hourP.gan);
                allJi.push(r.hourP.ji);
            }

            const yangGanCount = allGan.filter(g => yangGanList.includes(g)).length;
            const yinGanCount = allGan.length - yangGanCount;
            const yangJiCount = allJi.filter(j => yangJiList.includes(j)).length;
            const yinJiCount = allJi.length - yangJiCount;

            const totalYang = yangGanCount + yangJiCount;
            const totalYin = yinGanCount + yinJiCount;
            const totalCount = totalYang + totalYin;

            // ì–‘/ìŒ íŠ¹ì„± íŒë‹¨
            let yinYangChar = '';
            if (totalYang > totalYin + 2) yinYangChar = 'ì–‘ ê¸°ìš´ ê³¼ë‹¤ (ì™¸í–¥ì , ì ê·¹ì , í™œë™ì )';
            else if (totalYin > totalYang + 2) yinYangChar = 'ìŒ ê¸°ìš´ ê³¼ë‹¤ (ë‚´í–¥ì , ì‹ ì¤‘í•¨, ì•ˆì • ì¶”êµ¬)';
            else if (totalYang > totalYin) yinYangChar = 'ì–‘ ê¸°ìš´ ìš°ì„¸ (í™œë°œí•˜ê³  ì¶”ì§„ë ¥ ìˆìŒ)';
            else if (totalYin > totalYang) yinYangChar = 'ìŒ ê¸°ìš´ ìš°ì„¸ (ì°¨ë¶„í•˜ê³  ê¹Šì´ ìˆìŒ)';
            else yinYangChar = 'ìŒì–‘ ê· í˜• (ì¡°í™”ë¡œìš´ ì—ë„ˆì§€)';

            // ê²°ê³¼ í…ìŠ¤íŠ¸ (í•´ì„ìš© ìƒì„¸ ì •ë³´ í¬í•¨)
            // íƒœì–´ë‚œ ì§€ì—­ í‘œì‹œ (ì‹œê°„ ëª¨ë¦„ì´ì–´ë„ locationInfo ì‚¬ìš©)
            let solarTimeText = `- íƒœì–´ë‚œ ì§€ì—­: ${r.locationInfo.flag} ${r.locationInfo.countryName} ${r.locationInfo.city}`;
            if (r.solarTimeResult && r.solarTimeResult.applied) {
                solarTimeText += ` (ê²½ë„ ${r.locationInfo.lng.toFixed(1)}Â°)
- ì§„íƒœì–‘ì‹œ ë³´ì •: ${r.hour}ì‹œ ${r.minute}ë¶„ â†’ ${r.correctedHour}ì‹œ ${r.correctedMinute}ë¶„ (ê²½ë„ë³´ì • ${r.solarTimeResult.lngCorrection >= 0 ? '+' : ''}${r.solarTimeResult.lngCorrection.toFixed(1)}ë¶„, ê· ì‹œì°¨ ${r.solarTimeResult.eot >= 0 ? '+' : ''}${r.solarTimeResult.eot.toFixed(1)}ë¶„)${r.timeBoundaryWarning && r.timeBoundaryWarning.isNearBoundary ? '\n- âš ï¸ ì‹œê²½ê³„ ì£¼ì˜: ' + r.timeBoundaryWarning.prevSi + '/' + r.timeBoundaryWarning.nextSi + ' ê²½ê³„' : ''}`;
            }

            const resultText = `## ì‚¬ì£¼ ê³„ì‚° ê²°ê³¼

### ê¸°ë³¸ ì •ë³´
- ì£¼ë¬¸ì½”ë“œ: ${r.orderCode || '-'}
- ì´ë¦„: ${r.name}
- ì„±ë³„: ${r.gender === 'ë‚¨' ? 'ë‚¨ì' : r.gender === 'ì—¬' ? 'ì—¬ì' : r.gender}
- ì¸ì—°ì„±ë³„: ${r.partnerGender || '-'}
- ìƒë…„ì›”ì¼: ${r.calendarType === 'lunar' ? 'ìŒë ¥ ' + r.year + 'ë…„ ' + r.month + 'ì›” ' + r.day + 'ì¼ (ì–‘ë ¥ ' + r.finalYear + '.' + r.finalMonth + '.' + r.finalDay + ')' : r.year + 'ë…„ ' + r.month + 'ì›” ' + r.day + 'ì¼'}
- íƒœì–´ë‚œ ì‹œê°„: ${r.hour !== null ? r.hour + 'ì‹œ ' + r.minute + 'ë¶„' + ((r.hour === 23 || r.hour === 0) && r.jasiType === 'split' ? ' (ë¶„ë¦¬ìì‹œ ì ìš©)' : '') : 'ëª¨ë¦„'}
${solarTimeText}
- íŒ¨í‚¤ì§€: ${r.packageType}

### ì‚¬ì£¼ ëª…ì‹ (å››æŸ±å…«å­—)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‹œì£¼  â”‚  ì¼ì£¼  â”‚  ì›”ì£¼  â”‚  ì—°ì£¼  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ${r.hourP ? r.hourP.gan.padEnd(4) : '  ? '} â”‚ ${r.dayP.gan.padEnd(4)} â”‚ ${r.monthP.gan.padEnd(4)} â”‚ ${r.yearP.gan.padEnd(4)} â”‚
â”‚ ${r.hourP ? r.hourP.ji.padEnd(4) : '  ? '} â”‚ ${r.dayP.ji.padEnd(4)} â”‚ ${r.monthP.ji.padEnd(4)} â”‚ ${r.yearP.ji.padEnd(4)} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### ê° ì£¼ë³„ ì‹­ì„± (ì¼ê°„ ${r.dayP.gan} ê¸°ì¤€)
- ì—°ì£¼: ${r.yearP.gan}${r.yearP.ji} â†’ ì²œê°„(${r.yearSipsung.ganSipsung}) / ì§€ì§€(${r.yearSipsung.jiSipsung})
- ì›”ì£¼: ${r.monthP.gan}${r.monthP.ji} â†’ ì²œê°„(${r.monthSipsung.ganSipsung}) / ì§€ì§€(${r.monthSipsung.jiSipsung})
- ì¼ì£¼: ${r.dayP.gan}${r.dayP.ji} â†’ ì²œê°„(${r.daySipsung.ganSipsung}) / ì§€ì§€(${r.daySipsung.jiSipsung})
- ì‹œì£¼: ${r.hourP ? r.hourP.gan + r.hourP.ji + ' â†’ ì²œê°„(' + r.hourSipsung.ganSipsung + ') / ì§€ì§€(' + r.hourSipsung.jiSipsung + ')' : 'ëª¨ë¦„'}

### ì¼ê°„ (æ—¥å¹²) - ë³¸ì¸ì˜ ë³¸ì§ˆ
- ${r.dayP.gan} (${ilgan.name}) - ${ilgan.nature}

### ì˜¤í–‰ ë¶„í¬ (ì›ì ìˆ˜ / 5ì  í™˜ì‚°)
- ëª©(æœ¨): ${r.ohaeng.ëª©}ê°œ (${r.ohaengNorm.ëª©}ì )
- í™”(ç«): ${r.ohaeng.í™”}ê°œ (${r.ohaengNorm.í™”}ì )
- í† (åœŸ): ${r.ohaeng.í† }ê°œ (${r.ohaengNorm.í† }ì )
- ê¸ˆ(é‡‘): ${r.ohaeng.ê¸ˆ}ê°œ (${r.ohaengNorm.ê¸ˆ}ì )
- ìˆ˜(æ°´): ${r.ohaeng.ìˆ˜}ê°œ (${r.ohaengNorm.ìˆ˜}ì )
${missingOhaeng.length > 0 ? '- âš ï¸ ì—†ëŠ” ì˜¤í–‰: ' + missingOhaeng.join(', ') : ''}
${weakOhaeng.length > 0 ? '- ğŸ“‰ ë¶€ì¡± ì˜¤í–‰: ' + weakOhaeng.join(', ') : ''}
${excessOhaeng.length > 0 ? '- ğŸ“ˆ ê³¼ë‹¤ ì˜¤í–‰: ' + excessOhaeng.join(', ') : ''}

### ì–‘/ìŒ ë¶„í¬ (é™½é™° ë°¸ëŸ°ìŠ¤)
- ì–‘(é™½) ê¸°ìš´: ${totalYang}ê°œ (ì²œê°„ ${yangGanCount}ê°œ + ì§€ì§€ ${yangJiCount}ê°œ)
- ìŒ(é™°) ê¸°ìš´: ${totalYin}ê°œ (ì²œê°„ ${yinGanCount}ê°œ + ì§€ì§€ ${yinJiCount}ê°œ)
- ë¹„ìœ¨: ì–‘ ${totalYang} : ìŒ ${totalYin}
- ì—ë„ˆì§€ íŠ¹ì„±: ${yinYangChar}

### ì‹­ì„± ë¶„í¬ (ê·¸ë£¹ë³„)
- ë¹„ê²: ${r.sipsung.ë¹„ê²} (ë‚˜ì™€ ê°™ì€ ê¸°ìš´ - í˜•ì œ, ë™ë£Œ, ê²½ìŸì)
- ì‹ìƒ: ${r.sipsung.ì‹ìƒ} (ë‚´ê°€ ìƒí•˜ëŠ” ê¸°ìš´ - í‘œí˜„ë ¥, ì¬ëŠ¥, ìë…€)
- ì¬ì„±: ${r.sipsung.ì¬ì„±} (ë‚´ê°€ ê·¹í•˜ëŠ” ê¸°ìš´ - ì¬ë¬¼, ì•„ë²„ì§€, ì—¬ìì—ê²Œ ë‚¨í¸)
- ê´€ì„±: ${r.sipsung.ê´€ì„±} (ë‚˜ë¥¼ ê·¹í•˜ëŠ” ê¸°ìš´ - ì§ì¥, ëª…ì˜ˆ, ë‚¨ìì—ê²Œ ìë…€)
- ì¸ì„±: ${r.sipsung.ì¸ì„±} (ë‚˜ë¥¼ ìƒí•˜ëŠ” ê¸°ìš´ - í•™ë¬¸, ì–´ë¨¸ë‹ˆ, ë„ì›€)
- ğŸ“Œ ê°€ì¥ ê°•í•œ ì‹­ì„±: ${dominantSipsung}

### ì§€ì¥ê°„ ë¶„ì„ (ìˆ¨ê²¨ì§„ ë‚´ë©´)
${jijangganAnalysis.map(item => '- ' + item.position + ' ' + item.ji + '(' + item.jiKr + '): ' + item.jijanggan.map(j => j.gan + '(' + j.sipsung + ')').join(', ')).join('\n')}

### ê²©êµ­ & ìš©ì‹ 
- ê²©êµ­: ${gyeokguk.name}
- ê²©êµ­ ì„¤ëª…: ${gyeokguk.description}
- ì¼ê°„ ê°•ì•½: ${yongsin.strengthDesc}
- ìš©ì‹ : ${yongsin.yongsin} - ${yongsin.yongsinDesc}
- í¬ì‹ : ${yongsin.huisin} - ${yongsin.huisinDesc}
- ê¸°ì‹ : ${yongsin.gisin} - ${yongsin.gisinDesc}
- êµ¬ì‹ : ${yongsin.gusin} - ${yongsin.gusinDesc}

### ëŒ€ìš´ (10ë…„ ì£¼ê¸°)
- ëŒ€ìš´ ì‹œì‘: ${r.daeun.startAge}ì„¸
- ëŒ€ìš´ ë°©í–¥: ${r.daeun.isForward ? 'ìˆœí–‰ â†—' : 'ì—­í–‰ â†™'}
${r.daeun.list.map(d => '- ' + d.age + 'ì„¸: ' + d.gan + d.ji + ' (' + getPillarSipsung(r.dayP.gan, d).ganSipsung + '/' + getPillarSipsung(r.dayP.gan, d).jiSipsung + ')' + (d.isCurrent ? ' â† í˜„ì¬' : '')).join('\n')}

### ì„¸ìš´ (ì˜¬í•´ ${r.seun.year}ë…„)
- ${r.seun.gan}${r.seun.ji} (${r.seun.ganKr}${r.seun.jiKr}ë…„)
- ì„¸ìš´ ì‹­ì„±: ì²œê°„(${r.seunSipsung.ganSipsung}) / ì§€ì§€(${r.seunSipsung.jiSipsung})
- ì˜¬í•´ í‚¤ì›Œë“œ: ${r.seunSipsung.ganSipsung}ì˜ ì—ë„ˆì§€ê°€ ë“¤ì–´ì˜¤ëŠ” í•´

### ì„¸ìš´ (2026ë…„)
- ${r.seun2026.gan}${r.seun2026.ji} (${r.seun2026.ganKr}${r.seun2026.jiKr}ë…„)
- ì„¸ìš´ ì‹­ì„±: ì²œê°„(${r.seun2026Sipsung.ganSipsung}) / ì§€ì§€(${r.seun2026Sipsung.jiSipsung})
- 2026ë…„ í‚¤ì›Œë“œ: ${r.seun2026Sipsung.ganSipsung}ì˜ ì—ë„ˆì§€ê°€ ë“¤ì–´ì˜¤ëŠ” í•´

### ì‹ ì‚´ ë¶„ì„ (ç¥æ®º)
ğŸŒŸ ê¸¸ì‹  (ì¢‹ì€ ê¸°ìš´): ${sinsal.ê¸¸ì‹ .length > 0 ? sinsal.ê¸¸ì‹ .map(s => s.name).join(', ') : 'ì—†ìŒ'}
âš¡ ì–‘ë©´ì‹  (ì–‘ë©´ì˜ ê¸°ìš´): ${sinsal.ì–‘ë©´ì‹ .length > 0 ? sinsal.ì–‘ë©´ì‹ .map(s => s.name).join(', ') : 'ì—†ìŒ'}
${sinsal.ê¸¸ì‹ .map(s => '- ' + s.name + ': ' + s.description + ' [' + s.foundIn + ']').join('\n')}
${sinsal.ì–‘ë©´ì‹ .map(s => '- ' + s.name + ': ' + s.description + ' [' + s.foundIn + ']').join('\n')}

### ê·€ì¸/í”¼í•´ì•¼ í•  ë 
${(() => {
    // ì§€ì§€ â†’ ë  ë§¤í•‘
    const JIJI_TO_DDI = {
        "å­": "ì¥ë  ğŸ­", "ä¸‘": "ì†Œë  ğŸ®", "å¯…": "í˜¸ë‘ì´ë  ğŸ¯", "å¯": "í† ë¼ë  ğŸ°",
        "è¾°": "ìš©ë  ğŸ²", "å·³": "ë±€ë  ğŸ", "åˆ": "ë§ë  ğŸ´", "æœª": "ì–‘ë  ğŸ‘",
        "ç”³": "ì›ìˆ­ì´ë  ğŸµ", "é…‰": "ë‹­ë  ğŸ”", "æˆŒ": "ê°œë  ğŸ¶", "äº¥": "ë¼ì§€ë  ğŸ·"
    };
    // ì²œì„ê·€ì¸ ê¸°ì¤€ (ì¼ê°„ â†’ ê·€ì¸ ì§€ì§€)
    const CHEONUL_GUIN = {
        "ç”²": ["ä¸‘", "æœª"], "æˆŠ": ["ä¸‘", "æœª"], "åºš": ["ä¸‘", "æœª"],
        "ä¹™": ["å­", "ç”³"], "å·±": ["å­", "ç”³"],
        "ä¸™": ["äº¥", "é…‰"], "ä¸": ["äº¥", "é…‰"],
        "å£¬": ["å¯", "å·³"], "ç™¸": ["å¯", "å·³"],
        "è¾›": ["å¯…", "åˆ"]
    };
    // ì›ì§„ì‚´ ë§¤í•‘ (ì¼ì§€ â†’ í”¼í•´ì•¼í•  ì§€ì§€)
    const WONJIN_MAP = {
        "å­": "æœª", "æœª": "å­",
        "ä¸‘": "åˆ", "åˆ": "ä¸‘",
        "å¯…": "é…‰", "é…‰": "å¯…",
        "å¯": "ç”³", "ç”³": "å¯",
        "è¾°": "äº¥", "äº¥": "è¾°",
        "å·³": "æˆŒ", "æˆŒ": "å·³"
    };

    const guininJiji = CHEONUL_GUIN[r.dayP.gan] || [];
    const guininDdi = guininJiji.map(j => JIJI_TO_DDI[j]).join(', ');
    const wonjinJiji = WONJIN_MAP[r.dayP.ji];
    const avoidDdi = wonjinJiji ? JIJI_TO_DDI[wonjinJiji] : '';

    return `- ğŸŒŸ ê·€ì¸ ë  (ì²œì„ê·€ì¸): ${guininDdi || 'ì •ë³´ ì—†ìŒ'} â† ì¼ê°„ ${r.dayP.gan} ê¸°ì¤€
- âš ï¸ í”¼í•´ì•¼ í•  ë  (ì›ì§„ì‚´): ${avoidDdi || 'ì •ë³´ ì—†ìŒ'} â† ì¼ì§€ ${r.dayP.ji} ê¸°ì¤€`;
})()}

### í•©ì¶©í˜•íŒŒí•´ (åˆæ²–åˆ‘ç ´å®³)
${hapChung ? (() => {
    const sections = [];
    if (hapChung.cheonganHap.length > 0) sections.push('ğŸ¤ ì²œê°„í•©: ' + hapChung.cheonganHap.map(h => h.display).join(', '));
    if (hapChung.yukhap.length > 0) sections.push('ğŸ’‘ ìœ¡í•©: ' + hapChung.yukhap.map(h => h.display).join(', '));
    if (hapChung.samhap.length > 0) sections.push('ğŸ”º ì‚¼í•©: ' + hapChung.samhap.map(h => h.display).join(', '));
    if (hapChung.banghap.length > 0) sections.push('ğŸ“ ë°©í•©: ' + hapChung.banghap.map(h => h.display).join(', '));
    if (hapChung.chung.length > 0) sections.push('âš”ï¸ ì¶©: ' + hapChung.chung.map(h => h.display).join(', '));
    if (hapChung.hyung.length > 0) sections.push('âš¡ í˜•: ' + hapChung.hyung.map(h => h.display).join(', '));
    if (hapChung.pa.length > 0) sections.push('ğŸ’” íŒŒ: ' + hapChung.pa.map(h => h.display).join(', '));
    if (hapChung.hae.length > 0) sections.push('ğŸ—¡ï¸ í•´: ' + hapChung.hae.map(h => h.display).join(', '));
    return sections.length > 0 ? sections.join('\n') : 'ì‚¬ì£¼ ë‚´ í•©ì¶©í˜•íŒŒí•´ ì—†ìŒ';
})() : 'ì •ë³´ ì—†ìŒ'}

### ì§ˆë¬¸ì§€ ì‘ë‹µ
${r.fortuneTypes.length > 0 ? '- ì„ íƒí•œ ìš´ì„¸: ' + r.fortuneTypes.join(', ') : ''}
${r.loveStatus ? '- ğŸ’• ì—°ì•  ìƒíƒœ: ' + r.loveStatus : ''}
${r.jobStatus ? '- ğŸ’¼ ì§ì—… ìƒíƒœ: ' + r.jobStatus : ''}
${r.mainConcern ? '- ğŸ’­ ê°€ì¥ í° ê³ ë¯¼: ' + r.mainConcern : ''}
${r.repeatPattern ? '- ğŸ”„ ë°˜ë³µë˜ëŠ” íŒ¨í„´: ' + r.repeatPattern : ''}
${r.questions.length > 0 ? r.questions.map((q, i) => '- Q' + (i+1) + ': ' + q).join('\n') : ''}
${r.customQuestion ? '- âœ¨ ë§ì¶¤ ì§ˆë¬¸ (í”„ë¦¬ë¯¸ì—„): ' + r.customQuestion : ''}

### Birth Chart (ì„œì–‘ ì ì„±ìˆ )
${birthChartData ? (() => {
    const lines = [];
    // í–‰ì„± ìœ„ì¹˜
    lines.push('ğŸŒŸ í–‰ì„± ìœ„ì¹˜:');
    birthChartData.planets.forEach(p => {
        lines.push(`- ${p.emoji} ${p.kr}: ${p.sign.symbol} ${p.sign.name} ${p.degree}Â°`);
    });
    // í•˜ìš°ìŠ¤
    if (birthChartData.houses.length > 0) {
        lines.push('\nğŸ  í•˜ìš°ìŠ¤ (Whole Sign):');
        birthChartData.houses.forEach(h => {
            lines.push(`- ${h.house}í•˜ìš°ìŠ¤: ${h.sign.symbol} ${h.sign.name}`);
        });
    }
    // ì• ìŠ¤í™íŠ¸
    if (birthChartData.aspects.length > 0) {
        lines.push('\nâœ¨ ì£¼ìš” ì• ìŠ¤í™íŠ¸:');
        birthChartData.aspects.slice(0, 10).forEach(a => {
            lines.push(`- ${a.planet1.kr} ${a.aspect.symbol} ${a.planet2.kr} (${a.aspect.name})`);
        });
    }
    return lines.join('\n');
})() : '(ê³„ì‚° ë¶ˆê°€)'}
`;
            
            document.getElementById('resultText').textContent = resultText;
            
            // â˜… í”„ë¡¬í”„íŠ¸ ìƒì„±ìš© êµ¬ì¡°í™”ëœ ë°ì´í„° ì €ì¥
            const sortedSipsung = Object.entries(r.sipsung).sort((a, b) => b[1] - a[1]);
            const secondSipsung = sortedSipsung.length > 1 ? sortedSipsung[1][0] : '';
            window.lastSajuData = {
                resultText: resultText,
                promptData: {
                    name: r.name,
                    gender: r.gender === 'ë‚¨' || r.gender === 'male' ? 'ë‚¨ì' : 'ì—¬ì',
                    birthDate: r.finalYear + 'ë…„ ' + r.finalMonth + 'ì›” ' + r.finalDay + 'ì¼',
                    birthTime: r.hour !== null ? r.hour + 'ì‹œ ' + r.minute + 'ë¶„' : 'ëª¨ë¦„',
                    packageType: r.packageType === 'premium' ? 'í”„ë¦¬ë¯¸ì—„' : r.packageType === 'light' ? 'ë¼ì´íŠ¸' : 'ìŠ¤íƒ ë‹¤ë“œ',
                    age: new Date().getFullYear() - r.finalYear + 1,
                    yearPillar: r.yearP.gan + r.yearP.ji,
                    monthPillar: r.monthP.gan + r.monthP.ji,
                    dayPillar: r.dayP.gan + r.dayP.ji,
                    hourPillar: r.hourP ? r.hourP.gan + r.hourP.ji : 'ëª¨ë¦„',
                    yearSipsung: r.yearSipsung.ganSipsung + '/' + r.yearSipsung.jiSipsung,
                    monthSipsung: r.monthSipsung.ganSipsung + '/' + r.monthSipsung.jiSipsung,
                    daySipsung: r.daySipsung.ganSipsung + '/' + r.daySipsung.jiSipsung,
                    hourSipsung: r.hourSipsung ? r.hourSipsung.ganSipsung + '/' + r.hourSipsung.jiSipsung : '',
                    ilgan: r.dayP.gan,
                    ilganName: ilgan.name,
                    dominantSipsung: dominantSipsung,
                    secondSipsung: secondSipsung,
                    bigyeop: r.sipsung.ë¹„ê²,
                    siksang: r.sipsung.ì‹ìƒ,
                    jaeseong: r.sipsung.ì¬ì„±,
                    gwanseong: r.sipsung.ê´€ì„±,
                    inseong: r.sipsung.ì¸ì„±,
                    wood: r.ohaeng.ëª©,
                    fire: r.ohaeng.í™”,
                    earth: r.ohaeng.í† ,
                    metal: r.ohaeng.ê¸ˆ,
                    water: r.ohaeng.ìˆ˜,
                    woodNorm: r.ohaengNorm.ëª©,
                    fireNorm: r.ohaengNorm.í™”,
                    earthNorm: r.ohaengNorm.í† ,
                    metalNorm: r.ohaengNorm.ê¸ˆ,
                    waterNorm: r.ohaengNorm.ìˆ˜,
                    jijangganText: jijangganAnalysis.map(item => item.position + ' ' + item.ji + '(' + item.jiKr + '): ' + item.jijanggan.map(j => j.gan + '(' + j.sipsung + ')').join(', ')).join('\n'),
                    gyeokgukName: gyeokguk.name,
                    gyeokgukDesc: gyeokguk.description,
                    dayganStrength: yongsin.isStrong ? 'ì‹ ê°•' : 'ì‹ ì•½',
                    dayganStrengthDesc: yongsin.strengthDesc,
                    yongsin: yongsin.yongsin,
                    yongsinDesc: yongsin.yongsinDesc,
                    huisin: yongsin.huisin,
                    huisinDesc: yongsin.huisinDesc,
                    gisin: yongsin.gisin,
                    gisinDesc: yongsin.gisinDesc,
                    gusin: yongsin.gusin,
                    gusinDesc: yongsin.gusinDesc,
                    daeunStartAge: r.daeun.startAge,
                    daeunDirection: r.daeun.isForward ? 'ìˆœí–‰' : 'ì—­í–‰',
                    currentDaeun: currentDaeun ? currentDaeun.gan + currentDaeun.ji : '',
                    currentDaeunAge: currentDaeun ? currentDaeun.age : '',
                    daeunSipsung: currentDaeunSipsung ? currentDaeunSipsung.ganSipsung + '/' + currentDaeunSipsung.jiSipsung : '',
                    daeunList: r.daeun.list.map(d => ({
                        age: d.age,
                        ganJi: d.gan + d.ji,
                        isCurrent: d.isCurrent
                    })),
                    seunYear: r.seun.year,
                    seunGanJi: r.seun.gan + r.seun.ji,
                    seunSipsung: r.seunSipsung.ganSipsung + '/' + r.seunSipsung.jiSipsung,
                    // â˜… ì›”ìš´ ë°ì´í„° (ìë™ ê³„ì‚°)
                    monthlyFortune: calculateMonthlyFortune(
                        r.seun.year,
                        r.dayP.gan,
                        yongsin.yongsinOhaeng,
                        yongsin.huisinOhaeng,
                        yongsin.gisinOhaeng,
                        yongsin.gusinOhaeng
                    ),
                    fortuneTypes: r.fortuneTypes,
                    mainConcern: r.mainConcern,
                    repeatPattern: r.repeatPattern,
                    questions: r.questions,
                    customQuestion: r.customQuestion,
                    loveStatus: r.loveStatus,
                    jobStatus: r.jobStatus,
                    orderCode: r.orderCode,
                    // í•©ì¶©í˜•íŒŒí•´ ë°ì´í„°
                    hapChung: hapChung ? {
                        cheonganHap: hapChung.cheonganHap.map(h => h.display),
                        yukhap: hapChung.yukhap.map(h => h.display),
                        samhap: hapChung.samhap.map(h => h.display),
                        banghap: hapChung.banghap.map(h => h.display),
                        chung: hapChung.chung.map(h => h.display),
                        hyung: hapChung.hyung.map(h => h.display),
                        pa: hapChung.pa.map(h => h.display),
                        hae: hapChung.hae.map(h => h.display),
                        summary: hapChung.summary
                    } : null
                }
            };

            // ìŠ¤í¬ë¡¤
            document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
            
            // â˜… ìë™ ì €ì¥ (ì£¼ë¬¸ì½”ë“œê°€ ìˆì„ ë•Œë§Œ)
            if (r.orderCode && r.orderCode !== '-') {
                saveToGoogleSheets(r.orderCode, resultText);
            }
        }
        
        // ========== Google Sheets ì €ì¥ ==========
        const SAJU_CONFIG = {
            webAppUrl: "https://script.google.com/macros/s/AKfycbzlnTB3d3tO_qvRNKgiLkGgy3EmH_92eYslv4mODGzV7QCiVHYTDLEl4duNlp3PO_kclA/exec"
        };
        
        function saveToGoogleSheets(orderCode, resultText) {
            // hidden iframe + form ë°©ì‹ (CORS ìš°íšŒ + POSTë¡œ ê¸´ ë°ì´í„° ì „ì†¡)
            const iframeName = 'sajuSaveFrame_' + Date.now();
            const iframe = document.createElement('iframe');
            iframe.name = iframeName;
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = SAJU_CONFIG.webAppUrl;
            form.target = iframeName;
            form.style.display = 'none';
            
            // íŒŒë¼ë¯¸í„° ì¶”ê°€
            const params = {
                action: 'updateSajuResult',
                orderCode: orderCode,
                sajuResult: resultText
            };
            
            for (const key in params) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = params[key];
                form.appendChild(input);
            }
            
            document.body.appendChild(form);
            form.submit();
            
            console.log('âœ… ì‚¬ì£¼ê³„ì‚° ê²°ê³¼ ì €ì¥ ìš”ì²­ ì™„ë£Œ:', orderCode);
            
            // ì •ë¦¬ (3ì´ˆ í›„)
            setTimeout(() => {
                if (form.parentNode) form.parentNode.removeChild(form);
                if (iframe.parentNode) iframe.parentNode.removeChild(iframe);
            }, 3000);
        }
        
        function copyResult() {
            const text = document.getElementById('resultText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showToast();
            });
        }
        
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        function openPromptGenerator() {
            window.open('5_í”„ë¡¬í”„íŠ¸ìƒì„±ê¸°.html', '_blank');
        }
        
        // ========== iframe í†µì‹ ìš© (ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ í˜¸ì¶œ) ==========
        window.addEventListener('message', function(event) {
            if (event.data && event.data.action === 'calculateSaju') {
                try {
                    // ì…ë ¥ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ì„¤ì •
                    document.getElementById('jsonInput').value = JSON.stringify(event.data.customerData);
                    
                    // ê³„ì‚° ì‹¤í–‰
                    calculateFromJSON();
                    
                    // ê²°ê³¼ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (DOM ì—…ë°ì´íŠ¸ ëŒ€ê¸°)
                    setTimeout(() => {
                        const resultText = document.getElementById('resultText').textContent;
                        // ë¶€ëª¨ì—ê²Œ ê²°ê³¼ ì „ì†¡ (êµ¬ì¡°í™”ëœ ë°ì´í„° í¬í•¨)
                        event.source.postMessage({
                            action: 'sajuResult',
                            success: true,
                            result: resultText,
                            promptData: window.lastSajuData ? window.lastSajuData.promptData : null
                        }, '*');
                    }, 500);
                } catch (error) {
                    event.source.postMessage({
                        action: 'sajuResult',
                        success: false,
                        error: error.message
                    }, '*');
                }
            }
        });
    </script>
<!-- í”Œë¡œíŒ… ê´€ë¦¬ì ë²„íŠ¼ -->
<a href="index.html" style="position:fixed; bottom:20px; right:20px; z-index:9999; width:50px; height:50px; background:linear-gradient(135deg,#d4af82,#b8956a); border-radius:50%; display:flex; align-items:center; justify-content:center; text-decoration:none; font-size:24px; box-shadow:0 4px 15px rgba(0,0,0,0.3);">ğŸ </a>
</body>
</html>
